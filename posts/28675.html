<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><meta name="keywords" content="Django, python,linux,mysql,nginx,CICD,jenkins,docker,devops,redis,微服务"><meta name="description" content="djangoweb服务器web框架本质
对于所有的Web应用，本质上其实就是一个socket服务端，用户的浏览器其实就是一个socket客户端。
真实web框架一般会分为两部分：服务器程序和应用程序。
1）服务器程序：负责对socket服务"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="referrer" content="no-referrer-when-downgrade"><title>Django | 张大哥Blog</title><link rel="icon" type="image/png" href="/favicon.png"><style>body{background-image:url(http://pic1.win4000.com/wallpaper/2018-05-31/5b0f853804832.jpg);background-repeat:no-repeat;background-size:100% 100%;background-attachment:fixed}</style><link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css"><link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css"><link rel="stylesheet" type="text/css" href="/libs/aos/aos.css"><link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css"><link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" type="text/css" href="/css/matery.css"><link rel="stylesheet" type="text/css" href="/css/my.css"><link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload='"all"!=media&&(media="all")'><link rel="stylesheet" href="/libs/tocbot/tocbot.css"><link rel="stylesheet" href="/css/post.css"><link rel="stylesheet" type="text/css" href="/css/reward.css"><script src="/libs/jquery/jquery-3.6.0.min.js"></script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="张大哥Blog" type="application/atom+xml"></head><style type="text/css">.uk-alert{margin-bottom:15px;padding:10px;background:#ebf7fd;color:#2d7091;border:1px solid rgba(45,112,145,.3);border-radius:4px;text-shadow:0 1px 0 #fff}.uk-alert-success{background:#e8ece2;color:#659f13;border-left:6px solid rgba(120,199,9);font-weight:600}.uk-alert-warning{background:#fff1f0;color:#493b9c;border-left:6px solid rgb(83,27,184,.3);font-weight:600}.uk-alert-danger{background:#f8f8f6;color:#eb360d;border-left:6px solid#eb360d;font-weight:600}</style><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><span class="logo-span">张大哥Blog</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:.6"></i> <span>首页</span></a></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fa-solid fa-blog" style="zoom:.6"></i> <span>博客</span> <i class="fas fa-chevron-down" aria-hidden="true" style="zoom:.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/categories"><i class="fas fa-bookmark" style="margin-top:-20px;zoom:.6"></i> <span>分类</span></a></li><li><a href="/tags"><i class="fas fa-tags" style="margin-top:-20px;zoom:.6"></i> <span>标签</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fas fa-archive" style="zoom:.6"></i> <span>归档</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/about" class="waves-effect waves-light"><i class="fas fa-user-circle" style="zoom:.6"></i> <span>关于</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/resources" class="waves-effect waves-light"><i class="fa-solid fa-toolbox" style="zoom:.6"></i> <span>资源</span></a></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fas fa-list" style="zoom:.6"></i> <span>媒体</span> <i class="fas fa-chevron-down" aria-hidden="true" style="zoom:.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/galleries"><i class="fas fa-image" style="margin-top:-20px;zoom:.6"></i> <span>相册</span></a></li><li><a href="/books"><i class="fas fa-book" style="margin-top:-20px;zoom:.6"></i> <span>书籍</span></a></li><li><a href="/musics"><i class="fas fa-music" style="margin-top:-20px;zoom:.6"></i> <span>音乐</span></a></li><li><a href="/movies"><i class="fas fa-film" style="margin-top:-20px;zoom:.6"></i> <span>电影</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fas fa-address-book" style="zoom:.6"></i> <span>友情链接</span></a></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="搜索" style="zoom:.85"></i></a></li><li><a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式"><i id="sum-moon-icon" class="fas fa-sun" style="zoom:.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="/medias/loading.gif" data-original="/medias/logo.png" class="logo-img circle responsive-img"><div class="logo-name">张大哥Blog</div><div class="logo-desc">技术领域的创作者</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa-solid fa-blog"></i> 博客 <span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/categories" style="margin-left:75px"><i class="fa fas fa-bookmark" style="position:absolute;left:50px"></i> <span>分类</span></a></li><li><a href="/tags" style="margin-left:75px"><i class="fa fas fa-tags" style="position:absolute;left:50px"></i> <span>标签</span></a></li></ul></li><li class="m-nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fa-fw fas fa-archive"></i> 归档</a></li><li class="m-nav-item"><a href="/about" class="waves-effect waves-light"><i class="fa-fw fas fa-user-circle"></i> 关于</a></li><li class="m-nav-item"><a href="/resources" class="waves-effect waves-light"><i class="fa-fw fa-solid fa-toolbox"></i> 资源</a></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fas fa-list"></i> 媒体 <span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/galleries" style="margin-left:75px"><i class="fa fas fa-image" style="position:absolute;left:50px"></i> <span>相册</span></a></li><li><a href="/books" style="margin-left:75px"><i class="fa fas fa-book" style="position:absolute;left:50px"></i> <span>书籍</span></a></li><li><a href="/musics" style="margin-left:75px"><i class="fa fas fa-music" style="position:absolute;left:50px"></i> <span>音乐</span></a></li><li><a href="/movies" style="margin-left:75px"><i class="fa fas fa-film" style="position:absolute;left:50px"></i> <span>电影</span></a></li></ul></li><li class="m-nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fa-fw fas fa-address-book"></i> 友情链接</a></li><li><div class="divider"></div></li><li><a href="https://gitee.com/zhangtqup/zhangtq-blog" class="waves-effect waves-light" target="_blank"><i class="fab fa-github-square fa-fw"></i>Fork Me</a></li></ul></div></div><style>.nav-transparent .github-corner{display:none!important}.github-corner{position:absolute;z-index:10;top:0;right:0;border:0;transform:scale(1.1)}.github-corner svg{color:#0f9d58;fill:#fff;height:64px;width:64px}.github-corner:hover .octo-arm{animation:a .56s ease-in-out}.github-corner .octo-arm{animation:none}@keyframes a{0%,to{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}</style><a href="https://gitee.com/zhangtqup/zhangtq-blog" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a></nav></header><script src="/libs/cryptojs/crypto-js.min.js"></script><script></script><div class="bg-cover pd-header post-cover" style="background-image:url(/medias/featureimages/9.jpg)"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">Django</h1></div></div></div></div></div><main class="post-container content"><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/%E4%BD%A0%E7%9A%84%E6%A0%87%E7%AD%BE/"><span class="chip bg-color">你的标签</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/%E4%BD%A0%E7%9A%84%E5%88%86%E7%B1%BB/" class="post-category">你的分类</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="fa-solid fa-user-pen"></i>文章作者:&nbsp;&nbsp; 张大哥</div><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp; 2023-06-25</div><div class="post-date info-break-policy"><i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp; 2023-06-25</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp; 27.2k</div><div id="busuanzi_container_page_pv" class="info-break-policy"><i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp; <span id="busuanzi_value_page_pv"></span></div></div></div><hr class="clearfix"><link rel="stylesheet" href="/libs/prism/prism.min.css"><div class="card-content article-card-content"><div id="articleContent"><h1 id="django"><a href="#django" class="headerlink" title="django"></a>django</h1><h2 id="web服务器"><a href="#web服务器" class="headerlink" title="web服务器"></a>web服务器</h2><h3 id="web框架本质"><a href="#web框架本质" class="headerlink" title="web框架本质"></a>web框架本质</h3><ul><li>对于所有的Web应用，本质上其实就是一个socket服务端，用户的浏览器其实就是一个socket客户端。</li><li>真实web框架一般会分为两部分：服务器程序和应用程序。<ul><li>1）服务器程序：负责对socket服务器进行封装，并在请求到来时，对请求的各种数据进行整理</li><li>2）应用程序：负责具体的逻辑处理</li></ul></li></ul><h3 id="socket创建web服务"><a href="#socket创建web服务" class="headerlink" title="socket创建web服务"></a>socket创建web服务</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_request</span>(<span class="params">client</span>):</span><br><span class="line">    buf = client.recv(<span class="number">1024</span>)</span><br><span class="line">    client.send(<span class="string">&quot;HTTP/1.1 200 OK\r\n\r\n&quot;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))      <span class="comment"># 伪造浏览器请求头</span></span><br><span class="line">    client.send(<span class="string">&quot;Hello, Seven&quot;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))                  <span class="comment"># 返回数据到客户端浏览器</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    sock.bind((<span class="string">&#x27;localhost&#x27;</span>, <span class="number">8000</span>))</span><br><span class="line">    sock.listen(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        connection, address = sock.accept()</span><br><span class="line">        handle_request(connection)</span><br><span class="line">        connection.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p><img src="/medias/loading.gif" data-original="https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20210214201207490.565a7d72.png" alt="img"></p><h2 id="django框架"><a href="#django框架" class="headerlink" title="django框架"></a>django框架</h2><h3 id="django、tornado、flask框架比较"><a href="#django、tornado、flask框架比较" class="headerlink" title="django、tornado、flask框架比较"></a>django、tornado、flask框架比较</h3><ul><li><p>django: 重量级web服务器，包含了web开发中常用的功能、组件的框架；ORM、Session、Form、Admin、分页、中间件、信号、缓存….）；</p></li><li><p>Flask: 封装功能不及Django完善，性能不及Tornado，但是Flask的第三方开源组件比丰富；</p></li><li><p>Tornado: 最大特性就是异步非阻塞、原生支持WebSocket协议；</p></li><li><p><code>以 京东、淘宝、楼下小卖部 比喻</code></p><ul><li><code>django就像京东</code>，服务齐全，有自营商品，有自己的仓库，有自己的快递，一条龙服务，你懂的</li><li><code>flask就像是淘宝</code>，自己没有商品，没有仓库，没有快递，但是你可以选择三方的（韵达，中通等）</li><li><code>tornado就像是门口小卖部</code>，一个特点，快，不用等，但是东西很少，没有三方组件，需要自己动手写</li></ul></li><li><p>使用参考</p><ul><li>1）小型web应用设计的功能点不多，使用Flask比较合适；</li><li>2）大型web应用设计的功能点比较多，使用的组件也会比较多，使用Django（自带功能多不用去找插件）；</li><li>3）如果追求性能可以考虑Tornado</li></ul></li></ul><h3 id="MVC模式"><a href="#MVC模式" class="headerlink" title="MVC模式"></a>MVC模式</h3><ul><li>M全拼为Model，主要封装对数据库层的访问，对数据库中的数据进行增、删、改、查操作。</li><li>V全拼为View，用于封装结果，生成页面展示的html内容。</li><li>C全拼为Controller，用于接收请求，处理业务逻辑，与Model和View交互，返回结果。</li></ul><p><img src="/medias/loading.gif" data-original="https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20210214204226395.a9789c36.png" alt="img"></p><h3 id="MVT-Django设计模式"><a href="#MVT-Django设计模式" class="headerlink" title="MVT(Django设计模式)"></a>MVT(Django设计模式)</h3><ul><li>M全拼为Model，与MVC中的M功能相同，负责和数据库交互，进行数据处理。</li><li>V全拼为View，与MVC中的C功能相同，接收请求，进行业务处理，返回应答。</li><li>T全拼为Template，与MVC中的V功能相同，负责封装构造要返回的html(<code>或者是json数据</code>)。</li></ul><p><img src="/medias/loading.gif" data-original="https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20210214204504660.47273228.png" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.bashrc                                        <span class="comment"># 执行virtualenvwrapper安装脚本</span></span><br></pre></td></tr></table></figure><h2 id="环境安装"><a href="#环境安装" class="headerlink" title="环境安装"></a>环境安装</h2><h3 id="virtualenvwrapper使用"><a href="#virtualenvwrapper使用" class="headerlink" title="virtualenvwrapper使用"></a>virtualenvwrapper使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkvirtualenv test1                  <span class="comment"># 创建虚拟环境</span></span><br><span class="line">mkvirtualenv test2env -p python3</span><br><span class="line">lsvirtualenv                       <span class="comment"># 查看虚拟环境 </span></span><br><span class="line">workon  test1                      <span class="comment"># 进入虚拟环境</span></span><br><span class="line">deactivate                         <span class="comment"># 退出虚拟环境 </span></span><br><span class="line">rmvirtualenv test1                   <span class="comment"># 删除虚拟环境 </span></span><br><span class="line">pip <span class="built_in">list</span>                           <span class="comment"># 查看虚拟环境下的安装包 </span></span><br></pre></td></tr></table></figure><h3 id="使用复习"><a href="#使用复习" class="headerlink" title="使用复习"></a>使用复习</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pip</span><br><span class="line">pip install # 安装依赖包</span><br><span class="line">pip uninstall # 卸载依赖包</span><br><span class="line">pip list # 查看已经安装的依赖包</span><br><span class="line">pip freeze &gt; requirements.txt  # 导出依赖包</span><br><span class="line">pip install -r requirements.txt # 从文件安装依赖包</span><br></pre></td></tr></table></figure><h2 id="django安装"><a href="#django安装" class="headerlink" title="django安装"></a>django安装</h2><h3 id="创建虚拟环境"><a href="#创建虚拟环境" class="headerlink" title="创建虚拟环境"></a>创建虚拟环境</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkvirtualenv  djenv      # 创建虚拟环境 djenv</span><br><span class="line">workon djenv           # 进入虚拟环境</span><br><span class="line">pip list             # 可以看到，当前python环境和系统安装的python环境不同</span><br></pre></td></tr></table></figure><h3 id="安装Django-2-0-4"><a href="#安装Django-2-0-4" class="headerlink" title="安装Django 2.0.4"></a>安装Django 2.0.4</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django==<span class="number">2.0</span><span class="number">.4</span></span><br></pre></td></tr></table></figure><h3 id="安装慢修改pip源"><a href="#安装慢修改pip源" class="headerlink" title="安装慢修改pip源"></a>安装慢修改pip源</h3><ul><li>打开我的电脑在地址栏里输入：<code>%APPDATA%</code> 后回车，然后就进入了C:\Users\Lenovo\AppData\Roaming 这个路劲里面</li><li>添加文件： <code>C:\Users\Lenovo\AppData\Roaming \pip\pip.ini</code>文件，写一下内容</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">global</span>]</span><br><span class="line">timeout = <span class="number">6000</span></span><br><span class="line">index-url = http://pypi.douban.com/simple</span><br><span class="line">trusted-host = pypi.douban.com</span><br></pre></td></tr></table></figure><h2 id="创建django项目"><a href="#创建django项目" class="headerlink" title="创建django项目"></a>创建django项目</h2><h3 id="创建django项目-1"><a href="#创建django项目-1" class="headerlink" title="创建django项目"></a>创建django项目</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(djenv) c:\tmp&gt;workon djenv                         <span class="comment">## 进入虚拟环境</span></span><br><span class="line">(djenv) c:\tmp&gt;django-admin startproject mysite           <span class="comment">## 创建django项目</span></span><br><span class="line">(djenv) c:\tmp&gt;cd mysite                           <span class="comment">## 进入项目目录</span></span><br><span class="line">D:\mysite&gt;  python manage.py runserver <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>       <span class="comment">## 运行mysite项目</span></span><br><span class="line"><span class="comment">## 浏览器访问：http://127.0.0.1:8000/</span></span><br></pre></td></tr></table></figure><p><img src="/medias/loading.gif" data-original="https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20210214212742257.d60e0a8a.png" alt="img"></p><h4 id="工程目录说明"><a href="#工程目录说明" class="headerlink" title="工程目录说明"></a>工程目录说明</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">C:.</span><br><span class="line">│  db.sqlite3                <span class="comment">## sqlite数据库文件（settings.py中默认连接的数据库）</span></span><br><span class="line">│  manage.py                <span class="comment">## 项目管理脚本</span></span><br><span class="line">│</span><br><span class="line">└─mysite</span><br><span class="line">    │  settings.py           <span class="comment">## 是项目的整体配置文件</span></span><br><span class="line">    │  urls.py              <span class="comment">## 总路由</span></span><br><span class="line">    │  wsgi.py              <span class="comment">## 是项目与WSGI兼容的Web服务器入口</span></span><br><span class="line">    │  __init__.py</span><br></pre></td></tr></table></figure><h4 id="运行开发服务器"><a href="#运行开发服务器" class="headerlink" title="运行开发服务器"></a>运行开发服务器</h4><ul><li>在开发阶段，为了能够快速预览到开发的效果</li><li>django提供了一个纯python编写的轻量级web服务器，仅在开发阶段使用。</li><li>可以不写IP和端口，默认IP是127.0.0.1，默认端口为8000</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python manage.py runserver ip:端口</span><br><span class="line">或：</span><br><span class="line">python manage.py runserver</span><br></pre></td></tr></table></figure><h4 id="配置setting-py"><a href="#配置setting-py" class="headerlink" title="配置setting.py"></a>配置setting.py</h4><h5 id="配置模板路径"><a href="#配置模板路径" class="headerlink" title="配置模板路径"></a>配置模板路径</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="string">&#x27;DIRS&#x27;</span>: [os.path.join(BASE_DIR,<span class="string">&#x27;templates&#x27;</span>)],</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h5 id="配置静态目录"><a href="#配置静态目录" class="headerlink" title="配置静态目录"></a>配置静态目录</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#像ccs和js这些静态文件如果想要使用必须在这里配置路径</span></span><br><span class="line">STATICFILES_DIRS = (</span><br><span class="line">    os.path.join(BASE_DIR,<span class="string">&#x27;static&#x27;</span>),</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h5 id="注释CSRF"><a href="#注释CSRF" class="headerlink" title="注释CSRF"></a>注释CSRF</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="comment">## &#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;,</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h5 id="修改时区"><a href="#修改时区" class="headerlink" title="修改时区"></a>修改时区</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## LANGUAGE_CODE = &#x27;en-us&#x27;</span></span><br><span class="line">LANGUAGE_CODE = <span class="string">&#x27;zh-hans&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## TIME_ZONE = &#x27;UTC&#x27;</span></span><br><span class="line">TIME_ZONE = <span class="string">&#x27;Asia/Shanghai&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="创建子应用三部曲"><a href="#创建子应用三部曲" class="headerlink" title="创建子应用三部曲"></a>创建子应用三部曲</h3><h4 id="创建子应用"><a href="#创建子应用" class="headerlink" title="创建子应用"></a>创建子应用</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(djenv) c:\tmp\mysite&gt;  python manage.py startapp app01</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">C:.</span><br><span class="line">│  db.sqlite3               <span class="comment">## sqlite数据库文件（settings.py中默认连接的数据库）</span></span><br><span class="line">│  manage.py               <span class="comment">## 项目管理脚本</span></span><br><span class="line">│</span><br><span class="line">├─app01 （子应用目录）</span><br><span class="line">│  │  admin.py            <span class="comment">## 配置django admin后台</span></span><br><span class="line">│  │  apps.py</span><br><span class="line">│  │  models.py            <span class="comment">## 配置django表，负责和数据库交互，进行数据处理</span></span><br><span class="line">│  │  tests.py</span><br><span class="line">│  │  views.py             <span class="comment">## 接收请求，进行业务处理，返回应答</span></span><br><span class="line">│  │  __init__.py</span><br><span class="line">│  │</span><br><span class="line">│  └─migrations</span><br><span class="line">│          __init__.py</span><br><span class="line">│</span><br><span class="line">└─mysite</span><br><span class="line">    │  settings.py           <span class="comment">## 是项目的整体配置文件</span></span><br><span class="line">    │  urls.py              <span class="comment">## 总路由</span></span><br><span class="line">    │  wsgi.py              <span class="comment">## 是项目与WSGI兼容的Web服务器入口</span></span><br><span class="line">    │  __init__.py</span><br></pre></td></tr></table></figure><h4 id="注册子应用"><a href="#注册子应用" class="headerlink" title="注册子应用"></a>注册子应用</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;app01.apps.App01Config&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="配置主路由"><a href="#配置主路由" class="headerlink" title="配置主路由"></a>配置主路由</h4><ul><li><code>mysite\urls.py</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    <span class="comment"># 配置路由分发</span></span><br><span class="line">    path(<span class="string">&#x27;app01/&#x27;</span>, include((<span class="string">&#x27;app01.urls&#x27;</span>, <span class="string">&#x27;app01&#x27;</span>), namespace=<span class="string">&#x27;app01&#x27;</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="添加子路由"><a href="#添加子路由" class="headerlink" title="添加子路由"></a>添加子路由</h4><ul><li><code>app01/urls.py</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, re_path</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    re_path(<span class="string">r&#x27;index1/$&#x27;</span>, views.index1, name=<span class="string">&#x27;index1&#x27;</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="创建视图"><a href="#创建视图" class="headerlink" title="创建视图"></a>创建视图</h4><ul><li><code>app01/views.py</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index1</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;Hello World&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="PyCharm打开项目"><a href="#PyCharm打开项目" class="headerlink" title="PyCharm打开项目"></a>PyCharm打开项目</h3><h4 id="添加虚拟环境"><a href="#添加虚拟环境" class="headerlink" title="添加虚拟环境"></a>添加虚拟环境</h4><ul><li>文件 –》 设置 –》项目:mysite –》 python解释器</li></ul><p><img src="/medias/loading.gif" data-original="https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20210214215013077.a3eebe26.png" alt="img"></p><h4 id="添加解释器"><a href="#添加解释器" class="headerlink" title="添加解释器"></a>添加解释器</h4><p><img src="/medias/loading.gif" data-original="https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20210214215125468.85c3521f.png" alt="img"></p><h3 id="配置跨域"><a href="#配置跨域" class="headerlink" title="配置跨域"></a>配置跨域</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 安装包</span><br><span class="line">pip install django-cors-headers </span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 注册应用</span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">&#x27;corsheaders&#x27;</span>,   <span class="comment"># 添加 django-cors-headers 使其可以进行 cors 跨域</span></span><br><span class="line">]</span><br><span class="line"><span class="number">3.</span> 添加中间件</span><br><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="comment"># 放在中间件第一个</span></span><br><span class="line">    <span class="string">&#x27;corsheaders.middleware.CorsMiddleware&#x27;</span>,</span><br><span class="line">    ...</span><br><span class="line">]</span><br><span class="line"><span class="number">4.</span> 设置</span><br><span class="line"><span class="comment"># CORS跨域请求白名单设置</span></span><br><span class="line">CORS_ORIGIN_WHITELIST = (</span><br><span class="line">    <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://localhost:8080&#x27;</span>,</span><br><span class="line">)</span><br><span class="line">CORS_ALLOW_CREDENTIALS = <span class="literal">True</span>  <span class="comment"># 允许携带cookie</span></span><br></pre></td></tr></table></figure><h2 id="路由配置"><a href="#路由配置" class="headerlink" title="路由配置"></a>路由配置</h2><h3 id="Django路由分发"><a href="#Django路由分发" class="headerlink" title="Django路由分发"></a>Django路由分发</h3><ul><li><code>mysite/urls.py</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysite/urls.py</span></span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    <span class="comment"># 配置路由分发</span></span><br><span class="line">    path(<span class="string">&#x27;app01/&#x27;</span>, include((<span class="string">&#x27;app01.urls&#x27;</span>, <span class="string">&#x27;app01&#x27;</span>), namespace=<span class="string">&#x27;app01&#x27;</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="普通url"><a href="#普通url" class="headerlink" title="普通url"></a>普通url</h3><h4 id="app01-urls-py"><a href="#app01-urls-py" class="headerlink" title="app01&#x2F;urls.py"></a>app01&#x2F;urls.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, re_path</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    re_path(<span class="string">&#x27;index1/$&#x27;</span>, views.index1, name=<span class="string">&#x27;indexname1&#x27;</span>),          <span class="comment"># 方法1：无正则匹配url</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="app01-views-py"><a href="#app01-views-py" class="headerlink" title="app01&#x2F;views.py"></a>app01&#x2F;views.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法1：无正则匹配url（ http://127.0.0.1:8000/index1/?uid=1 ）</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index1</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="built_in">print</span>( request.GET )             <span class="comment"># &#123;&quot;uid&quot;: &quot;1&quot;&#125;</span></span><br><span class="line">    nid = request.GET.get(<span class="string">&#x27;uid&#x27;</span>)    <span class="comment"># 1</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;无正则匹配url&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="正则的url-d"><a href="#正则的url-d" class="headerlink" title="正则的url (\d+)"></a>正则的url <code>(\d+)</code></h3><h4 id="app01-urls-py-1"><a href="#app01-urls-py-1" class="headerlink" title="app01&#x2F;urls.py"></a>app01&#x2F;urls.py</h4><ul><li><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/app01/index1/">http://127.0.0.1:8000/app01/index1/</a></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, re_path</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    re_path(<span class="string">&#x27;index2/(\d+)/$&#x27;</span>, views.index2, name=<span class="string">&#x27;indexname2&#x27;</span>),     <span class="comment"># 方法2：基于(\d+)正则的url</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="app01-views-py-1"><a href="#app01-views-py-1" class="headerlink" title="app01&#x2F;views.py"></a>app01&#x2F;views.py</h4><ul><li><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/app01/index2/1/">http://127.0.0.1:8000/app01/index2/1/</a></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法2：基于(\d+)正则的url（  http://127.0.0.1:8000/index2/1/  ）</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index2</span>(<span class="params">request, uid</span>):</span><br><span class="line">    <span class="built_in">print</span>( uid )                    <span class="comment"># 1</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;基于(\d+)正则的url&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="正则分组-P-d"><a href="#正则分组-P-d" class="headerlink" title="正则分组(?P&lt;nid&gt;\d+)"></a>正则分组<code>(?P&lt;nid&gt;\d+)</code></h3><ul><li>基于正则分组<code>(?P&lt;nid&gt;\d+)</code>，可以不考虑接收参数顺序 (推荐)</li></ul><h5 id="app01-urls-py-2"><a href="#app01-urls-py-2" class="headerlink" title="app01&#x2F;urls.py"></a>app01&#x2F;urls.py</h5><ul><li><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/app01/index3/1/2/">http://127.0.0.1:8000/app01/index3/1/2/</a></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, re_path</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    re_path(<span class="string">&#x27;index3/(?P&lt;nid&gt;\d+)/(?P&lt;pid&gt;\d+)/$&#x27;</span>, views.index3, name=<span class="string">&#x27;indexname3&#x27;</span>),        <span class="comment"># 方法3：基于(\d+)正则的url</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="app01-views-py-2"><a href="#app01-views-py-2" class="headerlink" title="app01&#x2F;views.py"></a>app01&#x2F;views.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法3：基于正则分组(?P&lt;nid&gt;\d+)（  http://127.0.0.1:8000/app01/index3/1/2/  ）</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index3</span>(<span class="params">request, nid, pid</span>):</span><br><span class="line">    <span class="built_in">print</span>(nid)                     <span class="comment"># 1</span></span><br><span class="line">    <span class="built_in">print</span>(pid)                     <span class="comment"># 2</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;基于正则分组url&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="使用name构建自己想要的url"><a href="#使用name构建自己想要的url" class="headerlink" title="使用name构建自己想要的url"></a>使用name构建自己想要的url</h3><h4 id="app01-urls-py-3"><a href="#app01-urls-py-3" class="headerlink" title="app01&#x2F;urls.py"></a>app01&#x2F;urls.py</h4><ul><li><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/app01/index3/1/2/">http://127.0.0.1:8000/app01/index3/1/2/</a></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, re_path</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    re_path(<span class="string">&#x27;index4/$&#x27;</span>, views.index4),                               <span class="comment"># 方法4：使用name构建自己想要的url</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="app01-views-py-3"><a href="#app01-views-py-3" class="headerlink" title="app01&#x2F;views.py"></a>app01&#x2F;views.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> reverse</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法4：使用name构建自己想要的url （http://127.0.0.1:8000/index4/）</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index4</span>(<span class="params">request</span>):</span><br><span class="line">    url1 = reverse(<span class="string">&#x27;indexname1&#x27;</span>)                         <span class="comment"># /index1/</span></span><br><span class="line">    url2 = reverse(<span class="string">&#x27;indexname2&#x27;</span>, args=(<span class="number">1</span>,))                  <span class="comment"># /index2/1/2/</span></span><br><span class="line">    url3 = reverse(<span class="string">&#x27;indexname3&#x27;</span>, kwargs=&#123;<span class="string">&#x27;pid&#x27;</span>: <span class="number">1</span>, <span class="string">&quot;nid&quot;</span>:<span class="number">2</span>&#125;)       <span class="comment"># /index3/1/2/</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;index.html&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="反解出url中的name"><a href="#反解出url中的name" class="headerlink" title="反解出url中的name"></a>反解出url中的name</h4><ul><li>根据request.path中的绝对路径反解出url中的name名字</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">resolve_url_obj = resolve(request.path)         <span class="comment"># request.path路径： /student/homework_detail/52</span></span><br><span class="line">resolve_url_obj.url_name                   <span class="comment"># 从path中解析出url名字 url_name = homework_detail</span></span><br></pre></td></tr></table></figure><h2 id="请求与响应"><a href="#请求与响应" class="headerlink" title="请求与响应"></a>请求与响应</h2><h3 id="请求request"><a href="#请求request" class="headerlink" title="请求request"></a>请求request</h3><h4 id="常见request内容"><a href="#常见request内容" class="headerlink" title="常见request内容"></a>常见request内容</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、request.POST         # 获取post请求数据</span></span><br><span class="line"><span class="comment"># 2、request.GET          # 获取get请求</span></span><br><span class="line"><span class="comment"># 3、request.FILES        # 获取文件</span></span><br><span class="line"><span class="comment"># 4、request.getlist       # 获取表达中列表</span></span><br><span class="line"><span class="comment"># 5、request.method        # 获取请求方式 get/post</span></span><br><span class="line"><span class="comment"># 6、request.path_info      #获取当前url</span></span><br><span class="line"><span class="comment"># 7、request.body          #自己获取请求体数据</span></span><br></pre></td></tr></table></figure><h4 id="app01-views-py-4"><a href="#app01-views-py-4" class="headerlink" title="app01/views.py"></a><code>app01/views.py</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">&#x27;data.html&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        v = request.POST.get(<span class="string">&#x27;gender&#x27;</span>)      <span class="comment">#1 获取单选框的value值</span></span><br><span class="line">        v = request.POST.getlist(<span class="string">&#x27;favor&#x27;</span>)   <span class="comment">#2 获取多选框value：[&#x27;11&#x27;, &#x27;22&#x27;, &#x27;33&#x27;]</span></span><br><span class="line">        v = request.POST.getlist(<span class="string">&#x27;city&#x27;</span>)    <span class="comment">#3 获取多选下拉菜单：[&#x27;bj&#x27;, &#x27;sh&#x27;, &#x27;gz&#x27;]</span></span><br><span class="line">        <span class="built_in">print</span>(v.name,<span class="built_in">type</span>(v))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">#当服务器端取客户端发送来的数据，不会将数据一下拿过来而是一点点取(chunks就是文件分成的块)</span></span><br><span class="line">        </span><br><span class="line">        obj = request.FILES.get(<span class="string">&#x27;fff&#x27;</span>)      <span class="comment">#4 下面是获取客户端上传的文件（如：图片）</span></span><br><span class="line">        <span class="keyword">import</span> os</span><br><span class="line">        file_path = os.path.join(<span class="string">&#x27;upload&#x27;</span>,obj.name)</span><br><span class="line">        f = <span class="built_in">open</span>(file_path,mode=<span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> obj.chunks():</span><br><span class="line">            f.write(i)</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">&#x27;login.html&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="data-html"><a href="#data-html" class="headerlink" title="data.html"></a>data.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/login/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;用户名&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    &#123;# 1、单选框，返回单条数据的列表 #&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>     </span><br><span class="line">        男：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">        女：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">        人妖：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &#123;# 2、多选框、返回多条数据列表 #&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>     </span><br><span class="line">        男：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;favor&quot;</span> <span class="attr">value</span>=<span class="string">&quot;11&quot;</span>&gt;</span></span><br><span class="line">        女：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;favor&quot;</span> <span class="attr">value</span>=<span class="string">&quot;22&quot;</span>&gt;</span></span><br><span class="line">        张扬：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;favor&quot;</span> <span class="attr">value</span>=<span class="string">&quot;33&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &#123;# 3、多选，返回多条数据的列表 #&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>     </span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;city&quot;</span> <span class="attr">multiple</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;bj&quot;</span>&gt;</span>北京<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;sh&quot;</span>&gt;</span>上海<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;gz&quot;</span>&gt;</span>广州<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &#123;# 4、提交文件 #&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;fff&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h3><h4 id="HttpResponse"><a href="#HttpResponse" class="headerlink" title="HttpResponse"></a>HttpResponse</h4><ul><li>需要手动将字符串转化成json字符串并相应到前端</li><li>传到到前端的是json字符串，还需要手动进行转化</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">testResponse</span>(<span class="params">request</span>):</span><br><span class="line">    data=&#123;</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;zhangsan&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;age&#x27;</span>:<span class="number">18</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># 默认格式：content_type=&quot;text/plain&quot;</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(json.dumps(data), content_type=<span class="string">&quot;application/json&quot;</span>)</span><br><span class="line">    <span class="comment"># return HttpResponse(json.dumps(data), content_type=&quot;text/plain&quot;)</span></span><br></pre></td></tr></table></figure><h4 id="JsonResponse"><a href="#JsonResponse" class="headerlink" title="JsonResponse"></a>JsonResponse</h4><ul><li>JsonResponse继承HttpResponse</li><li>数据类型装自动换成json字符串并相应到前端，传到前端的是数据类型而非json字符串</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">testResponse</span>(<span class="params">request</span>):</span><br><span class="line">    data=&#123;</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;age&#x27;</span>:<span class="number">18</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(data=data)</span><br></pre></td></tr></table></figure><h4 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h4><ul><li>是Django rest-framework框架中封装好的响应对象</li><li>但是只能在继承于rest-framework的APIView的视图类中使用. 比较推荐.</li><li>安装：<code>pip install djangorestframework==3.9.2</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestResponse</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self,request,*args,**kwargs</span>):</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;age&#x27;</span>: <span class="number">18</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;zhangsan&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><h4 id="render"><a href="#render" class="headerlink" title="render"></a>render</h4><ul><li>返回html页面</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;index.html&#x27;</span>,&#123;<span class="string">&#x27;users&#x27;</span>:[<span class="string">&#x27;zhangsan&#x27;</span>,<span class="string">&#x27;lisi&#x27;</span>,<span class="string">&#x27;wangwu&#x27;</span>]&#125;)</span><br></pre></td></tr></table></figure><h4 id="redirect"><a href="#redirect" class="headerlink" title="redirect"></a>redirect</h4><ul><li>重定向到新的页面</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> redirect(<span class="string">&#x27;https://www.baidu.com&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="类视图"><a href="#类视图" class="headerlink" title="类视图"></a>类视图</h2><h3 id="类视图-1"><a href="#类视图-1" class="headerlink" title="类视图"></a>类视图</h3><h4 id="函数视图弊端"><a href="#函数视图弊端" class="headerlink" title="函数视图弊端"></a>函数视图弊端</h4><ul><li>以函数的方式定义的视图称为<strong>函数视图</strong>，函数视图便于理解。</li><li>但是遇到一个视图对应的路径提供了多种不同HTTP请求方式的支持时</li><li>便需要在一个函数中编写不同的业务逻辑，代码可读性与复用性都不佳。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>(<span class="params">request</span>):</span><br><span class="line">   <span class="string">&quot;&quot;&quot;处理注册&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># 获取请求方法，判断是GET/POST请求</span></span><br><span class="line">   <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">       <span class="comment"># 处理GET请求，返回注册页面</span></span><br><span class="line">       <span class="keyword">return</span> render(request, <span class="string">&#x27;register.html&#x27;</span>)</span><br><span class="line">   <span class="keyword">else</span>:</span><br><span class="line">       <span class="comment"># 处理POST请求，实现注册逻辑</span></span><br><span class="line">       <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;这里实现注册逻辑&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="类视图引入"><a href="#类视图引入" class="headerlink" title="类视图引入"></a>类视图引入</h4><ul><li>在Django中也可以使用类来定义一个视图，称为<strong>类视图</strong>。</li><li>使用类视图可以将视图对应的不同请求方式以类中的不同方法来区别定义。</li><li><code>类视图的好处</code><ul><li>1）<strong>代码可读性好</strong></li><li>2）<strong>类视图相对于函数视图有更高的复用性</strong>， 如果其他地方需要用到某个类视图的某个特定逻辑，直接继承该类视图即可</li></ul></li><li><code>类视图原理</code><ul><li>1）调用流程 as_view–&gt;view–&gt;dispatch</li><li>2）getattr(‘对象’,’字符串’)</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RegisterView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;类视图：处理注册&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;处理GET请求，返回注册页面&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;zhangsan&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;处理POST请求，实现注册逻辑&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;zhangsan&quot;</span>&#125;)</span><br></pre></td></tr></table></figure><h3 id="类视图添加装饰器"><a href="#类视图添加装饰器" class="headerlink" title="类视图添加装饰器"></a>类视图添加装饰器</h3><p>1、 dispatch是父类中用来反射的函数，找对应的函数（比对应函数先执行）</p><ul><li>2、 比如你发送post请求就可以通过dispatch找到对应的post函数进行处理，get就会找到get函数处理</li><li><code>添加路由</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, re_path</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    re_path(<span class="string">&#x27;home/&#x27;</span>, views.Home.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="定义一个装饰器"><a href="#定义一个装饰器" class="headerlink" title="定义一个装饰器"></a>定义一个装饰器</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">my_decorator</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">request, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;自定义装饰器被调用了&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;请求路径%s&#x27;</span> % request.path)</span><br><span class="line">        <span class="keyword">return</span> func(request, *args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure><h4 id="为特定请求方法添加装饰器"><a href="#为特定请求方法添加装饰器" class="headerlink" title="为特定请求方法添加装饰器"></a>为特定请求方法添加装饰器</h4><ul><li>在类视图中使用为函数视图准备的装饰器时，不能直接添加装饰器</li><li>需要使用<strong>method_decorator</strong>将其转换为适用于类视图方法的装饰器。</li><li><strong>method_decorator装饰器使用name参数指明被装饰的方法</strong></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> django.utils.decorators <span class="keyword">import</span> method_decorator</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为全部请求方法添加装饰器</span></span><br><span class="line"><span class="meta">@method_decorator(<span class="params">my_decorator, name=<span class="string">&#x27;dispatch&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DemoView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;get方法&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;post方法&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只给get请求添加装饰器</span></span><br><span class="line"><span class="meta">@method_decorator(<span class="params">my_decorator, name=<span class="string">&#x27;get&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DemoView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;get方法&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;post方法&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;ok&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="为特定请求方法添加装饰器-1"><a href="#为特定请求方法添加装饰器-1" class="headerlink" title="为特定请求方法添加装饰器"></a>为特定请求方法添加装饰器</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> django.utils.decorators <span class="keyword">import</span> method_decorator</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为特定请求方法添加装饰器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DemoView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line"></span><br><span class="line"><span class="meta">    @method_decorator(<span class="params">my_decorator</span>)  </span><span class="comment"># 为get方法添加了装饰器</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;get方法&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @method_decorator(<span class="params">my_decorator</span>)  </span><span class="comment"># 为post方法添加了装饰器</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;post方法&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">put</span>(<span class="params">self, request</span>):  <span class="comment"># 没有为put方法添加装饰器</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;put方法&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;ok&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="类视图Mixin扩展类"><a href="#类视图Mixin扩展类" class="headerlink" title="类视图Mixin扩展类"></a>类视图Mixin扩展类</h3><ul><li>使用面向对象多继承的特性，可以通过定义父类（作为扩展类）</li><li>在父类中定义想要向类视图补充的方法，类视图继承这些扩展父类，便可实现代码复用。</li><li>定义的扩展父类名称通常以Mixin结尾。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ListModelMixin</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    list扩展类</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">list</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CreateModelMixin</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    create扩展类</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BooksView</span>(CreateModelMixin, ListModelMixin, View):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    同时继承两个扩展类，复用list和create方法</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="variable language_">self</span>.<span class="built_in">list</span>(request)</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="variable language_">self</span>.create(request)</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure><h2 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h2><h3 id="初识中间件"><a href="#初识中间件" class="headerlink" title="初识中间件"></a>初识中间件</h3><h4 id="什么是中间件"><a href="#什么是中间件" class="headerlink" title="什么是中间件"></a>什么是中间件</h4><ul><li>Django中间件是修改 Django request 或者 response 对象的钩子</li><li>可以理解为是介于 HttpRequest 与 HttpResponse 处理之间的一道处理过程。</li><li>Django中间件作用：<ul><li>修改请求，即传送到 view 中的 HttpRequest 对象。</li><li>修改响应，即 view 返回的 HttpResponse 对象。</li></ul></li></ul><h4 id="中间件处理过程"><a href="#中间件处理过程" class="headerlink" title="中间件处理过程"></a>中间件处理过程</h4><ul><li>1、首先客户端发起请求，会将请求交给settings.py中排在最前面的中间件</li><li>2、前面中间件收到请求会调用类中的process_request方法处理，然后交给下一个中间件的process_request函数</li><li>3、到达最后一个中间件的process_request函数处理后会到达url路由系统</li><li>4、然后从路由系统直接跳转到第一个中间件的process_view函数，依次向后面中间的process_view传递<ul><li>最后到达views.py处理函数，获取网页中的数据</li></ul></li><li>5、获取的数据会交给最后一个中间件的process_response方法处理，然后依次向前面的中间件process_response<ul><li>方法提交请求的内容，最后由最前面的中间件将请求数据返回到客户端</li></ul></li><li>6、在任一中间件的process_request和process_view方法中有返回值就会直接返回给process_response</li></ul><h4 id="生命周期图解"><a href="#生命周期图解" class="headerlink" title="生命周期图解"></a>生命周期图解</h4><ul><li>1、首先会交给中间件，中间件处理后交给路由系统</li><li>2、路由系统<ul><li>1：Django程序会到urls.py文件中找到对应请求的处理函数（视图函数）</li></ul></li><li>3、视图函数<ul><li>1：视图函数会找到对应的html模板文件</li><li>2：然后到数据库中取得数据替换html模板中的内容</li><li>3：使用static中的js和css文件结合对html渲染</li><li>4：最后Django将最终渲染后的html文件返回给中间件</li></ul></li><li>4、中间件再调用process_response方法处理，最后交给用户</li></ul><p><img src="/medias/loading.gif" data-original="https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20210215211340365.9fe90a86.png" alt="img"></p><h3 id="中间件使用"><a href="#中间件使用" class="headerlink" title=".中间件使用"></a>.中间件使用</h3><h4 id="创建存放中间件的文件夹"><a href="#创建存放中间件的文件夹" class="headerlink" title="创建存放中间件的文件夹"></a>创建存放中间件的文件夹</h4><ul><li><ol><li>在工程目录下创建任意目录，这里创建路径为： <code>/project/middle/m1.py</code></li></ol></li></ul><h4 id="settings-py中注册中间件"><a href="#settings-py中注册中间件" class="headerlink" title="settings.py中注册中间件"></a>settings.py中注册中间件</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    &#x27;middle.m1.Row1&#x27;,</span><br><span class="line">    &#x27;middle.m1.Row2&#x27;,</span><br><span class="line">    &#x27;middle.m1.Row3&#x27;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="写处理函数test"><a href="#写处理函数test" class="headerlink" title="写处理函数test"></a>写处理函数test</h4><ul><li>在views.py文件中写处理函数test</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def test(request):</span><br><span class="line">    # int(&#x27;fds&#x27;)    #当views函数出现异常，中间件中的process_exception执行</span><br><span class="line">    print(&#x27;没带钱|&#x27;)</span><br><span class="line">    return HttpResponse(&#x27;ok&#x27;)</span><br></pre></td></tr></table></figure><h4 id="定义中间件"><a href="#定义中间件" class="headerlink" title="定义中间件"></a>定义中间件</h4><ul><li>在&#x2F;project&#x2F;middle&#x2F;m1.py文件中定义中间件</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.utils.deprecation <span class="keyword">import</span> MiddlewareMixin</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Row1</span>(<span class="title class_ inherited__">MiddlewareMixin</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self,request</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;process_request_1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_view</span>(<span class="params">self,request, view_func, view_func_args, view_func_kwargs</span>):</span><br><span class="line">        <span class="comment">#view_func_args:   url中传递的非字典的值会用这个变量接收</span></span><br><span class="line">        <span class="comment">#view_func_kwargs: url中传递的字典会传递到这个变量接收（如：nid=1）</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;process_view_1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_response</span>(<span class="params">self,request, response</span>):    <span class="comment">#response就是拿到的返回信息</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;response_1&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_exception</span>(<span class="params">self, request, exception</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;只有当views函数中异常这个函数才会执行&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(exception, ValueError):</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;&gt;&gt;出现异常了&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Row2</span>(<span class="title class_ inherited__">MiddlewareMixin</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self,request</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;process_request_2&#x27;</span>)</span><br><span class="line">        <span class="comment">#1 如果在Row2中的process_request中有返回值，那么就不会到达Row3</span></span><br><span class="line">        <span class="comment">#2 Row2直接将返回值交给自己的process_response再交给Row1的process_response</span></span><br><span class="line">        <span class="comment">#3 最后客户端页面显示的就是‘走’请求没机会到达views函数，不会打印‘没带钱’</span></span><br><span class="line">        <span class="comment"># return HttpResponse(&#x27;走&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_view</span>(<span class="params">self,request, view_func, view_func_args, view_func_kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;process_view_2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_response</span>(<span class="params">self,request, response</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;response_2&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Row3</span>(<span class="title class_ inherited__">MiddlewareMixin</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self,request</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;process_request_3&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_view</span>(<span class="params">self,request, view_func, view_func_args, view_func_kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;process_view_3&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_response</span>(<span class="params">self,request, response</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;response_3&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure><h2 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h2><h3 id="cookie-1"><a href="#cookie-1" class="headerlink" title="cookie"></a>cookie</h3><h4 id="cookie简介"><a href="#cookie简介" class="headerlink" title="cookie简介"></a>cookie简介</h4><ul><li>1.cookie实质就是客户端硬盘中存放的键值对，利用这个特性可以用来做用户验证</li><li>2.比如：{“username”: “dachengzi”} #再次访问url就会携带这些信息过来</li></ul><h4 id="前端操作cookie"><a href="#前端操作cookie" class="headerlink" title="前端操作cookie"></a>前端操作cookie</h4><ul><li>说明： 使用下面方法操cookie必须先引入jquery.cookie.js</li><li><ol><li>前端获取cookie值： <strong>var v &#x3D; $.cookie</strong>(‘per_page_count’);</li></ol></li><li><ol><li>前端设置cookie值： <strong>$.cookie</strong>(‘per_page_count’,v);</li></ol></li></ul><h4 id="后端操作cookie"><a href="#后端操作cookie" class="headerlink" title="后端操作cookie"></a>后端操作cookie</h4><ul><li>说明： response &#x3D; HttpResponse(…) 或 response ＝ render(request, …)</li><li><ol><li>后端设置cookie值： <strong>response.set_cookie</strong>(‘username’,”zhangsan”)</li></ol></li><li><ol><li>后端后去cookie值： <strong>request.COOKIES.get</strong>(‘username’)</li></ol></li></ul><h4 id="设置cookie时常用参数"><a href="#设置cookie时常用参数" class="headerlink" title="设置cookie时常用参数"></a>设置cookie时常用参数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">cookie</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment">#1 获取cookie中username111得值</span></span><br><span class="line">    request.COOKIES.get(<span class="string">&#x27;username111&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#2 设置cookie的值，关闭浏览器失效</span></span><br><span class="line">    response.set_cookie(<span class="string">&#x27;key&#x27;</span>,<span class="string">&quot;value&quot;</span>)</span><br><span class="line">    <span class="comment"># 设置cookie, N秒只后失效</span></span><br><span class="line">    response.set_cookie(<span class="string">&#x27;username111&#x27;</span>,<span class="string">&quot;value&quot;</span>,max_age=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#3 设置cookie, 截止时间失效（expires后面指定那个时间点失效）</span></span><br><span class="line">    <span class="keyword">import</span> datetime</span><br><span class="line">    current_date = datetime.datetime.utcnow()</span><br><span class="line">    exp_date = current_date + datetime.timedelta(seconds=<span class="number">5</span>)         <span class="comment">#seconds指定再过多少秒过期</span></span><br><span class="line">    response.set_cookie(<span class="string">&#x27;username111&#x27;</span>,<span class="string">&quot;value&quot;</span>,expires=exp_date)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#4 设置cookie是可以使用关键字salt对cookie加密（加密解密的salt中值必须相同）</span></span><br><span class="line">    obj = HttpResponse(<span class="string">&#x27;s&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    obj.set_signed_cookie(<span class="string">&#x27;username&#x27;</span>,<span class="string">&quot;kangbazi&quot;</span>,salt=<span class="string">&quot;asdfasdf&quot;</span>)</span><br><span class="line">    request.get_signed_cookie(<span class="string">&#x27;username&#x27;</span>,salt=<span class="string">&quot;asdfasdf&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#5 设置cookie生效路径</span></span><br><span class="line">    path = <span class="string">&#x27;/&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#6 删除cookie中is_login的值</span></span><br><span class="line">    response.delete_cookie(<span class="string">&#x27;is_login&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure><h3 id="使用cookie实现用户登录、注销"><a href="#使用cookie实现用户登录、注销" class="headerlink" title="使用cookie实现用户登录、注销"></a><strong>使用cookie实现用户登录、注销</strong></h3><h4 id="views-py"><a href="#views-py" class="headerlink" title="views.py"></a>views.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render,HttpResponse,redirect</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    username = request.COOKIES.get(<span class="string">&#x27;username&#x27;</span>)        <span class="comment"># 获取cookie</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> username:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/login/&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(username)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        u = request.POST.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        p = request.POST.get(<span class="string">&#x27;pwd&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> u == <span class="string">&#x27;tom&#x27;</span> <span class="keyword">and</span> p == <span class="string">&#x27;123&#x27;</span>:</span><br><span class="line">            res = redirect(<span class="string">&#x27;/index/&#x27;</span>)</span><br><span class="line">            res.set_cookie(<span class="string">&#x27;username&#x27;</span>,u,max_age=<span class="number">500</span>)        <span class="comment"># 设置500s免登陆</span></span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render(request,<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>(<span class="params">req</span>):</span><br><span class="line">    response = redirect(<span class="string">&#x27;/login/&#x27;</span>)</span><br><span class="line">    <span class="comment">#清理cookie里保存username</span></span><br><span class="line">    response.delete_cookie(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure><h4 id="login-html"><a href="#login-html" class="headerlink" title="login.html"></a>login.html</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form action=&quot;/login/&quot; method=&quot;POST&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;text&quot; name=&quot;username&quot; placeholder=&quot;用户名&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;text&quot; name=&quot;pwd&quot; placeholder=&quot;密码&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h3 id="CSRF原理"><a href="#CSRF原理" class="headerlink" title="CSRF原理"></a>CSRF原理</h3><ul><li>1、当用户第一次发送get请求时，服务端不仅给客户端返回get内容，而且中间包含一个随机字符串</li><li>2、这个字符串是加密的，只有服务端自己可以反解</li><li>3、当客户端发送POST请求提交数据时，服务端会验证客户端是否携带这个随机字符串, 没有就会引发csrf错误</li><li>4、如果没有csrf，那么黑客可以通过任意表单向我们的后台提交数据，不安全</li></ul><h2 id="session"><a href="#session" class="headerlink" title="session"></a>session</h2><h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session操作依赖cookie</span><br></pre></td></tr></table></figure><ul><li>1.基于Cookie做用户验证时：敏感信息不适合放在cookie中</li><li>2.用户成功登陆后服务端会生成一个随机字符串并将这个字符串作为字典key，将用户登录信息作为value</li><li>3.当用户再次登陆时就会带着这个随机字符串过来，就不必再输入用户名和密码了</li><li>4.用户使用cookie将这个随机字符串保存到客户端本地，当用户再来时携带这个随机字符串<ul><li>服务端根据这个随机字符串查找对应的session中的值，这样就避免敏感信息泄露</li></ul></li></ul><h4 id="Cookie和Session对比"><a href="#Cookie和Session对比" class="headerlink" title="Cookie和Session对比"></a>Cookie和Session对比</h4><ul><li>1、Cookie是保存在用户浏览器端的键值对</li><li>2、Session是保存在服务器端的键值对</li></ul><h4 id="setting-py配置session"><a href="#setting-py配置session" class="headerlink" title="setting.py配置session"></a>setting.py配置session</h4><ul><li>公用配置</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、SESSION_COOKIE_NAME ＝ &quot;sessionid&quot;          # Session的cookie保存在浏览器上时的key，即：sessionid＝随机字符串（默认）</span></span><br><span class="line"><span class="comment"># 2、SESSION_COOKIE_PATH ＝ &quot;/&quot;                  # Session的cookie保存的路径（默认）</span></span><br><span class="line"><span class="comment"># 3、SESSION_COOKIE_DOMAIN = None                # Session的cookie保存的域名（默认）</span></span><br><span class="line"><span class="comment"># 4、SESSION_COOKIE_SECURE = False               # 是否Https传输cookie（默认）</span></span><br><span class="line"><span class="comment"># 5、SESSION_COOKIE_HTTPONLY = True              # 是否Session的cookie只支持http传输（默认）</span></span><br><span class="line"><span class="comment"># 6、SESSION_COOKIE_AGE = 1209600                # Session的cookie失效日期（2周）（默认）</span></span><br><span class="line"><span class="comment"># 7、SESSION_EXPIRE_AT_BROWSER_CLOSE = False     # 是否关闭浏览器使得Session过期（默认）</span></span><br><span class="line"><span class="comment"># 8、SESSION_SAVE_EVERY_REQUEST = False          # 是否每次请求都保存Session，默认修改之后才保存（默认）</span></span><br><span class="line">                                                 <span class="comment"># 10s 免登陆时，这里必须配置成True</span></span><br></pre></td></tr></table></figure><ul><li>settings.py中配置使用session五种方法</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1 数据库（默认）   #将session数据保存到数据库中</span></span><br><span class="line">SESSION_ENGINE = <span class="string">&#x27;django.contrib.sessions.backends.db&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2 缓存             #将session数据保存到缓存中</span></span><br><span class="line"><span class="comment"># 使用的缓存别名（默认内存缓存，也可以是memcache），此处别名依赖缓存的设置</span></span><br><span class="line"><span class="comment"># &#x27;default&#x27;是下面链接的缓存别名，也可以是另一缓存名&#x27;db1&#x27;</span></span><br><span class="line">SESSION_ENGINE = <span class="string">&#x27;django.contrib.sessions.backends.cache&#x27;</span></span><br><span class="line">SESSION_CACHE_ALIAS = <span class="string">&#x27;default&#x27;</span></span><br><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.core.cache.backends.memcached.MemcachedCache&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;LOCATION&#x27;</span>: [</span><br><span class="line">            <span class="string">&#x27;172.19.26.240:11211&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;172.19.26.242:11211&#x27;</span>,</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;db1&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.core.cache.backends.memcached.MemcachedCache&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;LOCATION&#x27;</span>: [</span><br><span class="line">            <span class="string">&#x27;172.19.26.240:11211&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;172.19.26.242:11211&#x27;</span>,</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#3 文件Session</span></span><br><span class="line"><span class="comment"># 缓存文件路径，如果为None，则使用tempfile模块获取一个临时地址tempfile.gettempdir()</span></span><br><span class="line"><span class="comment"># 如：/var/folders/d3/j9tj0gz93dg06bmwxmhh6_xm0000gn/T把他当做session目录</span></span><br><span class="line">SESSION_ENGINE = <span class="string">&#x27;django.contrib.sessions.backends.file&#x27;</span></span><br><span class="line">SESSION_FILE_PATH = os.path.join(BASE_DIR,<span class="string">&#x27;cache&#x27;</span>)          <span class="comment">#保存session的文件夹目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#4 缓存+数据库Session        #默认到缓存中拿session数据，没有再到数据库中取</span></span><br><span class="line">SESSION_ENGINE = <span class="string">&#x27;django.contrib.sessions.backends.cached_db&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#5 加密cookie Session        #其实质使用的是cookie，将数据放到了客户端，但是数据经过了加密</span></span><br><span class="line">SESSION_ENGINE = <span class="string">&#x27;django.contrib.sessions.backends.signed_cookies&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="操作session"><a href="#操作session" class="headerlink" title="操作session"></a>操作session</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">index11</span>(<span class="params">request</span>):                <span class="comment">#request.session中存放了所有用户信息</span></span><br><span class="line">    <span class="comment">#1 获取   Session中数据</span></span><br><span class="line">    request.session[<span class="string">&#x27;k1&#x27;</span>]</span><br><span class="line">    request.session.get(<span class="string">&#x27;k1&#x27;</span>,<span class="literal">None</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#2 设置</span></span><br><span class="line">    request.session[<span class="string">&#x27;k1&#x27;</span>] = <span class="number">123</span></span><br><span class="line">    request.session.setdefault(<span class="string">&#x27;k1&#x27;</span>,<span class="number">123</span>)    <span class="comment"># 存在则不设置</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#3 删除</span></span><br><span class="line">    <span class="keyword">del</span> request.session[<span class="string">&#x27;k1&#x27;</span>]               <span class="comment">#删除某个键值对</span></span><br><span class="line">    <span class="comment">#删除某用户登录时在数据库生成的随机字符串的整条数据全部删除</span></span><br><span class="line">    request.session.delete(<span class="string">&quot;session_key&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#4 注销  当用户注销时使用request.session.clear()</span></span><br><span class="line">    request.session.clear()         <span class="comment">#这个短句相当于下面这个长句</span></span><br><span class="line">    request.session.delete(request.session.session_key)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#5 设置超时时间（默认超时时间两周）</span></span><br><span class="line">    request.session.set_expiry(<span class="string">&quot;value&quot;</span>)</span><br><span class="line">    <span class="comment"># 如果value是个整数，session会在些秒数后失效。</span></span><br><span class="line">    <span class="comment"># 如果value是个datatime或timedelta，session就会在这个时间后失效。</span></span><br><span class="line">    <span class="comment"># 如果value是0,用户关闭浏览器session就会失效。</span></span><br><span class="line">    <span class="comment"># 如果value是None,session会依赖全局session失效策略。</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 所有 键、值、键值对</span></span><br><span class="line">    request.session.keys()</span><br><span class="line">    request.session.values()</span><br><span class="line">    request.session.items()</span><br><span class="line">    request.session.iterkeys()</span><br><span class="line">    request.session.itervalues()</span><br><span class="line">    request.session.iteritems()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 获取某个用户session的随机字符串（不常用）</span></span><br><span class="line">    request.session.session_key</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 将所有Session失效日期小于当前日期的数据删除（数据库中可以设置超时时间）</span></span><br><span class="line">    request.session.clear_expired()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查 用户session的随机字符串 在数据库中是否存在（不常用）</span></span><br><span class="line">    request.session.exists(<span class="string">&quot;session_key&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="session登录和注销"><a href="#session登录和注销" class="headerlink" title="session登录和注销"></a>session登录和注销</h3><ul><li><code>session实现用户十秒免登陆，以及注销功能</code></li></ul><h4 id="主要功能说明"><a href="#主要功能说明" class="headerlink" title="主要功能说明"></a>主要功能说明</h4><ul><li>1.session默认使用数据库session，使用前必须先执行下面命令<ul><li>python manage.py makemigrations</li><li>python manage.py migrate</li></ul></li><li>2.settings.py中配置每次用户访问都会推辞更新时间<ul><li>SESSION_SAVE_EVERY_REQUEST &#x3D; True</li></ul></li><li>3.实现10s免登陆关键步骤<ul><li>1）设置session ： request.session[‘is_login’] &#x3D; True</li><li>2）设置10s超时： request.session.set_expiry(10)</li><li>3）获取session ： request.session.get(‘is_login’)</li></ul></li></ul><h4 id="views-py-1"><a href="#views-py-1" class="headerlink" title="views.py"></a>views.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render,HttpResponse,redirect</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.session.get(<span class="string">&#x27;is_login&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">&#x27;index.html&#x27;</span>,&#123;<span class="string">&#x27;username&#x27;</span>:request.session.get(<span class="string">&#x27;username&#x27;</span>)&#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;滚&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        user = request.POST.get(<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line">        pwd = request.POST.get(<span class="string">&#x27;pwd&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> user == <span class="string">&#x27;tom&#x27;</span> <span class="keyword">and</span> pwd == <span class="string">&#x27;123&#x27;</span>:</span><br><span class="line">            <span class="comment">#1 生成随机字符串</span></span><br><span class="line">            <span class="comment">#2 写到用户浏览器cookie</span></span><br><span class="line">            <span class="comment">#3 保存到session中</span></span><br><span class="line">            <span class="comment">#4 在随机字符串对应的字典中设置相关内容</span></span><br><span class="line">            <span class="comment">#5 有等号设置session键值对，没有等号获取键的值</span></span><br><span class="line"></span><br><span class="line">            request.session[<span class="string">&#x27;username&#x27;</span>]=user       <span class="comment">#1 用户登录成功设置用户名</span></span><br><span class="line"></span><br><span class="line">            request.session[<span class="string">&#x27;is_login&#x27;</span>] = <span class="literal">True</span>     <span class="comment">#2 登陆成功时可以设置一个标志</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> request.POST.get(<span class="string">&#x27;rmb&#x27;</span>) == <span class="string">&#x27;1&#x27;</span>:     <span class="comment">#3 当勾选checkbox框后设置10秒超时</span></span><br><span class="line">                request.session.set_expiry(<span class="number">10</span>)     <span class="comment">#4 设置10s后超时，需要重新登录</span></span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">&#x27;/index&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render(request,<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>(<span class="params">request</span>):</span><br><span class="line">    request.session.clear()                         <span class="comment">#5 访问&#x27;/logout/&#x27;时注销登陆</span></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/login/&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="login-html-1"><a href="#login-html-1" class="headerlink" title="login.html"></a>login.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/login/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;pwd&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;rmb&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span>十秒免登陆</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="index-html"><a href="#index-html" class="headerlink" title="index.html"></a>index.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢饮登陆：&#123;&#123; username &#125;&#125;,&#123;&#123; request.session.username &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/logout/&quot;</span>&gt;</span>注销<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="settings-py"><a href="#settings-py" class="headerlink" title="settings.py"></a>settings.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SESSION_SAVE_EVERY_REQUEST = <span class="literal">True</span></span><br></pre></td></tr></table></figure><h1 id="model以及数据连接"><a href="#model以及数据连接" class="headerlink" title="model以及数据连接"></a>model以及数据连接</h1><h2 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h2><h3 id="创建mysql库"><a href="#创建mysql库" class="headerlink" title="创建mysql库"></a>创建mysql库</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;  create database testdb charset utf8;       <span class="comment"># 创建数据库</span></span><br><span class="line">mysql&gt;  drop database testdb;                 <span class="comment"># 删除数据库</span></span><br><span class="line">mysql&gt;  show databases;                     <span class="comment"># 查看刚刚创建的数据库</span></span><br></pre></td></tr></table></figure><h3 id="创建用户并授权"><a href="#创建用户并授权" class="headerlink" title="创建用户并授权"></a>创建用户并授权</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 1、创建用户</span><br><span class="line">create user &#x27;django&#x27;@&#x27;%&#x27; identified by &#x27;123456&#x27;;</span><br><span class="line"></span><br><span class="line"># 2、授予django用户授予对 testdb 数据库的操作权限</span><br><span class="line">GRANT ALL ON testdb.* TO &#x27;django&#x27;@&#x27;%&#x27;;</span><br><span class="line">flush privileges;</span><br><span class="line">select host,user from mysql.user;</span><br><span class="line"></span><br><span class="line"># 3、删除用户</span><br><span class="line">Delete FROM mysql.user Where User=&#x27;django&#x27; and Host=”localhost”; </span><br><span class="line">Delete FROM mysql.user Where User=&#x27;django&#x27;; </span><br></pre></td></tr></table></figure><h2 id="配置django"><a href="#配置django" class="headerlink" title="配置django"></a>配置django</h2><h3 id="安装PyMySQL"><a href="#安装PyMySQL" class="headerlink" title="安装PyMySQL"></a>安装PyMySQL</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install PyMySQL</span><br></pre></td></tr></table></figure><h3 id="主动修改为pymysql"><a href="#主动修改为pymysql" class="headerlink" title="主动修改为pymysql"></a>主动修改为pymysql</h3><ul><li>Django默认使用MySQLdb模块链接MySQL，但在python3中还没有MySQLdb</li><li>主动修改为pymysql，在project同名文件夹下的__init__文件中添加如下代码即可</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymysql <span class="keyword">import</span> install_as_MySQLdb</span><br><span class="line">install_as_MySQLdb()</span><br></pre></td></tr></table></figure><h3 id="修改DATABASES配置"><a href="#修改DATABASES配置" class="headerlink" title="修改DATABASES配置"></a>修改DATABASES配置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;testdb&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>: <span class="string">&#x27;django&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>: <span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>: <span class="string">&#x27;123.56.94.237&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>: <span class="string">&#x27;3306&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure><h2 id="定义模型"><a href="#定义模型" class="headerlink" title="定义模型"></a>定义模型</h2><h2 id="定义模型举例"><a href="#定义模型举例" class="headerlink" title="定义模型举例"></a>定义模型举例</h2><ul><li>模型类被定义在”应用&#x2F;models.py”文件中。</li><li>模型类必须继承自Model类，位于包django.db.models中。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment">#定义图书模型类BookInfo</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookInfo</span>(models.Model):</span><br><span class="line">    btitle = models.CharField(max_length=<span class="number">20</span>, verbose_name=<span class="string">&#x27;名称&#x27;</span>)</span><br><span class="line">    bpub_date = models.DateField(verbose_name=<span class="string">&#x27;发布日期&#x27;</span>)</span><br><span class="line">    bread = models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">&#x27;阅读量&#x27;</span>)</span><br><span class="line">    bcomment = models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">&#x27;评论量&#x27;</span>)</span><br><span class="line">    is_delete = models.BooleanField(default=<span class="literal">False</span>, verbose_name=<span class="string">&#x27;逻辑删除&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        db_table = <span class="string">&#x27;tb_books&#x27;</span>  <span class="comment"># 指明数据库表名</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;图书&#x27;</span>  <span class="comment"># 在admin站点中显示的名称</span></span><br><span class="line">        verbose_name_plural = verbose_name  <span class="comment"># 显示的复数名称</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;定义每个数据对象的显示信息&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.btitle</span><br><span class="line"></span><br><span class="line"><span class="comment">#定义英雄模型类HeroInfo</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HeroInfo</span>(models.Model):</span><br><span class="line">    GENDER_CHOICES = (</span><br><span class="line">        (<span class="number">0</span>, <span class="string">&#x27;female&#x27;</span>),</span><br><span class="line">        (<span class="number">1</span>, <span class="string">&#x27;male&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">    hname = models.CharField(max_length=<span class="number">20</span>, verbose_name=<span class="string">&#x27;名称&#x27;</span>) </span><br><span class="line">    hgender = models.SmallIntegerField(choices=GENDER_CHOICES, default=<span class="number">0</span>, verbose_name=<span class="string">&#x27;性别&#x27;</span>)  </span><br><span class="line">    hcomment = models.CharField(max_length=<span class="number">200</span>, null=<span class="literal">True</span>, verbose_name=<span class="string">&#x27;描述信息&#x27;</span>) </span><br><span class="line">    hbook = models.ForeignKey(BookInfo, on_delete=models.CASCADE, verbose_name=<span class="string">&#x27;图书&#x27;</span>)  <span class="comment"># 外键</span></span><br><span class="line">    is_delete = models.BooleanField(default=<span class="literal">False</span>, verbose_name=<span class="string">&#x27;逻辑删除&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        db_table = <span class="string">&#x27;tb_heros&#x27;</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;英雄&#x27;</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.hname</span><br></pre></td></tr></table></figure><h3 id="源信息Meta"><a href="#源信息Meta" class="headerlink" title="源信息Meta"></a>源信息Meta</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserInfo</span>(models.Model):</span><br><span class="line">        username = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">        password = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">            <span class="comment">#1 数据库中生成的表名称 默认 app名称 + 下划线 + 类名</span></span><br><span class="line">            db_table = <span class="string">&quot;table_name&quot;</span>     <span class="comment">#自己指定创建的表名</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">#2 Django Admin 中显示的表名称</span></span><br><span class="line">            verbose_name=<span class="string">&#x27;user&#x27;</span>          <span class="comment">#在Django admin后台显示时表名是users</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">#3 verbose_name加s</span></span><br><span class="line">            verbose_name_plural=<span class="string">&#x27;user&#x27;</span>  <span class="comment">#若果这个字段也是user那么4中表名才显示user</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">#4 联合唯一索引</span></span><br><span class="line">            unique_together = ((<span class="string">&quot;name&quot;</span>, <span class="string">&quot;password&quot;</span>),)</span><br><span class="line"></span><br><span class="line">            <span class="comment">#5 联合索引   (缺点是最左前缀，写SQL语句基于password时不能命中索引，查找慢)</span></span><br><span class="line">            <span class="comment">#  如：select * from tb where password = ‘xx’    就无法命中索引</span></span><br><span class="line">            index_together = [</span><br><span class="line">                (<span class="string">&quot;name&quot;</span>, <span class="string">&quot;password&quot;</span>),</span><br><span class="line">            ]</span><br><span class="line"><span class="comment"># 更多：https://docs.djangoproject.com/en/1.10/ref/models/options/</span></span><br></pre></td></tr></table></figure><h3 id="字段"><a href="#字段" class="headerlink" title="字段"></a>字段</h3><h4 id="常用字段"><a href="#常用字段" class="headerlink" title="常用字段"></a>常用字段</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserGroup</span>(models.Model):</span><br><span class="line">    uid = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>,null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    email = models.EmailField(max_length=<span class="number">32</span>)</span><br><span class="line">    text = models.TextField()</span><br><span class="line"></span><br><span class="line">    ctime = models.DateTimeField(auto_now_add=<span class="literal">True</span>)      <span class="comment"># 只有添加时才会更新时间</span></span><br><span class="line">    uptime = models.DateTimeField(auto_now=<span class="literal">True</span>)         <span class="comment"># 只要修改就会更新时间</span></span><br><span class="line"></span><br><span class="line">    ip1 = models.IPAddressField()               <span class="comment"># 字符串类型，Django Admin以及ModelForm中提供验证 IPV4 机制</span></span><br><span class="line">    ip2 = models.GenericIPAddressField()           <span class="comment"># 字符串类型，Django Admin以及ModelForm中提供验证 Ipv4和Ipv6</span></span><br><span class="line"></span><br><span class="line">    active = models.BooleanField(default=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    data01 = models.DateTimeField()              <span class="comment"># 日期+时间格式 YYYY-MM-DD HH:MM[:ss[.uuuuuu]][TZ</span></span><br><span class="line">    data02 = models.DateField()                 <span class="comment"># 日期格式      YYYY-MM-DD</span></span><br><span class="line">    data03 = models.TimeField()                 <span class="comment"># 时间格式      HH:MM[:ss[.uuuuuu]]</span></span><br><span class="line"></span><br><span class="line">    age = models.PositiveIntegerField()           <span class="comment"># 正小整数 0 ～ 32767</span></span><br><span class="line">    balance = models.SmallIntegerField()          <span class="comment"># 小整数 -32768 ～ 32767</span></span><br><span class="line">    money = models.PositiveIntegerField()         <span class="comment"># 正整数 0 ～ 2147483647</span></span><br><span class="line">    bignum = models.BigIntegerField()           <span class="comment"># 长整型(有符号的) -9223372036854775808 ～ 9223372036854775807</span></span><br><span class="line">    </span><br><span class="line">    user_type_choices = (</span><br><span class="line">        (<span class="number">1</span>, <span class="string">&quot;超级用户&quot;</span>),</span><br><span class="line">        (<span class="number">2</span>, <span class="string">&quot;普通用户&quot;</span>),</span><br><span class="line">        (<span class="number">3</span>, <span class="string">&quot;普普通用户&quot;</span>),</span><br><span class="line">    )</span><br><span class="line">    user_type_id = models.IntegerField(choices=user_type_choices, default=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h4 id="不常用字段"><a href="#不常用字段" class="headerlink" title="不常用字段"></a>不常用字段</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">URLField(CharField)</span><br><span class="line">    - 字符串类型，Django Admin以及ModelForm中提供验证 URL</span><br><span class="line"></span><br><span class="line">SlugField(CharField)</span><br><span class="line">    - 字符串类型，Django Admin以及ModelForm中提供验证支持 字母、数字、下划线、连接符（减号）</span><br><span class="line"></span><br><span class="line">CommaSeparatedIntegerField(CharField)</span><br><span class="line">    - 字符串类型，格式必须为逗号分割的数字</span><br><span class="line"></span><br><span class="line">UUIDField(Field)</span><br><span class="line">    - 字符串类型，Django Admin以及ModelForm中提供对UUID格式的验证</span><br><span class="line"></span><br><span class="line">FilePathField(Field)</span><br><span class="line">    - 字符串，Django Admin以及ModelForm中提供读取文件夹下文件的功能</span><br><span class="line">    - 参数：</span><br><span class="line">            path,                      文件夹路径</span><br><span class="line">            <span class="keyword">match</span>=<span class="literal">None</span>,                正则匹配</span><br><span class="line">            recursive=<span class="literal">False</span>,           递归下面的文件夹</span><br><span class="line">            allow_files=<span class="literal">True</span>,          允许文件</span><br><span class="line">            allow_folders=<span class="literal">False</span>,       允许文件夹</span><br><span class="line"></span><br><span class="line">FileField(Field)</span><br><span class="line">    - 字符串，路径保存在数据库，文件上传到指定目录</span><br><span class="line">    - 参数：</span><br><span class="line">        upload_to = <span class="string">&quot;&quot;</span>      上传文件的保存路径</span><br><span class="line">        storage = <span class="literal">None</span>      存储组件，默认django.core.files.storage.FileSystemStorage</span><br><span class="line"></span><br><span class="line">ImageField(FileField)</span><br><span class="line">    - 字符串，路径保存在数据库，文件上传到指定目录</span><br><span class="line">    - 参数：</span><br><span class="line">        upload_to = <span class="string">&quot;&quot;</span>      上传文件的保存路径</span><br><span class="line">        storage = <span class="literal">None</span>      存储组件，默认django.core.files.storage.FileSystemStorage</span><br><span class="line">        width_field=<span class="literal">None</span>,   上传图片的高度保存的数据库字段名（字符串）</span><br><span class="line">        height_field=<span class="literal">None</span>   上传图片的宽度保存的数据库字段名（字符串）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DurationField(Field)</span><br><span class="line">    - 长整数，时间间隔，数据库中按照bigint存储，ORM中获取的值为datetime.timedelta类型</span><br><span class="line"></span><br><span class="line">FloatField(Field)</span><br><span class="line">    - 浮点型</span><br><span class="line"></span><br><span class="line">DecimalField(Field)</span><br><span class="line">    - <span class="number">10</span>进制小数</span><br><span class="line">    - 参数：</span><br><span class="line">        max_digits，小数总长度</span><br><span class="line">        decimal_places，小数位长度</span><br><span class="line"></span><br><span class="line">BinaryField(Field)</span><br><span class="line">    - 二进制类型</span><br></pre></td></tr></table></figure><h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><table><thead><tr><th align="left">选项</th><th>说明</th></tr></thead><tbody><tr><td align="left">null</td><td>如果为True，表示允许为空，默认值是False</td></tr><tr><td align="left">blank</td><td>如果为True，则该字段允许为空白，默认值是False</td></tr><tr><td align="left">db_column</td><td>字段的名称，如果未指定，则使用属性的名称</td></tr><tr><td align="left">db_index</td><td>若值为True, 则在表中会为此字段创建索引，默认值是False</td></tr><tr><td align="left">default</td><td>默认</td></tr><tr><td align="left">primary_key</td><td>若为True，则该字段会成为模型的主键字段，默认值是False，一般作为AutoField的选项使用</td></tr><tr><td align="left">unique</td><td>如果为True, 这个字段在表中必须有唯一值，默认值是False</td></tr><tr><td align="left">related_name</td><td>在关联查询中,代替单一对象查找多对象 对象名小写_set(book.heroinfo_set.all() 的写法</td></tr><tr><td align="left">auto_now_add</td><td>只在数据添加的时候,记录时间</td></tr><tr><td align="left">auto_now</td><td>数据添加和更新的时候,记录时间</td></tr></tbody></table><h2 id="一对多创建表"><a href="#一对多创建表" class="headerlink" title="一对多创建表"></a>一对多创建表</h2><h3 id="创建一对多表"><a href="#创建一对多表" class="headerlink" title="创建一对多表"></a>创建一对多表</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserInfo</span>(models.Model):</span><br><span class="line">    name = models.CharField(max_length=<span class="number">64</span>,unique=<span class="literal">True</span>)</span><br><span class="line">    ut = models.ForeignKey(to=<span class="string">&#x27;UserType&#x27;</span>, on_delete=models.CASCADE)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        db_table = <span class="string">&#x27;tb_userinfo&#x27;</span>           <span class="comment"># 指明数据库表名</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;用户信息&#x27;</span>        <span class="comment"># 在admin站点中显示的名称</span></span><br><span class="line">        verbose_name_plural = verbose_name   <span class="comment"># 显示的复数名称</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;定义每个数据对象的显示信息&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.name</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserType</span>(models.Model):</span><br><span class="line">    type_name = models.CharField(max_length=<span class="number">64</span>,unique=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        db_table = <span class="string">&#x27;tb_usertype&#x27;</span>                <span class="comment"># 指明数据库表名</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;用户类型&#x27;</span>             <span class="comment"># 在admin站点中显示的名称</span></span><br><span class="line">        verbose_name_plural = verbose_name   <span class="comment"># 显示的复数名称</span></span><br></pre></td></tr></table></figure><h3 id="可选参数"><a href="#可选参数" class="headerlink" title="可选参数"></a>可选参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、to,                                <span class="comment"># 要进行关联的表名</span></span><br><span class="line"><span class="number">2</span>、to_field=<span class="literal">None</span>,                        <span class="comment"># 要关联的表中的字段名称</span></span><br><span class="line"><span class="number">3</span>、on_delete=<span class="literal">None</span>,                        <span class="comment"># 当删除关联表中的数据时，当前表与其关联的行的行为</span></span><br><span class="line">      - models.CASCADE             <span class="comment"># ，删除关联数据，与之关联也删除</span></span><br><span class="line">      - models.DO_NOTHING           <span class="comment"># ，删除关联数据，引发错误IntegrityError</span></span><br><span class="line">      - models.PROTECT             <span class="comment"># ，删除关联数据，引发错误ProtectedError</span></span><br><span class="line">      - models.SET_NULL            <span class="comment"># ，删除关联数据，与之关联的值设置为null（前提FK字段需要设置为可空）</span></span><br><span class="line">      - models.SET_DEFAULT          <span class="comment"># ，删除关联数据，与之关联的值设置为默认值（前提FK字段需要设置默认值）</span></span><br><span class="line">      - models.SET               <span class="comment"># ，删除关联数据，</span></span><br><span class="line"><span class="number">4</span>、related_name=<span class="literal">None</span>,                     <span class="comment"># 反向操作时，使用的字段名，用于代替 【表名_set】 如： obj.表名_set.all()</span></span><br><span class="line">                                    <span class="comment"># 在做自关联时必须指定此字段，防止查找冲突</span></span><br><span class="line"><span class="number">5</span>、delated_query_name=<span class="literal">None</span>,                  <span class="comment"># 反向操作时，使用的连接前缀，用于替换【表名】</span></span><br><span class="line">                                                <span class="comment"># 如：models.UserGroup.objects.filter(表名__字段名=1).values(&#x27;表名__字段名&#x27;)</span></span><br><span class="line"><span class="number">6</span>、limit_choices_to=<span class="literal">None</span>,                   <span class="comment"># 在Admin或ModelForm中显示关联数据时，提供的条件：</span></span><br><span class="line">            - limit_choices_to=&#123;<span class="string">&#x27;nid__gt&#x27;</span>: <span class="number">5</span>&#125;</span><br><span class="line">            - limit_choices_to=<span class="keyword">lambda</span> : &#123;<span class="string">&#x27;nid__gt&#x27;</span>: <span class="number">5</span>&#125;</span><br><span class="line"><span class="number">7</span>、db_constraint=<span class="literal">True</span>                      <span class="comment"># 是否在数据库中创建外键约束</span></span><br><span class="line"><span class="number">8</span>、parent_link=<span class="literal">False</span>                       <span class="comment"># 在Admin中是否显示关联数据</span></span><br></pre></td></tr></table></figure><h3 id="1-3-一对多基本查询"><a href="#1-3-一对多基本查询" class="headerlink" title="#1.3 一对多基本查询"></a><a target="_blank" rel="noopener" href="http://v5blog.cn/pages/df1ddc/#_1-3-%E4%B8%80%E5%AF%B9%E5%A4%9A%E5%9F%BA%E6%9C%AC%E6%9F%A5%E8%AF%A2">#</a>1.3 一对多基本查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render,HttpResponse</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">orm</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 1 创建</span></span><br><span class="line">    <span class="comment"># 创建数据方法一</span></span><br><span class="line">    models.UserInfo.objects.create(name=<span class="string">&#x27;root&#x27;</span>, ut_id=<span class="number">2</span>)</span><br><span class="line">    <span class="comment"># 创建数据方法二</span></span><br><span class="line">    obj = models.UserInfo(name=<span class="string">&#x27;root&#x27;</span>, ut_id=<span class="number">2</span>)</span><br><span class="line">    obj.save()</span><br><span class="line">    <span class="comment"># 创建数据库方法三(传入字典必须在字典前加两个星号)</span></span><br><span class="line">    dic = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;ut_id&#x27;</span>: <span class="number">2</span>&#125;</span><br><span class="line">    models.UserInfo.objects.create(**dic)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2 删除</span></span><br><span class="line">    <span class="comment"># models.UserInfo.objects.all().delete()  # 删除所有</span></span><br><span class="line">    models.UserInfo.objects.<span class="built_in">filter</span>(name=<span class="string">&#x27;root&#x27;</span>).delete()  <span class="comment"># 删除指定</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3 更新</span></span><br><span class="line">    <span class="comment"># models.UserInfo.objects.all().update(ut_id=1)</span></span><br><span class="line">    <span class="comment"># models.UserInfo.objects.filter(name=&#x27;zhangsan&#x27;).update(ut_id=4)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4.1 正向查找 user_obj.ut.type_name</span></span><br><span class="line">    <span class="built_in">print</span>( models.UserInfo.objects.get(name=<span class="string">&#x27;zhangsan&#x27;</span>).ut.type_name )</span><br><span class="line">    <span class="built_in">print</span>( models.UserInfo.objects.<span class="built_in">filter</span>(ut__type_name=<span class="string">&#x27;student&#x27;</span>) )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4.2 反向查找 type_obj.userinfo_set.all()</span></span><br><span class="line">    <span class="built_in">print</span>( models.UserType.objects.get(type_name=<span class="string">&#x27;student&#x27;</span>).userinfo_set.<span class="built_in">all</span>() )</span><br><span class="line">    <span class="built_in">print</span>( models.UserType.objects.get(type_name=<span class="string">&#x27;student&#x27;</span>).userinfo_set.<span class="built_in">filter</span>(name=<span class="string">&#x27;zhangsan&#x27;</span>) )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;orm&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="正向反向查"><a href="#正向反向查" class="headerlink" title="正向反向查"></a>正向反向查</h2><h3 id="related-query-name设置"><a href="#related-query-name设置" class="headerlink" title="related_query_name设置"></a>related_query_name设置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserType</span>(models.Model):</span><br><span class="line">    user_type_name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.user_type_name            <span class="comment">#只有加上这个，Django admin才会显示表名</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(models.Model):</span><br><span class="line">    username = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    pwd = models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line">    ut = models.ForeignKey(</span><br><span class="line">        to=<span class="string">&#x27;UserType&#x27;</span>,</span><br><span class="line">        to_field=<span class="string">&#x27;id&#x27;</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 1、反向操作时，使用的连接前缀，用于替换【表名】</span></span><br><span class="line">        <span class="comment"># 如： models.UserGroup.objects.filter(a__字段名=1).values(&#x27;a__字段名&#x27;)</span></span><br><span class="line">        related_query_name=<span class="string">&#x27;a&#x27;</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">#2、反向操作时，使用的字段名，用于代替 【表名_set】 如： obj.b_set.all()</span></span><br><span class="line">        <span class="comment"># 使用时查找报错</span></span><br><span class="line">        <span class="comment"># related_name=&#x27;b&#x27;,</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure><h3 id="正向方向查"><a href="#正向方向查" class="headerlink" title="正向方向查"></a>正向方向查</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">orm</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 1 正向查找</span></span><br><span class="line">    <span class="comment">#1.1 正向查找user表用户名</span></span><br><span class="line">    <span class="built_in">print</span>(models.User.objects.get(username=<span class="string">&#x27;zhangsan&#x27;</span>).username)           <span class="comment"># zhangsan</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#1.2 正向跨表查找用户类型</span></span><br><span class="line">    <span class="built_in">print</span>(models.User.objects.get(username=<span class="string">&#x27;zhangsan&#x27;</span>).ut.user_type_name)  <span class="comment"># student</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#1.3 双下划线正向跨表正向查找</span></span><br><span class="line">    <span class="built_in">print</span>( models.User.objects.<span class="built_in">all</span>().values(<span class="string">&#x27;ut__user_type_name&#x27;</span>,<span class="string">&#x27;username&#x27;</span>) )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2 反向查找</span></span><br><span class="line">    <span class="comment"># 2.1：【表名_set】，反向查找user表中用户类型为student 的所有用户</span></span><br><span class="line">    <span class="built_in">print</span>( models.UserType.objects.get(user_type_name=<span class="string">&#x27;student&#x27;</span>).user_set.<span class="built_in">all</span>() )           <span class="comment"># [&lt;User: lisi&gt;, &lt;User: wangwu&gt;]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.2：【a__字段名】反向查找user表中张三在UserType表中的类型：（[&lt;UserType: teacher&gt;]）</span></span><br><span class="line">    <span class="built_in">print</span>( models.UserType.objects.<span class="built_in">filter</span>(a__username=<span class="string">&#x27;zhangsan&#x27;</span>) )                         <span class="comment"># student</span></span><br><span class="line">    <span class="comment"># 这里的a是user表的ForeignKey字段的参数：related_query_name=&#x27;a&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.3: 双下划线跨表反向查找</span></span><br><span class="line">    <span class="built_in">print</span>( models.UserType.objects.<span class="built_in">all</span>().values(<span class="string">&#x27;a__username&#x27;</span>, <span class="string">&#x27;user_type_name&#x27;</span>) )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3 自动创建User表和UserType表中的数据</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    username = [&#123;&#x27;username&#x27;:&#x27;zhangsan&#x27;,&#x27;pwd&#x27;:&#x27;123&#x27;,&#x27;ut_id&#x27;:&#x27;1&#x27;&#125;,</span></span><br><span class="line"><span class="string">                &#123;&#x27;username&#x27;:&#x27;lisi&#x27;,&#x27;pwd&#x27;:&#x27;123&#x27;,&#x27;ut_id&#x27;:&#x27;1&#x27;&#125;,</span></span><br><span class="line"><span class="string">                &#123;&#x27;username&#x27;:&#x27;wangwu&#x27;,&#x27;pwd&#x27;:&#x27;123&#x27;,&#x27;ut_id&#x27;:&#x27;1&#x27;&#125;,]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    user_type = [&#123;&#x27;user_type_name&#x27;:&#x27;student&#x27;&#125;,&#123;&#x27;user_type_name&#x27;:&#x27;teacher&#x27;&#125;,]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    for type_dic in user_type:</span></span><br><span class="line"><span class="string">        models.UserType.objects.create(**type_dic)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    for user_dic in username:</span></span><br><span class="line"><span class="string">        models.User.objects.create(**user_dic)</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;orm&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="values和values-list"><a href="#values和values-list" class="headerlink" title="values和values_list"></a>values和values_list</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">orm</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 第一种：values-----获取的内部是字典  拿固定列数</span></span><br><span class="line">    <span class="comment"># 1.1 正向查找： 使用ForeignKey字段名ut结合双下划线查询</span></span><br><span class="line">    models.User.objects.<span class="built_in">filter</span>(username=<span class="string">&#x27;zhangsan&#x27;</span>).values(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;ut__user_type_name&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1.2 向查找： 使用ForeignKey的related_query_name=&#x27;a&#x27;,的字段</span></span><br><span class="line">    models.UserType.objects.<span class="built_in">all</span>().values(<span class="string">&#x27;user_type_name&#x27;</span>, <span class="string">&#x27;a__username&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 第二种：values_list-----获取的是元组  拿固定列数</span></span><br><span class="line">    <span class="comment"># 1.1 正向查找： 使用ForeignKey字段名ut结合双下划线查询</span></span><br><span class="line">    stus = models.User.objects.<span class="built_in">filter</span>(username=<span class="string">&#x27;zhangsan&#x27;</span>).values_list(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;ut__user_type_name&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1.2 反向查找： 使用ForeignKey的related_query_name=&#x27;a&#x27;,的字段</span></span><br><span class="line">    utype = models.UserType.objects.<span class="built_in">all</span>().values_list(<span class="string">&#x27;user_type_name&#x27;</span>, <span class="string">&#x27;a__username&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3 自动创建User表和UserType表中的数据</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    username = [&#123;&#x27;username&#x27;:&#x27;zhangsan&#x27;,&#x27;pwd&#x27;:&#x27;123&#x27;,&#x27;ut_id&#x27;:&#x27;1&#x27;&#125;,</span></span><br><span class="line"><span class="string">                &#123;&#x27;username&#x27;:&#x27;lisi&#x27;,&#x27;pwd&#x27;:&#x27;123&#x27;,&#x27;ut_id&#x27;:&#x27;1&#x27;&#125;,</span></span><br><span class="line"><span class="string">                &#123;&#x27;username&#x27;:&#x27;wangwu&#x27;,&#x27;pwd&#x27;:&#x27;123&#x27;,&#x27;ut_id&#x27;:&#x27;1&#x27;&#125;,]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    user_type = [&#123;&#x27;user_type_name&#x27;:&#x27;student&#x27;&#125;,&#123;&#x27;user_type_name&#x27;:&#x27;teacher&#x27;&#125;,]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    for type_dic in user_type:</span></span><br><span class="line"><span class="string">        models.UserType.objects.create(**type_dic)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    for user_dic in username:</span></span><br><span class="line"><span class="string">        models.User.objects.create(**user_dic)</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;orm&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h2><h3 id="不创建第三张表推荐-法1"><a href="#不创建第三张表推荐-法1" class="headerlink" title="不创建第三张表推荐(法1)"></a>不创建第三张表<code>推荐</code>(法1)</h3><ul><li><strong>第一种</strong>： 自己不创建第三张关系表，有m2m字段: 根据queryset对象增删改查（<strong>推荐</strong>）</li></ul><h4 id="创建表-1"><a href="#创建表-1" class="headerlink" title="创建表"></a>创建表</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserInfo</span>(models.Model):</span><br><span class="line">    username = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.username</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserGroup</span>(models.Model):</span><br><span class="line">    group_name = models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line">    user_info = models.ManyToManyField(to=<span class="string">&#x27;UserInfo&#x27;</span>,related_query_name=<span class="string">&#x27;m2m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.group_name</span><br><span class="line"><span class="number">13</span></span><br></pre></td></tr></table></figure><h4 id="根据queryset对象操作"><a href="#根据queryset对象操作" class="headerlink" title="根据queryset对象操作"></a>根据queryset对象操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">orm</span>(<span class="params">request</span>):</span><br><span class="line">    user_info_obj = models.UserInfo.objects.get(username=<span class="string">&#x27;zhangsan&#x27;</span>)</span><br><span class="line">    user_info_objs = models.UserInfo.objects.<span class="built_in">all</span>()</span><br><span class="line"></span><br><span class="line">    group_obj = models.UserGroup.objects.get(group_name=<span class="string">&#x27;group_python&#x27;</span>)</span><br><span class="line">    group_objs = models.UserGroup.objects.<span class="built_in">all</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加: 正向</span></span><br><span class="line">    group_obj.user_info.add(user_info_obj)</span><br><span class="line">    group_obj.user_info.add(*user_info_objs)</span><br><span class="line">    <span class="comment"># 删除：正向</span></span><br><span class="line">    group_obj.user_info.remove(user_info_obj)</span><br><span class="line">    group_obj.user_info.remove(*user_info_objs)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加: 反向</span></span><br><span class="line">    user_info_obj.usergroup_set.add(group_obj)</span><br><span class="line">    user_info_obj.usergroup_set.add(*group_objs)</span><br><span class="line">    <span class="comment"># 删除：反向</span></span><br><span class="line">    user_info_obj.usergroup_set.remove(group_obj)</span><br><span class="line">    user_info_obj.usergroup_set.remove(*group_objs)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查找：正向</span></span><br><span class="line">    <span class="built_in">print</span>(group_obj.user_info.<span class="built_in">all</span>())                                <span class="comment"># 查找group_python组中所有用户</span></span><br><span class="line">    <span class="built_in">print</span>(group_obj.user_info.<span class="built_in">all</span>().<span class="built_in">filter</span>(username=<span class="string">&#x27;zhangsan&#x27;</span>))</span><br><span class="line">    <span class="comment"># 查找：反向</span></span><br><span class="line">    <span class="built_in">print</span>(user_info_obj.usergroup_set.<span class="built_in">all</span>())                        <span class="comment"># 查找用户zhangsan属于那些组</span></span><br><span class="line">    <span class="built_in">print</span>(user_info_obj.usergroup_set.<span class="built_in">all</span>().<span class="built_in">filter</span>(group_name=<span class="string">&#x27;group_python&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 双下划线 正向、反向查找</span></span><br><span class="line">    <span class="comment"># 正向：从用户组表中查找zhangsan属于哪个用户组：[&lt;UserGroup: group_python&gt;]</span></span><br><span class="line">    <span class="built_in">print</span>( models.UserGroup.objects.<span class="built_in">filter</span>(user_info__username=<span class="string">&#x27;zhangsan&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 反向：从用户表中查询group_python组中有哪些用户：related_query_name=&#x27;m2m&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>( models.UserInfo.objects.<span class="built_in">filter</span>(m2m__group_name=<span class="string">&#x27;group_python&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 自动创建UserInfo表和UserGroup表中的数据</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    user_list = [&#123;&#x27;username&#x27;:&#x27;zhangsan&#x27;&#125;,</span></span><br><span class="line"><span class="string">                &#123;&#x27;username&#x27;:&#x27;lisi&#x27;&#125;,</span></span><br><span class="line"><span class="string">                &#123;&#x27;username&#x27;:&#x27;wangwu&#x27;&#125;,]</span></span><br><span class="line"><span class="string">    group_list = [&#123;&#x27;group_name&#x27;:&#x27;group_python&#x27;&#125;,</span></span><br><span class="line"><span class="string">               &#123;&#x27;group_name&#x27;:&#x27;group_linux&#x27;&#125;,</span></span><br><span class="line"><span class="string">               &#123;&#x27;group_name&#x27;:&#x27;group_mysql&#x27;&#125;,]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    for c in user_list:</span></span><br><span class="line"><span class="string">        models.UserInfo.objects.create(**c)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    for l in group_list:</span></span><br><span class="line"><span class="string">        models.UserGroup.objects.create(**l)</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;orm&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="自己创建第三张关系表-法2"><a href="#自己创建第三张关系表-法2" class="headerlink" title="自己创建第三张关系表(法2)"></a>自己创建第三张关系表(法2)</h3><ul><li><strong>第二种</strong>： 自己创建第三张关系表，无 m2m 字段，自己链表查询</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment">#表1：主机表</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Host</span>(models.Model):</span><br><span class="line">    nid = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    hostname = models.CharField(max_length=<span class="number">32</span>,db_index=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#表2：应用表</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Application</span>(models.Model):</span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#表3：自定义第三张关联表</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HostToApp</span>(models.Model):</span><br><span class="line">    hobj = models.ForeignKey(to=<span class="string">&quot;Host&quot;</span>,to_field=<span class="string">&quot;nid&quot;</span>)</span><br><span class="line">    aobj = models.ForeignKey(to=<span class="string">&#x27;Application&#x27;</span>,to_field=<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 向第三张表插入数据，建立多对多外键关联</span></span><br><span class="line">HostToApp.objects.create(hobj_id=<span class="number">1</span>,aobj_id=<span class="number">2</span>)</span><br></pre></td></tr></table></figure><h3 id="根据外检ID操作-法3"><a href="#根据外检ID操作-法3" class="headerlink" title="根据外检ID操作(法3)"></a>根据外检ID操作(法3)</h3><ul><li><strong>第三种</strong>： 自己不创建第三张关系表，有m2m字段: 根据数字id增删改查</li></ul><h4 id="创建表-2"><a href="#创建表-2" class="headerlink" title="创建表"></a>创建表</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Host</span>(models.Model):</span><br><span class="line">    hostname = models.CharField(max_length=<span class="number">32</span>,db_index=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Group</span>(models.Model):</span><br><span class="line">    group_name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    m2m = models.ManyToManyField(<span class="string">&quot;Host&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="根据id增删改查"><a href="#根据id增删改查" class="headerlink" title="根据id增删改查"></a>根据id增删改查</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">orm</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 使用间接方法对第三张表操作</span></span><br><span class="line">    obj = models.Group.objects.get(<span class="built_in">id</span>=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1、添加</span></span><br><span class="line">    obj.m2m.add(<span class="number">1</span>)           <span class="comment"># 在第三张表中增加一个条目(1,1)</span></span><br><span class="line">    obj.m2m.add(<span class="number">2</span>, <span class="number">3</span>)        <span class="comment"># 在第三张表中增加条目（1,2）（1,3）两条关系</span></span><br><span class="line">    obj.m2m.add(*[<span class="number">1</span>,<span class="number">3</span>])        <span class="comment"># 在第三张表中增加条目（1,2）（1,3）两条关系</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2、删除</span></span><br><span class="line">    obj.m2m.remove(<span class="number">1</span>)             <span class="comment"># 删除第三张表中的（1,1）条目</span></span><br><span class="line">    obj.m2m.remove(<span class="number">2</span>, <span class="number">3</span>)          <span class="comment"># 删除第三张表中的（1,2）（1,3）条目</span></span><br><span class="line">    obj.m2m.remove(*[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])    <span class="comment"># 删除第三张表中的（1,1）（1,2）（1,3）条目</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3、清空</span></span><br><span class="line">    obj.m2m.clear()                 <span class="comment"># 删除第三张表中application条目等于1的所有条目</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4 更新</span></span><br><span class="line">    obj.m2m.<span class="built_in">set</span>([<span class="number">1</span>, <span class="number">2</span>,])             <span class="comment"># 第三张表中会删除所有条目，然后创建（1,1）（1,2）条目</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5 查找</span></span><br><span class="line">    <span class="built_in">print</span>( obj.m2m.<span class="built_in">all</span>() )           <span class="comment"># 等价于 models.UserInfo.objects.all()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6 反向查找： 双下划线</span></span><br><span class="line">    hosts = models.Group.objects.<span class="built_in">filter</span>(m2m__id=<span class="number">1</span>)         <span class="comment"># 在Host表中id=1的主机同时属于那些组</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 自动创建Host表和Group表中的数据</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    hostname = [&#123;&#x27;hostname&#x27;:&#x27;zhangsan&#x27;&#125;,</span></span><br><span class="line"><span class="string">                &#123;&#x27;hostname&#x27;:&#x27;lisi&#x27;&#125;,</span></span><br><span class="line"><span class="string">                &#123;&#x27;hostname&#x27;:&#x27;wangwu&#x27;&#125;,]</span></span><br><span class="line"><span class="string">    group_name = [&#123;&#x27;group_name&#x27;:&#x27;DBA&#x27;&#125;,&#123;&#x27;group_name&#x27;:&#x27;public&#x27;&#125;,]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    for h in hostname:</span></span><br><span class="line"><span class="string">        models.Host.objects.create(**h)</span></span><br><span class="line"><span class="string">    for u in group_name:</span></span><br><span class="line"><span class="string">        models.Group.objects.create(**u)</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;orm&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="ManyToManyField参数"><a href="#ManyToManyField参数" class="headerlink" title="ManyToManyField参数"></a>ManyToManyField参数</h2><ul><li>创建m2m多对多时ManyToManyField可以添加的参数</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、to,                        <span class="comment"># 要进行关联的表名</span></span><br><span class="line"><span class="number">2</span>、related_name=<span class="literal">None</span>,         <span class="comment"># 反向操作时，使用的字段名，用于代替 【表名_set】如： obj.表名_set.all()</span></span><br><span class="line"><span class="number">3</span>、related_query_name=<span class="literal">None</span>,   <span class="comment"># 反向操作时，使用的连接前缀，用于替换【表名】     </span></span><br><span class="line">                              <span class="comment"># 如： models.UserGroup.objects.filter(表名__字段名=1).values(&#x27;表名__字段名&#x27;)</span></span><br><span class="line"><span class="number">4</span>、limit_choices_to=<span class="literal">None</span>,     <span class="comment"># 在Admin或ModelForm中显示关联数据时，提供的条件：</span></span><br><span class="line">                              <span class="comment"># - limit_choices_to=&#123;&#x27;nid__gt&#x27;: 5&#125;</span></span><br><span class="line"><span class="number">5</span>、symmetrical=<span class="literal">None</span>,          <span class="comment"># 用于多对多自关联，symmetrical用于指定内部是否创建反向操作字段</span></span><br><span class="line"><span class="number">6</span>、through=<span class="literal">None</span>,              <span class="comment"># 自定义第三张表时，使用字段用于指定关系表</span></span><br><span class="line"><span class="number">7</span>、through_fields=<span class="literal">None</span>,       <span class="comment"># 自定义第三张表时，使用字段用于指定关系表中那些字段做多对多关系表</span></span><br><span class="line"><span class="number">8</span>、db_constraint=<span class="literal">True</span>,        <span class="comment"># 是否在数据库中创建外键约束</span></span><br><span class="line">   db_table=<span class="literal">None</span>,             <span class="comment"># 默认创建第三张表时，数据库中表的名称</span></span><br></pre></td></tr></table></figure><h2 id="values和values-list-1"><a href="#values和values-list-1" class="headerlink" title="values和values_list"></a>values和values_list</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">orm</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 第一种：values-----获取的内部是字典,拿固定列数</span></span><br><span class="line">    <span class="comment"># 1.1 正向查找： 使用ManyToManyField字段名user_info结合双下划线查询</span></span><br><span class="line">    models.UserGroup.objects.<span class="built_in">filter</span>(group_name=<span class="string">&#x27;group_python&#x27;</span>).values(<span class="string">&#x27;group_name&#x27;</span>, <span class="string">&#x27;user_info__username&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1.2 反向查找： 使用ManyToManyField的related_query_name=&#x27;m2m&#x27;,的字段</span></span><br><span class="line">    models.UserInfo.objects.<span class="built_in">filter</span>(username=<span class="string">&#x27;zhangsan&#x27;</span>).values(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;m2m__group_name&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 第二种：values_list-----获取的是元组  拿固定列数</span></span><br><span class="line">    <span class="comment"># 2.1 正向查找： 使用ManyToManyField字段名user_info结合双下划线查询</span></span><br><span class="line">    models.UserGroup.objects.<span class="built_in">filter</span>(group_name=<span class="string">&#x27;group_python&#x27;</span>).values_list(<span class="string">&#x27;group_name&#x27;</span>, <span class="string">&#x27;user_info__username&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.2 反向查找： 使用ManyToManyField的related_query_name=&#x27;m2m&#x27;,的字段</span></span><br><span class="line">    lesson = models.UserInfo.objects.<span class="built_in">filter</span>(username=<span class="string">&#x27;zhangsan&#x27;</span>).values_list(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;m2m__group_name&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 自动创建UserInfo表和UserGroup表中的数据</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    # user_info_obj = models.UserInfo.objects.get(username=&#x27;lisi&#x27;)</span></span><br><span class="line"><span class="string">    # user_info_objs = models.UserInfo.objects.all()</span></span><br><span class="line"><span class="string">    #</span></span><br><span class="line"><span class="string">    # group_obj = models.UserGroup.objects.get(group_name=&#x27;group_python&#x27;)</span></span><br><span class="line"><span class="string">    # group_objs = models.UserGroup.objects.all()</span></span><br><span class="line"><span class="string">    #</span></span><br><span class="line"><span class="string">    # group_obj.user_info.add(*user_info_objs)</span></span><br><span class="line"><span class="string">    # user_info_obj.usergroup_set.add(*group_objs)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    user_list = [&#123;&#x27;username&#x27;:&#x27;zhangsan&#x27;&#125;,</span></span><br><span class="line"><span class="string">                &#123;&#x27;username&#x27;:&#x27;lisi&#x27;&#125;,</span></span><br><span class="line"><span class="string">                &#123;&#x27;username&#x27;:&#x27;wangwu&#x27;&#125;,]</span></span><br><span class="line"><span class="string">    group_list = [&#123;&#x27;group_name&#x27;:&#x27;group_python&#x27;&#125;,</span></span><br><span class="line"><span class="string">               &#123;&#x27;group_name&#x27;:&#x27;group_linux&#x27;&#125;,</span></span><br><span class="line"><span class="string">               &#123;&#x27;group_name&#x27;:&#x27;group_mysql&#x27;&#125;,]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    for c in user_list:</span></span><br><span class="line"><span class="string">        models.UserInfo.objects.create(**c)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    for l in group_list:</span></span><br><span class="line"><span class="string">        models.UserGroup.objects.create(**l)</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;orm&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="一大波Model操作"><a href="#一大波Model操作" class="headerlink" title="一大波Model操作"></a>一大波Model操作</h2><h3 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">orm</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 1 创建</span></span><br><span class="line">    <span class="comment"># 创建数据方法一</span></span><br><span class="line">    models.UserInfo.objects.create(username=<span class="string">&#x27;root&#x27;</span>, password=<span class="string">&#x27;123&#x27;</span>)</span><br><span class="line">    <span class="comment"># 创建数据方法二</span></span><br><span class="line">    obj = models.UserInfo(username=<span class="string">&#x27;alex&#x27;</span>, password=<span class="string">&#x27;123&#x27;</span>)</span><br><span class="line">    obj.save()</span><br><span class="line">    <span class="comment"># 创建数据库方法三(传入字典必须在字典前加两个星号)</span></span><br><span class="line">    dic = &#123;<span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;eric&#x27;</span>, <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;666&#x27;</span>&#125;</span><br><span class="line">    models.UserInfo.objects.create(**dic)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2 查</span></span><br><span class="line">    result = models.UserInfo.objects.<span class="built_in">all</span>()  <span class="comment"># 查找所有条目</span></span><br><span class="line">    result = models.UserInfo.objects.<span class="built_in">filter</span>(username=<span class="string">&#x27;alex&#x27;</span>, password=<span class="string">&#x27;123&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> result:</span><br><span class="line">        <span class="built_in">print</span>(row.<span class="built_in">id</span>, row.username, row.password)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3 删除</span></span><br><span class="line">    models.UserInfo.objects.<span class="built_in">all</span>().delete()  <span class="comment"># 删除所有</span></span><br><span class="line">    models.UserInfo.objects.<span class="built_in">filter</span>(username=<span class="string">&#x27;alex&#x27;</span>).delete()  <span class="comment"># 删除指定</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4 更新</span></span><br><span class="line">    models.UserInfo.objects.<span class="built_in">all</span>().update(password=<span class="string">&#x27;12345&#x27;</span>)</span><br><span class="line">    models.UserInfo.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=<span class="number">4</span>).update(password=<span class="string">&#x27;15&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5 获取个数</span></span><br><span class="line">    models.UserInfo.objects.<span class="built_in">filter</span>(name=<span class="string">&#x27;seven&#x27;</span>).count()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6 执行原生SQL</span></span><br><span class="line">    <span class="comment"># 6.1 执行原生SQL</span></span><br><span class="line">    models.UserInfo.objects.raw(<span class="string">&#x27;select * from userinfo&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6.2 如果SQL是其他表时，必须将名字设置为当前UserInfo对象的主键列名</span></span><br><span class="line">    models.UserInfo.objects.raw(<span class="string">&#x27;select id as nid from 其他表&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6.3 指定数据库</span></span><br><span class="line">    models.UserInfo.objects.raw(<span class="string">&#x27;select * from userinfo&#x27;</span>, using=<span class="string">&quot;default&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;orm&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="进阶操作"><a href="#进阶操作" class="headerlink" title="进阶操作"></a>进阶操作</h3><ul><li><code>进阶操作：牛掰掰的双下划线</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、大于，小于</span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(id__gt=1)                 # 获取id大于1的值</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(id__gte=1)                # 获取id大于等于1的值</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(id__lt=10)                # 获取id小于10的值</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(id__lte=10)               # 获取id小于10的值</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(id__lt=10, id__gt=1)      # 获取id大于1 且 小于10的值</span></span><br><span class="line"><span class="number">2</span>、<span class="keyword">in</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(id__in=[11, 22, 33])      # 获取id等于11、22、33的数据</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.exclude(id__in=[11, 22, 33])     # not in</span></span><br><span class="line"><span class="number">3</span>、isnull</span><br><span class="line">        <span class="comment"># Entry.objects.filter(pub_date__isnull=True)         #双下划线isnull，查找pub_date是null的数据</span></span><br><span class="line"><span class="number">4</span>、contains                                                    <span class="comment">#就是原生sql的like操作:模糊匹配</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(name__contains=&quot;ven&quot;)</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(name__icontains=&quot;ven&quot;)    # icontains大小写不敏感</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.exclude(name__icontains=&quot;ven&quot;)</span></span><br><span class="line"><span class="number">5</span>、<span class="built_in">range</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(id__range=[1, 2])          # 范围bettwen and</span></span><br><span class="line"><span class="number">6</span>、order by</span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(name=&#x27;seven&#x27;).order_by(&#x27;id&#x27;)      # asc     没有减号升续排列</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(name=&#x27;seven&#x27;).order_by(&#x27;-id&#x27;)     # desc      有减号升续排列</span></span><br><span class="line"><span class="number">7</span>、group by</span><br><span class="line">        <span class="comment"># from django.db.models import Count, Min, Max, Sum</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(c1=1).values(&#x27;id&#x27;).annotate(c=Count(&#x27;num&#x27;))        #根据id列进行分组</span></span><br><span class="line">        <span class="comment"># SELECT &quot;app01_tb1&quot;.&quot;id&quot;, COUNT(&quot;app01_tb1&quot;.&quot;num&quot;) AS &quot;c&quot; FROM &quot;app01_tb1&quot; </span></span><br><span class="line">        <span class="comment"># WHERE &quot;app01_tb1&quot;.&quot;c1&quot; = 1 GROUP BY &quot;app01_tb1&quot;.&quot;id&quot;</span></span><br><span class="line"><span class="number">8</span>、limit 、offset    <span class="comment">#分页</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.all()[10:20]</span></span><br><span class="line"><span class="number">9</span>、regex正则匹配，iregex 不区分大小写</span><br><span class="line">        <span class="comment"># Entry.objects.get(title__regex=r&#x27;^(An?|The) +&#x27;)</span></span><br><span class="line">        <span class="comment"># Entry.objects.get(title__iregex=r&#x27;^(an?|the) +&#x27;)</span></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"><span class="number">10</span>、date</span><br><span class="line">        <span class="comment"># Entry.objects.filter(pub_date__date=datetime.date(2005, 1, 1))          #__data表示日期查找，2005-01-01</span></span><br><span class="line">        <span class="comment"># Entry.objects.filter(pub_date__date__gt=datetime.date(2005, 1, 1))</span></span><br><span class="line"><span class="number">11</span>、year</span><br><span class="line">        <span class="comment"># Entry.objects.filter(pub_date__year=2005)                               #__year根据年查找</span></span><br><span class="line">        <span class="comment"># Entry.objects.filter(pub_date__year__gte=2005)</span></span><br><span class="line"><span class="number">12</span>、month</span><br><span class="line">        <span class="comment"># Entry.objects.filter(pub_date__month=12)</span></span><br><span class="line">        <span class="comment"># Entry.objects.filter(pub_date__month__gte=6)</span></span><br><span class="line"><span class="number">13</span>、day</span><br><span class="line">        <span class="comment"># Entry.objects.filter(pub_date__day=3)</span></span><br><span class="line">        <span class="comment"># Entry.objects.filter(pub_date__day__gte=3)</span></span><br><span class="line"><span class="number">14</span>、week_day</span><br><span class="line">        <span class="comment"># Entry.objects.filter(pub_date__week_day=2)</span></span><br><span class="line">        <span class="comment"># Entry.objects.filter(pub_date__week_day__gte=2)</span></span><br><span class="line"><span class="number">15</span>、hour</span><br><span class="line">        <span class="comment"># Event.objects.filter(timestamp__hour=23)</span></span><br><span class="line">        <span class="comment"># Event.objects.filter(time__hour=5)</span></span><br><span class="line">        <span class="comment"># Event.objects.filter(timestamp__hour__gte=12)</span></span><br><span class="line"><span class="number">16</span>、minute</span><br><span class="line">        <span class="comment"># Event.objects.filter(timestamp__minute=29)</span></span><br><span class="line">        <span class="comment"># Event.objects.filter(time__minute=46)</span></span><br><span class="line">        <span class="comment"># Event.objects.filter(timestamp__minute__gte=29)</span></span><br><span class="line"><span class="number">17</span>、second</span><br><span class="line">        <span class="comment"># Event.objects.filter(timestamp__second=31)</span></span><br><span class="line">        <span class="comment"># Event.objects.filter(time__second=2)</span></span><br><span class="line">        <span class="comment"># Event.objects.filter(timestamp__second__gte=31)</span></span><br></pre></td></tr></table></figure><h3 id="时间过滤"><a href="#时间过滤" class="headerlink" title="时间过滤"></a>时间过滤</h3><ul><li>根据天&#x2F;小时进行过滤</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.utils <span class="keyword">import</span> timezone</span><br><span class="line"><span class="keyword">from</span> report.models <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">now = timezone.now()</span><br><span class="line"><span class="comment"># start_time = now - timezone.timedelta(days=7)</span></span><br><span class="line">start_time = now - timezone.timedelta(hours=<span class="number">240</span>)  <span class="comment"># 查询10天前的数据</span></span><br><span class="line">end_time = now</span><br><span class="line"></span><br><span class="line">qs = AllClarm.objects.<span class="built_in">filter</span>(start_tm__range=(start_time, end_time))</span><br></pre></td></tr></table></figure><h2 id="F-和Q-查询"><a href="#F-和Q-查询" class="headerlink" title="F()和Q()查询"></a>F()和Q()查询</h2><h3 id="F"><a href="#F" class="headerlink" title="F()"></a>F()</h3><ul><li>F() —- 专门取对象中某列值的操作</li><li><strong>作用：</strong>F()允许Django在未实际链接数据的情况下具有对数据库字段的值的引用</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> F,Q</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">orm</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 每访问一次数据库中zhangsan的年纪就会自动增加1</span></span><br><span class="line">    models.Student.objects.<span class="built_in">filter</span>(name=<span class="string">&#x27;zhangsan&#x27;</span>).update(age=F(<span class="string">&quot;age&quot;</span>) + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;orm&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="Q"><a href="#Q" class="headerlink" title="Q()"></a>Q()</h3><h4 id="Q查询基本使用"><a href="#Q查询基本使用" class="headerlink" title="Q查询基本使用"></a>Q查询基本使用</h4><ul><li>1、Q对象(django.db.models.Q)可以对关键字参数进行封装，从而更好地应用多个查询</li><li>2、可以组合使用 &amp;（and）,|（or），~（not）操作符，当一个操作符用于两个Q的对象,它产生一个新的Q对象</li><li>3、如： <strong>Q(Q(nid&#x3D;8) | Q(nid__gt&#x3D;10)) &amp; Q(caption&#x3D;’root’)</strong></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> F,Q</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">orm</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 查找学生表中年级大于1小于30姓zhang的所有学生</span></span><br><span class="line">    stus = models.Student.objects.<span class="built_in">filter</span>(</span><br><span class="line">        Q(age__gt=<span class="number">1</span>) &amp; Q(age__lt=<span class="number">30</span>),</span><br><span class="line">        Q(name__startswith=<span class="string">&#x27;zhang&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;stu&#x27;</span>,stus)   <span class="comment">#运行结果：[&lt;Student: zhangsan&gt;]</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;orm&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="动态添加查询条件"><a href="#动态添加查询条件" class="headerlink" title="动态添加查询条件"></a>动态添加查询条件</h3><ul><li>动态添加多个and和or查询条件</li></ul><h5 id="项目中动态添加or查询条件"><a href="#项目中动态添加or查询条件" class="headerlink" title="项目中动态添加or查询条件"></a>项目中动态添加or查询条件</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">table_search</span>(<span class="params">request,admin_class,object_list</span>):</span><br><span class="line">   search_key = request.GET.get(<span class="string">&#x27;_q&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">   q_obj = Q()</span><br><span class="line">   q_obj.connector = <span class="string">&#x27;OR&#x27;</span></span><br><span class="line">   <span class="keyword">for</span> column <span class="keyword">in</span> admin_class.search_fields:</span><br><span class="line">      q_obj.children.append((<span class="string">&#x27;%s__contains&#x27;</span>%column,search_key))</span><br><span class="line">   res = object_list.<span class="built_in">filter</span>(q_obj)</span><br><span class="line">   <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h4 id="or动态添加多个查询条件"><a href="#or动态添加多个查询条件" class="headerlink" title="or动态添加多个查询条件"></a>or动态添加多个查询条件</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># or动态添加多个查询条件</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> crm <span class="keyword">import</span> models</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>con = Q()                                   <span class="comment">#1. 实例化一个Q()查询类</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>con.connector = <span class="string">&quot;OR&quot;</span>                           <span class="comment">#2. 指定使用‘OR’条件</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>con.children.append((<span class="string">&#x27;qq__contains&#x27;</span>,<span class="string">&#x27;123&#x27;</span>))           <span class="comment">#3. qq字段中包含‘123’</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>con.children.append((<span class="string">&#x27;name__contains&#x27;</span>,<span class="string">&#x27;name0&#x27;</span>))         <span class="comment">#4. name字段中包含‘naem0’</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>con</span><br><span class="line">&lt;Q: (OR: (<span class="string">&#x27;qq__contains&#x27;</span>, <span class="string">&#x27;123&#x27;</span>), (<span class="string">&#x27;name__contains&#x27;</span>, <span class="string">&#x27;name0&#x27;</span>))&gt;   </span><br><span class="line">                            <span class="comment">#5. 查找name字段中包含‘naem0’或qq字段包含‘123’的所有条目</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>models.Customer.objects.values(<span class="string">&#x27;qq&#x27;</span>,<span class="string">&#x27;name&#x27;</span>).<span class="built_in">filter</span>(con)    </span><br></pre></td></tr></table></figure><h4 id="and和or结合查询"><a href="#and和or结合查询" class="headerlink" title="and和or结合查询"></a>and和or结合查询</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># and和or结合查询</span></span><br><span class="line"><span class="comment">#1. 导入模块</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> crm <span class="keyword">import</span> models</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line"></span><br><span class="line"><span class="comment">#2. q1：查询id=1或者id=2的所有条目  （or条件）</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q1 = Q()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q1.connector = <span class="string">&#x27;OR&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q1.children.append((<span class="string">&#x27;id&#x27;</span>,<span class="number">1</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q1.children.append((<span class="string">&#x27;id&#x27;</span>,<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#3. q2：查询id=1的所有条目  （or条件）</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q2 = Q()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q2.connector = <span class="string">&#x27;OR&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q2.children.append((<span class="string">&#x27;id&#x27;</span>,<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#4. con：结合q1和q2条件结果是查询id=1的所有条目     （结合q1,q2的and条件）</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>con = Q()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>con.add(q1,<span class="string">&#x27;AND&#x27;</span>)</span><br><span class="line">   &lt;Q: (OR: (<span class="string">&#x27;id&#x27;</span>, <span class="number">1</span>), (<span class="string">&#x27;id&#x27;</span>, <span class="number">2</span>))&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>con.add(q2,<span class="string">&#x27;AND&#x27;</span>)</span><br><span class="line">   &lt;Q: (AND: (OR: (<span class="string">&#x27;id&#x27;</span>, <span class="number">1</span>), (<span class="string">&#x27;id&#x27;</span>, <span class="number">2</span>)), (<span class="string">&#x27;id&#x27;</span>, <span class="number">1</span>))&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>models.Customer.objects.values(<span class="string">&#x27;qq&#x27;</span>,<span class="string">&#x27;name&#x27;</span>).<span class="built_in">filter</span>(con)</span><br><span class="line">   &lt;QuerySet [&#123;<span class="string">&#x27;qq&#x27;</span>: <span class="string">&#x27;123456765432&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;haha&#x27;</span>&#125;]&gt;</span><br></pre></td></tr></table></figure><h2 id="aggregate和annotate"><a href="#aggregate和annotate" class="headerlink" title="aggregate和annotate"></a>aggregate和annotate</h2><h3 id="aggregate聚合函数"><a href="#aggregate聚合函数" class="headerlink" title="aggregate聚合函数"></a>aggregate聚合函数</h3><ul><li><strong>作用：</strong>从数据库中取出一个汇总的集合</li><li><code>aggregate求最大值、最小值、平局值等</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Count,Avg,Max,Sum</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">orm</span>(<span class="params">request</span>):</span><br><span class="line"></span><br><span class="line">    stus = models.Student.objects.aggregate(</span><br><span class="line">        stu_num=Count(<span class="string">&#x27;age&#x27;</span>),     <span class="comment">#计算学生表中有多少条age条目</span></span><br><span class="line">        stu_avg=Avg(<span class="string">&#x27;age&#x27;</span>),       <span class="comment">#计算学生的平均年纪</span></span><br><span class="line">        stu_max=Max(<span class="string">&#x27;age&#x27;</span>),       <span class="comment">#找到年纪最大的学生</span></span><br><span class="line">        stu_sum=Sum(<span class="string">&#x27;age&#x27;</span>))       <span class="comment">#将表中的所有年纪相加</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;stu&#x27;</span>,stus)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line"><span class="comment">#运行结果：&#123;&#x27;stu_sum&#x27;: 69, &#x27;stu_max&#x27;: 24, &#x27;stu_avg&#x27;: 23.0, &#x27;stu_num&#x27;: 3&#125;</span></span><br></pre></td></tr></table></figure><h3 id="实现聚合group-by查询"><a href="#实现聚合group-by查询" class="headerlink" title="实现聚合group by查询"></a>实现聚合group by查询</h3><ul><li>**作用:**对查询结果进行分组，比如分组求出各年龄段的人数</li><li><strong>注:</strong> annotate后面加filter过滤相当于原生sql语句中的having</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Count, Avg, Max, Min, Sum</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">orm</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment">#1 按年纪分组查找学生表中各个年龄段学生人数：（22岁两人，24岁一人）</span></span><br><span class="line">    <span class="comment"># 查询结果：[&#123;&#x27;stu_num&#x27;: 2, &#x27;age&#x27;: 22&#125;, &#123;&#x27;stu_num&#x27;: 1, &#x27;age&#x27;: 24&#125;]</span></span><br><span class="line"></span><br><span class="line">    stus1 = models.Student.objects.values(<span class="string">&#x27;age&#x27;</span>).annotate(stu_num=Count(<span class="string">&#x27;age&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#2 按年纪分组查找学生表中各个年龄段学生人数，并过滤出年纪大于22的：</span></span><br><span class="line">    <span class="comment"># 查询结果：[&#123;&#x27;stu_num&#x27;: 1, &#x27;age&#x27;: 24&#125;] （年级大于22岁的仅一人，年级为24岁）</span></span><br><span class="line"></span><br><span class="line">    stus2 = models.Student.objects.values(<span class="string">&#x27;age&#x27;</span>).annotate(stu_num=Count(<span class="string">&#x27;age&#x27;</span>)).<span class="built_in">filter</span>(age__gt=<span class="number">22</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#3 先按年纪分组，然后查询出各个年龄段学生的平均成绩</span></span><br><span class="line">    <span class="comment"># 查询结果：[&#123;&#x27;stu_Avg&#x27;: 86.5, &#x27;age&#x27;: 22&#125;, &#123;&#x27;stu_Avg&#x27;: 99.0, &#x27;age&#x27;: 24&#125;]</span></span><br><span class="line">    <span class="comment"># 22岁平均成绩：86.5      24岁平均成绩：99</span></span><br><span class="line"></span><br><span class="line">    stus3 = models.Student.objects.values(<span class="string">&#x27;age&#x27;</span>).annotate(stu_Avg=Avg(<span class="string">&#x27;grade&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;ok&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="aggregate和annotate区别"><a href="#aggregate和annotate区别" class="headerlink" title="aggregate和annotate区别"></a>aggregate和annotate区别</h3><ul><li><ol><li>Aggregate作用是从数据库取出一个汇总的数据（比如，数量，最大，最小，平均等）</li></ol></li><li><ol><li>而annotate是先按照设定的条件对数据进行分组，然后根据不同组分别对数据进行汇总</li></ol></li></ul><h1 id="DRF框架"><a href="#DRF框架" class="headerlink" title="DRF框架"></a>DRF框架</h1><h2 id="web开发两种模式"><a href="#web开发两种模式" class="headerlink" title="web开发两种模式"></a>web开发两种模式</h2><h3 id="前后端不分离"><a href="#前后端不分离" class="headerlink" title="前后端不分离"></a>前后端不分离</h3><ul><li>前端看到的效果都是由后端控制的</li><li>后端通过渲染之后给前端返回完整的html页面，前端与后端的耦合度很高</li></ul><p><img src="/medias/loading.gif" data-original="https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20210217141549707.9cd57893.png" alt="img"></p><h3 id="前后端分离"><a href="#前后端分离" class="headerlink" title="前后端分离"></a>前后端分离</h3><ul><li>后端仅返回前端所需的数据，至于数据怎么进行展示</li><li>由前端自己进行控制，前端与后端的耦合度很低</li></ul><p><img src="/medias/loading.gif" data-original="https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20210217141750396.6758eb34.png" alt="img"></p><h3 id="开发模式对比"><a href="#开发模式对比" class="headerlink" title="开发模式对比"></a>开发模式对比</h3><ul><li><code>前后端不分离</code>：完整的页面是在后端生成的，后端给前端返回完整的页面，前端只是进行展示。</li><li><code>前后端分离</code>：完整的页面是在前端生成的，后端只给前端返回所需的数据，前端将数据填充在页面上。</li><li><code>优缺点比较：</code><ul><li>前后端不分离适合于纯网页的应用，前后端分离可以对接不同类型的客户端。</li></ul></li></ul><table><thead><tr><th>开发模式</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>前后端不分离</td><td>利于SEO(搜索引擎优化)</td><td>仅适合于纯网页的应用</td></tr><tr><td>前后端分离</td><td>可以对接不同类型的客户端</td><td>不利于SEO(搜索引擎优化)</td></tr></tbody></table><h2 id="Restful风格"><a href="#Restful风格" class="headerlink" title="Restful风格"></a>Restful风格</h2><h3 id="RESTFUL风格"><a href="#RESTFUL风格" class="headerlink" title="RESTFUL风格"></a>RESTFUL风格</h3><h4 id="什么是RESTful风格"><a href="#什么是RESTful风格" class="headerlink" title="什么是RESTful风格"></a>什么是RESTful风格</h4><p>详情查看博客地址：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/xiaonq/p/10053234.html">https://www.cnblogs.com/xiaonq/p/10053234.html</a></p><h4 id="什么是RESTful"><a href="#什么是RESTful" class="headerlink" title="什么是RESTful"></a>什么是RESTful</h4><ul><li>REST与技术无关，代表的是<code>一种软件架构风格</code>（REST是Representational State Transfer的简称，中文翻译为“表征状态转移”）</li><li>REST从资源的角度类审视整个网络，它将分布在网络中某个节点的<code>资源通过URL进行标识</code></li><li>所有的数据，不过是通过网络获取的还是<code>操作（增删改查）</code>的数据，都是资源，将一切数据视为资源是REST区别与其他架构风格的最本质属性</li><li>对于REST这种面向资源的架构风格，有人提出一种全新的结构理念，即：面向资源架构（ROA：Resource Oriented Architecture）</li></ul><h4 id="web开发本质"><a href="#web开发本质" class="headerlink" title="web开发本质"></a>web开发本质</h4><ul><li>对数据库中的表进行增删改查操作</li><li>Restful风格就是把所有数据都当做资源，对表的操作就是对资源操作</li><li>在url同通过 资源名称来指定资源</li><li>通过 get&#x2F;post&#x2F;put&#x2F;delete&#x2F;patch 对资源的操作</li></ul><h3 id="RESTful设计规范"><a href="#RESTful设计规范" class="headerlink" title="RESTful设计规范"></a>RESTful设计规范</h3><h4 id="URL路径"><a href="#URL路径" class="headerlink" title="URL路径"></a>URL路径</h4><ul><li><code>面向资源编程</code>： 路径，视网络上任何东西都是资源，均使用名词表示（可复数）,不要使用动词</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不好的例子：url中含有动词</span></span><br><span class="line">/getProducts</span><br><span class="line">/listOrders</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正确的例子：地址使用名词复数</span></span><br><span class="line">GET /products      <span class="comment"># 将返回所有产品信息</span></span><br><span class="line">POST /products     <span class="comment"># 将新建产品信息</span></span><br><span class="line">GET /products/<span class="number">4</span>     <span class="comment"># 将获取产品4</span></span><br><span class="line">PUT /products/<span class="number">4</span>     <span class="comment"># 将更新产品4</span></span><br></pre></td></tr></table></figure><h4 id="请求方式"><a href="#请求方式" class="headerlink" title="请求方式"></a>请求方式</h4><ul><li>访问同一个URL地址，采用不同的请求方式，代表要执行不同的操作</li><li>常用的HTTP请求方式有如下四种：</li></ul><table><thead><tr><th>请求方式</th><th>说明</th></tr></thead><tbody><tr><td>GET</td><td>获取资源数据(单个或多个)</td></tr><tr><td>POST</td><td>新增资源数据</td></tr><tr><td>PUT</td><td>修改资源数据</td></tr><tr><td>DELETE</td><td>删除资源数据</td></tr></tbody></table><ul><li>例如</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET /books          <span class="comment"># 获取所有图书数据</span></span><br><span class="line">POST /books          <span class="comment"># 新建一本图书数据</span></span><br><span class="line">GET /books/&lt;<span class="built_in">id</span>&gt;/       <span class="comment"># 获取某个指定的图书数据</span></span><br><span class="line">PUT /books/&lt;<span class="built_in">id</span>&gt;/       <span class="comment"># 更新某个指定的图书数据</span></span><br><span class="line">DELETE /books/&lt;<span class="built_in">id</span>&gt;/     <span class="comment"># 删除某个指定的图书数据</span></span><br></pre></td></tr></table></figure><h4 id="过滤信息"><a href="#过滤信息" class="headerlink" title="过滤信息"></a>过滤信息</h4><ul><li><code>过滤，分页，排序</code>：通过在url上传参的形式传递搜索条件</li><li>常见的参数：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?limit=<span class="number">10</span>                   <span class="comment"># 指定返回记录的数量。</span></span><br><span class="line">?offset=<span class="number">10</span>                   <span class="comment"># 指定返回记录的开始位置。</span></span><br><span class="line">?page=<span class="number">2</span>&amp;pagesize=<span class="number">100</span>             <span class="comment"># 指定第几页，以及每页的记录数。</span></span><br><span class="line">?sortby=name&amp;order=asc             <span class="comment"># 指定返回结果按照哪个属性排序，以及排序顺序。</span></span><br></pre></td></tr></table></figure><h4 id="响应状态码"><a href="#响应状态码" class="headerlink" title="响应状态码"></a>响应状态码</h4><ul><li>重点状态码</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;1. 2XX请求成功&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 1.1 200 请求成功，一般用于GET与POST请求</span></span><br><span class="line"><span class="comment"># 1.2 201 Created - [POST/PUT/PATCH]：用户新建或修改数据成功。</span></span><br><span class="line"><span class="comment"># 204 NO CONTENT - [DELETE]：用户删除数据成功。</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;3. 4XX客户端错误&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 3.1 400 INVALID REQUEST - [POST/PUT/PATCH]：用户发出的请求有错误。</span></span><br><span class="line"><span class="comment"># 3.2 401 Unauthorized - [*]：表示用户没有权限（令牌、用户名、密码错误）。</span></span><br><span class="line"><span class="comment"># 3.3 403 Forbidden - [*] 表示用户得到授权（与401错误相对），但是访问是被禁止的。</span></span><br><span class="line"><span class="comment"># 3.4 404 NOT FOUND - [*]：用户发出的请求针对的是不存在的记录。</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;4. 5XX服务端错误&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 500 INTERNAL SERVER ERROR - [*]：服务器内部错误，无法完成请求</span></span><br><span class="line"><span class="comment"># 501 Not Implemented     服务器不支持请求的功能，无法完成请求</span></span><br><span class="line"></span><br><span class="line">更多状态码参考：https://www.runoob.com/http/http-status-codes.html</span><br></pre></td></tr></table></figure><ul><li>详细状态码</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;1. 2XX请求成功&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 1.1 200 请求成功，一般用于GET与POST请求</span></span><br><span class="line"><span class="comment"># 1.2 201 Created - [POST/PUT/PATCH]：用户新建或修改数据成功。</span></span><br><span class="line"><span class="comment"># 202 Accepted - [*]：表示一个请求已经进入后台排队（异步任务）</span></span><br><span class="line"><span class="comment"># 204 NO CONTENT - [DELETE]：用户删除数据成功。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;2. 3XX重定向&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 301 NO CONTENT - 永久重定向</span></span><br><span class="line"><span class="comment"># 302 NO CONTENT - 临时重定向</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;3. 4XX客户端错误&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 3.1 400 INVALID REQUEST - [POST/PUT/PATCH]：用户发出的请求有错误。</span></span><br><span class="line"><span class="comment"># 3.2 401 Unauthorized - [*]：表示用户没有权限（令牌、用户名、密码错误）。</span></span><br><span class="line"><span class="comment"># 3.3 403 Forbidden - [*] 表示用户得到授权（与401错误相对），但是访问是被禁止的。</span></span><br><span class="line"><span class="comment"># 3.4 404 NOT FOUND - [*]：用户发出的请求针对的是不存在的记录。</span></span><br><span class="line"><span class="comment"># 406 Not Acceptable - [GET]：用户请求的格式不可得（比如用户请求JSON格式，但是只有XML格式）。</span></span><br><span class="line"><span class="comment"># 410 Gone -[GET]：用户请求的资源被永久删除，且不会再得到的。</span></span><br><span class="line"><span class="comment"># 422 Unprocesable entity - [POST/PUT/PATCH] 当创建一个对象时，发生一个验证错误。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;4. 5XX服务端错误&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 500 INTERNAL SERVER ERROR - [*]：服务器内部错误，无法完成请求</span></span><br><span class="line"><span class="comment"># 501 Not Implemented     服务器不支持请求的功能，无法完成请求</span></span><br><span class="line"></span><br><span class="line">更多状态码参考：https://www.runoob.com/http/http-status-codes.html</span><br></pre></td></tr></table></figure><h2 id="DRF框架作用"><a href="#DRF框架作用" class="headerlink" title="DRF框架作用"></a>DRF框架作用</h2><h3 id="DRF核心任务"><a href="#DRF核心任务" class="headerlink" title="DRF核心任务"></a>DRF核心任务</h3><h4 id="DRF核心任务-1"><a href="#DRF核心任务-1" class="headerlink" title="DRF核心任务"></a>DRF核心任务</h4><ul><li>序列化：将对象转换为字典或者json的过程。</li><li>反序列化：将字典或json转换保存到对象中的过程。</li><li>RestAPI核心工作：<ul><li>将数据库中的数据序列化为前端所需的格式，并进行返回。</li><li>将前端传递的数据反序列化保存为模型类对象，并保存到数据库。</li></ul></li><li>在开发REST API接口时，视图中主要做了三件事：<ul><li>① 将请求的数据（如：JSON格式）转换为模型类对象</li><li>② 操作数据库</li><li>③ 将模型类对象转换为响应的数据（如：JSON格式）</li></ul></li></ul><h4 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h4><ul><li><strong>广义的概念</strong>：将一种数据转换为另外一种格式的过程。</li><li><strong>本课程特指</strong>：<code>将对象转换为字典或json的过程</code>。</li></ul><p><img src="/medias/loading.gif" data-original="https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20210217145158339.ef343d9c.png" alt="img"></p><h4 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h4><ul><li><strong>广义的概念</strong>：和序列化相反的转换过程。</li><li><strong>本课程特指</strong>：将字典或json转换为对象的过程。</li></ul><p><img src="/medias/loading.gif" data-original="https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20210217145342846.25a820ca.png" alt="img"></p><h3 id="Django-REST-framework-简介"><a href="#Django-REST-framework-简介" class="headerlink" title="Django REST framework 简介"></a>Django REST framework 简介</h3><h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><ul><li><strong>Django REST framework可以帮助我们大大提高REST API的开发速度。</strong></li><li>在序列化与反序列化时，虽然操作的数据可能不同，但是过程是相似的，这部分操作DRF框架进行了封装。</li><li>在开发REST API的视图时，虽然每个视图操作的数据可能不同</li><li>但增、删、改、查的基本流程是一样的，这部分代码DRF框架也进行了封装。<ul><li><strong>增</strong>：校验请求数据 → 反序列化-将数据保存到对象中 → 保存数据到数据库 → 将保存的对象序列化返回</li><li><strong>删</strong>：判断要删除的数据是否存在 → 执行数据库删除 → 返回响应</li><li><strong>改</strong>：判断要修改的数据是否存在 → 校验请求的数据 → 反序列化-将数据保存到对象中 → 保存数据到数据库 → 将保存的对象序列化返回</li><li>**查(1个或多个)**：查询数据库 → 将数据序列化返回</li></ul></li></ul><h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ul><li><strong>提供了定义序列化器的方法，使用序列化器可以进行数据的序列化和反序列化</strong></li><li><strong>提供了丰富的类视图、Mixin扩展类、子类视图、视图集，简化视图代码的编写</strong></li><li>多种身份认证和权限控制方式的支持</li><li>内置了限流系统</li><li>直观的API web界面</li><li>可扩展性，插件丰富</li></ul><p><strong>参考资料</strong>：<a target="_blank" rel="noopener" href="http://www.django-rest-framework.org/">DRF框架官方文档(opens new window)</a></p><p>**<code>总结</code>**：</p><ul><li>作用：快速开发RestAPI接口。</li><li>特点：进行了大量封装，提高API开发速度。</li><li>核心功能：序列化器和视图。</li></ul><h2 id="04-环境安装与使用"><a href="#04-环境安装与使用" class="headerlink" title="04.环境安装与使用"></a>04.环境安装与使用</h2><h3 id="安装djangorestframework"><a href="#安装djangorestframework" class="headerlink" title="安装djangorestframework"></a>安装djangorestframework</h3><ul><li>DRF框架依赖于Django，<code>需要先安装Django环境，再安装djangorestframework</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install djangorestframework==<span class="number">3.11</span><span class="number">.0</span>        <span class="comment"># 安装djangorestframework</span></span><br><span class="line">pip install django-<span class="built_in">filter</span>==<span class="number">2.3</span><span class="number">.0</span>             <span class="comment"># 安装过滤器</span></span><br></pre></td></tr></table></figure><ul><li>创建django环境</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ① 创建一个名为django2.2的虚拟环境</span></span><br><span class="line">mkvirtualenv -p python django2<span class="number">.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ② 进入django2.2虚拟环境</span></span><br><span class="line">workon django2<span class="number">.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ③ 安装Django环境</span></span><br><span class="line">pip install Django==<span class="number">2.2</span><span class="number">.5</span></span><br></pre></td></tr></table></figure><h3 id="DRF配置"><a href="#DRF配置" class="headerlink" title="DRF配置"></a>DRF配置</h3><h4 id="创建一个测试项目"><a href="#创建一个测试项目" class="headerlink" title="创建一个测试项目"></a>创建一个测试项目</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(django2<span class="number">.2</span>) C:\Users\Lenovo&gt;  cd C:\tmp</span><br><span class="line">(django2<span class="number">.2</span>) C:\tmp&gt;  django-admin startproject drf_demo</span><br><span class="line">(django2<span class="number">.2</span>) C:\tmp\drf_demo&gt;  python manage.py startapp book</span><br></pre></td></tr></table></figure><h4 id="DRF应用注册"><a href="#DRF应用注册" class="headerlink" title="DRF应用注册"></a>DRF应用注册</h4><ul><li>setting.py中注册djangorestframework</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;rest_framework&#x27;</span>,             <span class="comment"># 注册 djangorestframework</span></span><br><span class="line">    <span class="string">&#x27;book.apps.BookConfig&#x27;</span>,         <span class="comment"># 注册刚刚创建的APP：book</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="路由分发"><a href="#路由分发" class="headerlink" title="路由分发"></a>路由分发</h4><ul><li><code>drf_demo/urls.py</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path,include</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;book/&#x27;</span>, include((<span class="string">&#x27;book.urls&#x27;</span>, <span class="string">&#x27;book&#x27;</span>), namespace=<span class="string">&#x27;book&#x27;</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="定义模型-1"><a href="#定义模型-1" class="headerlink" title="定义模型"></a>定义模型</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment">#定义图书模型类BookInfo</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookInfo</span>(models.Model):</span><br><span class="line">    btitle = models.CharField(max_length=<span class="number">20</span>, verbose_name=<span class="string">&#x27;名称&#x27;</span>)</span><br><span class="line">    bpub_date = models.DateField(verbose_name=<span class="string">&#x27;发布日期&#x27;</span>)</span><br><span class="line">    bread = models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">&#x27;阅读量&#x27;</span>)</span><br><span class="line">    bcomment = models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">&#x27;评论量&#x27;</span>)</span><br><span class="line">    is_delete = models.BooleanField(default=<span class="literal">False</span>, verbose_name=<span class="string">&#x27;逻辑删除&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        db_table = <span class="string">&#x27;tb_books&#x27;</span>  <span class="comment"># 指明数据库表名</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;图书&#x27;</span>  <span class="comment"># 在admin站点中显示的名称</span></span><br><span class="line">        verbose_name_plural = verbose_name  <span class="comment"># 显示的复数名称</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;定义每个数据对象的显示信息&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.btitle</span><br></pre></td></tr></table></figure><ul><li>创建表</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(django2<span class="number">.2</span>) C:\tmp\drf_demo&gt;   python manage.py makemigrations</span><br><span class="line">(django2<span class="number">.2</span>) C:\tmp\drf_demo&gt;   python manage.py migrate</span><br></pre></td></tr></table></figure><h3 id="DRF框架功能演示"><a href="#DRF框架功能演示" class="headerlink" title="DRF框架功能演示"></a>DRF框架功能演示</h3><h4 id="步骤1：创建序列化器类"><a href="#步骤1：创建序列化器类" class="headerlink" title="步骤1：创建序列化器类"></a>步骤1：创建序列化器类</h4><ul><li>在 <code>book</code> 应用中新建 <code>serializers.py</code> 用于保存所要创建的序列化器类。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> book.models <span class="keyword">import</span> BookInfo</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookInfoSerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;图书序列化器类&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = BookInfo</span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>小知识</strong>：</p><ul><li>model：指定该序列化器类所对应的模型类</li><li>fields：指定依据模型类的哪些字段生成对应序列化器类的字段，__all__代表所有</li></ul><h4 id="步骤2：编写视图"><a href="#步骤2：编写视图" class="headerlink" title="步骤2：编写视图"></a>步骤2：编写视图</h4><ul><li><code>book/views.py</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet</span><br><span class="line"><span class="keyword">from</span> book.serializers <span class="keyword">import</span> BookInfoSerializer</span><br><span class="line"><span class="keyword">from</span> book.models <span class="keyword">import</span> BookInfo</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookInfoViewSet</span>(<span class="title class_ inherited__">ModelViewSet</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;视图集&quot;&quot;&quot;</span></span><br><span class="line">    queryset = BookInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookInfoSerializer</span><br></pre></td></tr></table></figure><p><strong>小知识</strong>：</p><ul><li>queryset：指定视图在进行数据查询时所使用的查询集</li><li>serializer_class：指定视图在进行序列化或反序列化时所使用的序列化器类</li></ul><h4 id="步骤3：定义路由"><a href="#步骤3：定义路由" class="headerlink" title="步骤3：定义路由"></a>步骤3：定义路由</h4><ul><li><code>book/urls.py</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> re_path</span><br><span class="line"><span class="keyword">from</span> book <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 路由Router</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.routers <span class="keyword">import</span> DefaultRouter</span><br><span class="line"></span><br><span class="line">router = DefaultRouter()</span><br><span class="line">router.register(<span class="string">&#x27;books&#x27;</span>, views.BookInfoViewSet, basename=<span class="string">&#x27;books&#x27;</span>)</span><br><span class="line">urlpatterns += router.urls</span><br></pre></td></tr></table></figure><ul><li><strong>小知识：什么是路由Router？</strong></li><li><strong>答：动态生成视图集中的处理方法的url配置项。</strong></li></ul><h4 id="步骤四：测试接口"><a href="#步骤四：测试接口" class="headerlink" title="步骤四：测试接口"></a>步骤四：测试接口</h4><h5 id="测试获取所有图书接口"><a href="#测试获取所有图书接口" class="headerlink" title="测试获取所有图书接口"></a>测试获取所有图书接口</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http</span>:<span class="comment">//127.0.0.1:8000/book/book/</span></span><br></pre></td></tr></table></figure><ul><li>返回结果</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;code&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line">    <span class="string">&quot;books&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="string">&quot;btitle&quot;</span>: <span class="string">&quot;西游记&quot;</span>,</span><br><span class="line">            <span class="string">&quot;bpub_date&quot;</span>: <span class="string">&quot;2020-08-11&quot;</span>,</span><br><span class="line">            <span class="string">&quot;bread&quot;</span>: <span class="number">1234</span>,</span><br><span class="line">            <span class="string">&quot;bcomment&quot;</span>: <span class="number">779</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">            <span class="string">&quot;btitle&quot;</span>: <span class="string">&quot;红楼梦&quot;</span>,</span><br><span class="line">            <span class="string">&quot;bpub_date&quot;</span>: <span class="string">&quot;2020-09-19&quot;</span>,</span><br><span class="line">            <span class="string">&quot;bread&quot;</span>: <span class="number">123</span>,</span><br><span class="line">            <span class="string">&quot;bcomment&quot;</span>: <span class="number">5555</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="string">&quot;btitle&quot;</span>: <span class="string">&quot;水浒传&quot;</span>,</span><br><span class="line">            <span class="string">&quot;bpub_date&quot;</span>: <span class="string">&quot;2020-02-12&quot;</span>,</span><br><span class="line">            <span class="string">&quot;bread&quot;</span>: <span class="number">100</span>,</span><br><span class="line">            <span class="string">&quot;bcomment&quot;</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="测试创建图书接口"><a href="#测试创建图书接口" class="headerlink" title="测试创建图书接口"></a>测试创建图书接口</h5><p><img src="/medias/loading.gif" data-original="https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20210217161335502.50100fe9.png" alt="img"></p><h5 id="测试修改图书接口"><a href="#测试修改图书接口" class="headerlink" title="测试修改图书接口"></a>测试修改图书接口</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http</span>:<span class="comment">//127.0.0.1:8000/book/book/1/</span></span><br></pre></td></tr></table></figure><p><img src="/medias/loading.gif" data-original="https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20210217161518715.c3c049c3.png" alt="img"></p><h5 id="测试删除数据接口"><a href="#测试删除数据接口" class="headerlink" title="测试删除数据接口"></a>测试删除数据接口</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http</span>:<span class="comment">//127.0.0.1:8000/book/book/1/</span></span><br></pre></td></tr></table></figure><h2 id="Serializer"><a href="#Serializer" class="headerlink" title="Serializer"></a>Serializer</h2><h3 id="Serializer介绍"><a href="#Serializer介绍" class="headerlink" title="Serializer介绍"></a>Serializer介绍</h3><ul><li>Serializer三个作用</li><li>第一：序列化</li><li>第二: 反序列化</li><li>第三：数据校验</li></ul><h4 id="定义Serializer"><a href="#定义Serializer" class="headerlink" title="定义Serializer"></a>定义Serializer</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> book.models <span class="keyword">import</span> BookInfo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">APIViewBookInfoSerializer</span>(serializers.Serializer):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">id</span> = serializers.IntegerField(label=<span class="string">&#x27;ID&#x27;</span>, read_only=<span class="literal">True</span>)       <span class="comment"># 主键序列化</span></span><br><span class="line">    <span class="comment"># 第一：普通字段序列化</span></span><br><span class="line">    btitle = serializers.CharField(label=<span class="string">&#x27;名称&#x27;</span>, max_length=<span class="number">20</span>)</span><br><span class="line">    bpub_date = serializers.DateField(label=<span class="string">&#x27;发布日期&#x27;</span>)</span><br><span class="line">    bread = serializers.IntegerField(label=<span class="string">&#x27;阅读量&#x27;</span>, required=<span class="literal">False</span>)</span><br><span class="line">    bcomment = serializers.IntegerField(label=<span class="string">&#x27;评论量&#x27;</span>, required=<span class="literal">False</span>)</span><br><span class="line">    <span class="comment"># 第二：一对多字段序列化</span></span><br><span class="line">    heroinfo_set = serializers.PrimaryKeyRelatedField(read_only=<span class="literal">True</span>, many=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># 第三：自定义显示（显示多对多）</span></span><br><span class="line">    xxx = serializers.SerializerMethodField(read_only=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = BookInfo</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 自定义显示 多对多 字段</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_xxx</span>(<span class="params">self,row</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;row: 传过来的正是 BookInfo表的对象&#x27;&#x27;&#x27;</span></span><br><span class="line">        books = row.btitle   <span class="comment"># 获取用户名</span></span><br><span class="line">        <span class="keyword">return</span> books</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26</p><h3 id="1-2-序列化：作用1"><a href="#1-2-序列化：作用1" class="headerlink" title="#1.2 序列化：作用1"></a><a target="_blank" rel="noopener" href="http://v5blog.cn/pages/4037e0/#_1-2-%E5%BA%8F%E5%88%97%E5%8C%96-%E4%BD%9C%E7%94%A81">#</a>1.2 序列化：<code>作用1</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">APIViewBookInfoViewSet</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        obj = BookInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">        ser = serializers.BookInfoSerializer1(instance=obj, many=<span class="literal">True</span>)  <span class="comment"># 序列化多条数据</span></span><br><span class="line">        <span class="comment"># ser = serializers.BookInfoSerializer1(instance=obj[0])            # 序列化一条数据</span></span><br><span class="line">        <span class="keyword">return</span> Response(ser.data)</span><br></pre></td></tr></table></figure><h3 id="1-3-反序列化：作用2"><a href="#1-3-反序列化：作用2" class="headerlink" title="#1.3 反序列化：作用2"></a><a target="_blank" rel="noopener" href="http://v5blog.cn/pages/4037e0/#_1-3-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-%E4%BD%9C%E7%94%A82">#</a>1.3 反序列化：<code>作用2</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self,request</span>):</span><br><span class="line">    ser =  serializers.BookInfoSerializer1(data=request.data)</span><br><span class="line">    <span class="comment"># 判断提交数据是否合法</span></span><br><span class="line">    <span class="keyword">if</span> ser.is_valid():</span><br><span class="line">        ser.save()</span><br><span class="line">        <span class="keyword">return</span> Response(data=ser.data, status=<span class="number">201</span>)</span><br><span class="line">    <span class="keyword">return</span> Response(data=ser.errors,status=<span class="number">400</span>)</span><br></pre></td></tr></table></figure><h3 id="1-4-字段校验：作用3"><a href="#1-4-字段校验：作用3" class="headerlink" title="#1.4 字段校验：作用3"></a><a target="_blank" rel="noopener" href="http://v5blog.cn/pages/4037e0/#_1-4-%E5%AD%97%E6%AE%B5%E6%A0%A1%E9%AA%8C-%E4%BD%9C%E7%94%A83">#</a>1.4 字段校验：<code>作用3</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BookInfoSerializer1</span>(serializers.Serializer):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 定义单一字段验证的方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_name</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="keyword">if</span> value == <span class="string">&#x27;root&#x27;</span>:</span><br><span class="line">            <span class="keyword">raise</span> serializers.ValidationError(<span class="string">&#x27;不能创建root管理员账号&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 定义多字段验证方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate</span>(<span class="params">self, attrs</span>):</span><br><span class="line">        <span class="keyword">if</span> attrs[<span class="string">&#x27;name&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">            <span class="keyword">raise</span> serializers.ValidationError(<span class="string">&#x27;不能创建admin用户&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> attrs</span><br></pre></td></tr></table></figure><h3 id="序列化-反序列化"><a href="#序列化-反序列化" class="headerlink" title="序列化&amp;反序列化"></a>序列化&amp;反序列化</h3><h4 id="book-models-py"><a href="#book-models-py" class="headerlink" title="book&#x2F;models.py"></a>book&#x2F;models.py</h4><p><img src="/medias/loading.gif" data-original="https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20210217194315866.32871eca.png" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment">#定义图书模型类BookInfo</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookInfo</span>(models.Model):</span><br><span class="line">    btitle = models.CharField(max_length=<span class="number">20</span>, verbose_name=<span class="string">&#x27;名称&#x27;</span>)</span><br><span class="line">    bpub_date = models.DateField(verbose_name=<span class="string">&#x27;发布日期&#x27;</span>)</span><br><span class="line">    bread = models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">&#x27;阅读量&#x27;</span>)</span><br><span class="line">    bcomment = models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">&#x27;评论量&#x27;</span>)</span><br><span class="line">    is_delete = models.BooleanField(default=<span class="literal">False</span>, verbose_name=<span class="string">&#x27;逻辑删除&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        db_table = <span class="string">&#x27;tb_books&#x27;</span>  <span class="comment"># 指明数据库表名</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;图书&#x27;</span>  <span class="comment"># 在admin站点中显示的名称</span></span><br><span class="line">        verbose_name_plural = verbose_name  <span class="comment"># 显示的复数名称</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;定义每个数据对象的显示信息&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.btitle</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义英雄模型类HeroInfo</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HeroInfo</span>(models.Model):</span><br><span class="line">    GENDER_CHOICES = (</span><br><span class="line">        (<span class="number">0</span>, <span class="string">&#x27;female&#x27;</span>),</span><br><span class="line">        (<span class="number">1</span>, <span class="string">&#x27;male&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">    hname = models.CharField(max_length=<span class="number">20</span>, verbose_name=<span class="string">&#x27;名称&#x27;</span>)</span><br><span class="line">    hgender = models.SmallIntegerField(choices=GENDER_CHOICES, default=<span class="number">0</span>, verbose_name=<span class="string">&#x27;性别&#x27;</span>)</span><br><span class="line">    hcomment = models.CharField(max_length=<span class="number">200</span>, null=<span class="literal">True</span>, verbose_name=<span class="string">&#x27;描述信息&#x27;</span>)</span><br><span class="line">    hbook = models.ForeignKey(BookInfo, on_delete=models.CASCADE, verbose_name=<span class="string">&#x27;图书&#x27;</span>)  <span class="comment"># 外键</span></span><br><span class="line">    is_delete = models.BooleanField(default=<span class="literal">False</span>, verbose_name=<span class="string">&#x27;逻辑删除&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        db_table = <span class="string">&#x27;tb_heros&#x27;</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;英雄&#x27;</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.hname</span><br></pre></td></tr></table></figure><h4 id="book-serializers-py"><a href="#book-serializers-py" class="headerlink" title="book&#x2F;serializers.py"></a>book&#x2F;serializers.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> book.models <span class="keyword">import</span> BookInfo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookInfoSerializer1</span>(serializers.Serializer):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">id</span> = serializers.IntegerField(label=<span class="string">&#x27;ID&#x27;</span>, read_only=<span class="literal">True</span>)       <span class="comment"># 主键序列化</span></span><br><span class="line">    <span class="comment"># 第一：普通字段序列化</span></span><br><span class="line">    btitle = serializers.CharField(label=<span class="string">&#x27;名称&#x27;</span>, max_length=<span class="number">20</span>)</span><br><span class="line">    bpub_date = serializers.DateField(label=<span class="string">&#x27;发布日期&#x27;</span>)</span><br><span class="line">    bread = serializers.IntegerField(label=<span class="string">&#x27;阅读量&#x27;</span>, required=<span class="literal">False</span>)</span><br><span class="line">    bcomment = serializers.IntegerField(label=<span class="string">&#x27;评论量&#x27;</span>, required=<span class="literal">False</span>)</span><br><span class="line">    <span class="comment"># 第二：一对多字段序列化</span></span><br><span class="line">    heroinfo_set = serializers.PrimaryKeyRelatedField(read_only=<span class="literal">True</span>, many=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># 第三：自定义显示（显示多对多）</span></span><br><span class="line">    xxx = serializers.SerializerMethodField(read_only=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = BookInfo</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 自定义显示 多对多 字段</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_xxx</span>(<span class="params">self,row</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;row: 传过来的正是 BookInfo表的对象&#x27;&#x27;&#x27;</span></span><br><span class="line">        books = row.btitle   <span class="comment"># 获取用户名</span></span><br><span class="line">        <span class="keyword">return</span> books</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 定义创建语法：ser.save()执行，就会立刻调用create方法用来创建数据</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">self, validated_data</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;validated_data: 表单或者vue请求携带的json：&#123;&quot;username&quot;:&quot;zhangsan&quot;,&quot;password&quot;:&quot;123456&quot;&#125;&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.Meta.model.objects.create(**validated_data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 定义更新方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, instance, validated_data</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        instance : 查询的对象</span></span><br><span class="line"><span class="string">        validated_data :  postman提交的json数据 &#123;&quot;username&quot;:&quot;zhangsan&quot;,&quot;password&quot;:&quot;123456&quot;&#125;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> validated_data.get(<span class="string">&#x27;btitle&#x27;</span>):</span><br><span class="line">            instance.btitle = validated_data[<span class="string">&#x27;btitle&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> validated_data.get(<span class="string">&#x27;bpub_date&#x27;</span>):</span><br><span class="line">            instance.bpub_date = validated_data[<span class="string">&#x27;bpub_date&#x27;</span>]</span><br><span class="line">        instance.save()</span><br><span class="line">        <span class="keyword">return</span> instance</span><br></pre></td></tr></table></figure><h4 id="book-views-py"><a href="#book-views-py" class="headerlink" title="book&#x2F;views.py"></a>book&#x2F;views.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> book <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> book.models <span class="keyword">import</span> BookInfo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">APIViewBookInfoViewSet</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        obj = BookInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">        ser = serializers.BookInfoSerializer1(instance=obj, many=<span class="literal">True</span>)  <span class="comment"># 关联数据多条</span></span><br><span class="line">        <span class="comment"># ser = serializers.BookInfoSerializer1(instance=obj[0])           # 关联数据一条</span></span><br><span class="line">        <span class="keyword">return</span> Response(ser.data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self,request</span>):</span><br><span class="line">        ser =  serializers.BookInfoSerializer1(data=request.data)</span><br><span class="line">        <span class="comment"># 判断提交数据是否合法</span></span><br><span class="line">        <span class="keyword">if</span> ser.is_valid():</span><br><span class="line">            ser.save()</span><br><span class="line">            <span class="keyword">return</span> Response(data=ser.data, status=<span class="number">201</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(data=ser.errors,status=<span class="number">400</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 更新</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">put</span>(<span class="params">self, request</span>):</span><br><span class="line">        pk = request.query_params.get(<span class="string">&#x27;pk&#x27;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            bookinfo = BookInfo.objects.get(<span class="built_in">id</span> = pk)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> Response(data=<span class="string">&#x27;不存在&#x27;</span>, status=<span class="number">201</span>)</span><br><span class="line">        <span class="comment"># 创建序列化对象，并将要反序列化的数据传递给data构造参数，进而进行验证</span></span><br><span class="line">        ser = serializers.BookInfoSerializer1(bookinfo, data=request.data)</span><br><span class="line">        <span class="keyword">if</span> ser.is_valid():</span><br><span class="line">            ser.save()</span><br><span class="line">            <span class="keyword">return</span> Response(data=ser.data, status=<span class="number">201</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(data=ser.errors,status=<span class="number">400</span>)</span><br></pre></td></tr></table></figure><h4 id="book-urls-py"><a href="#book-urls-py" class="headerlink" title="[ book&#x2F;urls.py"></a>[ book&#x2F;urls.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> re_path,path</span><br><span class="line"><span class="keyword">from</span> book <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;book1/&#x27;</span>, views.APIViewBookInfoViewSet.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="测试接口"><a href="#测试接口" class="headerlink" title="测试接口"></a>测试接口</h4><h5 id="get获取数据"><a href="#get获取数据" class="headerlink" title="get获取数据"></a>get获取数据</h5><blockquote><p><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/book/book1/">http://127.0.0.1:8000/book/book1/</a></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;btitle&quot;</span>: <span class="string">&quot;西游记&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bpub_date&quot;</span>: <span class="string">&quot;2020-08-11&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bread&quot;</span>: <span class="number">666</span>,</span><br><span class="line">        <span class="string">&quot;bcomment&quot;</span>: <span class="number">123</span>,</span><br><span class="line">        <span class="string">&quot;heroinfo_set&quot;</span>: [],</span><br><span class="line">        <span class="string">&quot;xxx&quot;</span>: <span class="string">&quot;西游记&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&quot;btitle&quot;</span>: <span class="string">&quot;水浒传&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bpub_date&quot;</span>: <span class="string">&quot;2020-08-11&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bread&quot;</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="string">&quot;bcomment&quot;</span>: <span class="number">100</span>,</span><br><span class="line">        <span class="string">&quot;heroinfo_set&quot;</span>: [],</span><br><span class="line">        <span class="string">&quot;xxx&quot;</span>: <span class="string">&quot;水浒传&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h5 id="post添加数据"><a href="#post添加数据" class="headerlink" title="post添加数据"></a>post添加数据</h5><blockquote><p><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/book/book1/">http://127.0.0.1:8000/book/book1/</a></p></blockquote><p><img src="/medias/loading.gif" data-original="https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20210217181023301.90459b60.png" alt="img"></p><h5 id="put修改数据"><a href="#put修改数据" class="headerlink" title="put修改数据"></a>put修改数据</h5><blockquote><p><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/book/book1/?pk=4">http://127.0.0.1:8000/book/book1/?pk=4</a></p></blockquote><p><img src="/medias/loading.gif" data-original="https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20210217181515171.f1ff07c7.png" alt="img"></p><h3 id="嵌套序列化"><a href="#嵌套序列化" class="headerlink" title="嵌套序列化"></a>嵌套序列化</h3><h4 id="book-serializers-py-1"><a href="#book-serializers-py-1" class="headerlink" title="book&#x2F;serializers.py"></a>book&#x2F;serializers.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> book.models <span class="keyword">import</span> BookInfo,HeroInfo</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HeroInfoSerializer</span>(serializers.Serializer):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;英雄数据序列化器&quot;&quot;&quot;</span></span><br><span class="line">    GENDER_CHOICES = (</span><br><span class="line">        (<span class="number">0</span>, <span class="string">&#x27;男&#x27;</span>),</span><br><span class="line">        (<span class="number">1</span>, <span class="string">&#x27;女&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">id</span> = serializers.IntegerField(label=<span class="string">&#x27;ID&#x27;</span>, read_only=<span class="literal">True</span>)</span><br><span class="line">    hname = serializers.CharField(label=<span class="string">&#x27;名字&#x27;</span>, max_length=<span class="number">20</span>)</span><br><span class="line">    hgender = serializers.ChoiceField(label=<span class="string">&#x27;性别&#x27;</span>, choices=GENDER_CHOICES, required=<span class="literal">False</span>)</span><br><span class="line">    hcomment = serializers.CharField(label=<span class="string">&#x27;描述信息&#x27;</span>, max_length=<span class="number">200</span>, required=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = HeroInfo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookInfoSerializer1</span>(serializers.Serializer):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">id</span> = serializers.IntegerField(label=<span class="string">&#x27;ID&#x27;</span>, read_only=<span class="literal">True</span>)       <span class="comment"># 主键序列化</span></span><br><span class="line">    <span class="comment"># 第一：普通字段序列化</span></span><br><span class="line">    btitle = serializers.CharField(label=<span class="string">&#x27;名称&#x27;</span>, max_length=<span class="number">20</span>)</span><br><span class="line">    bpub_date = serializers.DateField(label=<span class="string">&#x27;发布日期&#x27;</span>)</span><br><span class="line">    bread = serializers.IntegerField(label=<span class="string">&#x27;阅读量&#x27;</span>, required=<span class="literal">False</span>)</span><br><span class="line">    bcomment = serializers.IntegerField(label=<span class="string">&#x27;评论量&#x27;</span>, required=<span class="literal">False</span>)</span><br><span class="line">    <span class="comment"># 第二：一对多字段序列化</span></span><br><span class="line">    <span class="comment"># heroinfo_set = serializers.PrimaryKeyRelatedField(read_only=True, many=True)</span></span><br><span class="line">    heroinfo_set = HeroInfoSerializer(many=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># 第三：自定义显示（显示多对多）</span></span><br><span class="line">    xxx = serializers.SerializerMethodField(read_only=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = BookInfo</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 自定义显示 多对多 字段</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_xxx</span>(<span class="params">self,row</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;row: 传过来的正是 BookInfo表的对象&#x27;&#x27;&#x27;</span></span><br><span class="line">        books = row.btitle   <span class="comment"># 获取用户名</span></span><br><span class="line">        <span class="keyword">return</span> books</span><br></pre></td></tr></table></figure><h4 id="查询结果"><a href="#查询结果" class="headerlink" title="查询结果"></a>查询结果</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;btitle&quot;</span>: <span class="string">&quot;西游记&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bpub_date&quot;</span>: <span class="string">&quot;2020-08-11&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bread&quot;</span>: <span class="number">666</span>,</span><br><span class="line">        <span class="string">&quot;bcomment&quot;</span>: <span class="number">123</span>,</span><br><span class="line">        <span class="string">&quot;heroinfo_set&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;hname&quot;</span>: <span class="string">&quot;孙悟空&quot;</span>,</span><br><span class="line">                <span class="string">&quot;hgender&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;hcomment&quot;</span>: <span class="string">&quot;七十二变&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="string">&quot;hname&quot;</span>: <span class="string">&quot;猪八戒&quot;</span>,</span><br><span class="line">                <span class="string">&quot;hgender&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;hcomment&quot;</span>: <span class="string">&quot;天蓬元帅&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;xxx&quot;</span>: <span class="string">&quot;西游记&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&quot;btitle&quot;</span>: <span class="string">&quot;水浒传&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bpub_date&quot;</span>: <span class="string">&quot;2020-08-11&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bread&quot;</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="string">&quot;bcomment&quot;</span>: <span class="number">100</span>,</span><br><span class="line">        <span class="string">&quot;heroinfo_set&quot;</span>: [],</span><br><span class="line">        <span class="string">&quot;xxx&quot;</span>: <span class="string">&quot;水浒传&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="string">&quot;btitle&quot;</span>: <span class="string">&quot;红楼梦&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bpub_date&quot;</span>: <span class="string">&quot;2020-08-11&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bread&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;bcomment&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;heroinfo_set&quot;</span>: [],</span><br><span class="line">        <span class="string">&quot;xxx&quot;</span>: <span class="string">&quot;红楼梦&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="string">&quot;btitle&quot;</span>: <span class="string">&quot;三国演义2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bpub_date&quot;</span>: <span class="string">&quot;2018-08-19&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bread&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;bcomment&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;heroinfo_set&quot;</span>: [],</span><br><span class="line">        <span class="string">&quot;xxx&quot;</span>: <span class="string">&quot;三国演义2&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="字段类型和选项参数"><a href="#字段类型和选项参数" class="headerlink" title="字段类型和选项参数"></a>字段类型和选项参数</h3><h4 id="通用参数"><a href="#通用参数" class="headerlink" title="通用参数"></a>通用参数</h4><ul><li>无论哪种字段类型都可以使用的选项参数。</li></ul><table><thead><tr><th>参数名称</th><th>说明</th></tr></thead><tbody><tr><td><strong>read_only</strong></td><td>表明该字段仅用于序列化输出，默认False</td></tr><tr><td><strong>write_only</strong></td><td>表明该字段仅用于反序列化输入，默认False</td></tr><tr><td><strong>required</strong></td><td>表明该字段在反序列化时必须输入，默认True</td></tr><tr><td><strong>default</strong></td><td>序列化和反序列化时使用的默认值</td></tr><tr><td><strong>error_messages</strong></td><td>包含错误编号与错误信息的字典</td></tr><tr><td><strong>label</strong></td><td>用于HTML展示API页面时，显示的字段名称</td></tr></tbody></table><blockquote><p>注：定义序列化器类的字段时，如果没有指定read_only和write_only，则这两个参数默认值都为False，表明对应的字段既在序列化时使用，也在反序列化时使用。</p></blockquote><h4 id="常用字段类型"><a href="#常用字段类型" class="headerlink" title="常用字段类型"></a>常用字段类型</h4><table><thead><tr><th>字段</th><th>字段构造方式</th></tr></thead><tbody><tr><td><strong>BooleanField</strong></td><td>BooleanField()</td></tr><tr><td><strong>NullBooleanField</strong></td><td>NullBooleanField()</td></tr><tr><td><strong>CharField</strong></td><td>CharField(max_length&#x3D;None, min_length&#x3D;None, allow_blank&#x3D;False, trim_whitespace&#x3D;True)</td></tr><tr><td><strong>EmailField</strong></td><td>EmailField(max_length&#x3D;None, min_length&#x3D;None, allow_blank&#x3D;False)</td></tr><tr><td><strong>RegexField</strong></td><td>RegexField(regex, max_length&#x3D;None, min_length&#x3D;None, allow_blank&#x3D;False)</td></tr><tr><td><strong>SlugField</strong></td><td>SlugField(max_length&#x3D;50, min<em>length&#x3D;None, allow_blank&#x3D;False) 正则字段，验证正则模式 [-a-zA-Z0-9</em>-]+</td></tr><tr><td><strong>URLField</strong></td><td>URLField(max_length&#x3D;200, min_length&#x3D;None, allow_blank&#x3D;False)</td></tr><tr><td><strong>UUIDField</strong></td><td>UUIDField(format&#x3D;’hex_verbose’) format: 1) <code>&#39;hex_verbose&#39;</code> 如<code>&quot;5ce0e9a5-5ffa-654b-cee0-1238041fb31a&quot;</code> 2） <code>&#39;hex&#39;</code> 如 <code>&quot;5ce0e9a55ffa654bcee01238041fb31a&quot;</code> 3）<code>&#39;int&#39;</code> - 如: <code>&quot;123456789012312313134124512351145145114&quot;</code> 4）<code>&#39;urn&#39;</code> 如: <code>&quot;urn:uuid:5ce0e9a5-5ffa-654b-cee0-1238041fb31a&quot;</code></td></tr><tr><td><strong>IPAddressField</strong></td><td>IPAddressField(protocol&#x3D;’both’, unpack_ipv4&#x3D;False, **options)</td></tr><tr><td><strong>IntegerField</strong></td><td>IntegerField(max_value&#x3D;None, min_value&#x3D;None)</td></tr><tr><td><strong>FloatField</strong></td><td>FloatField(max_value&#x3D;None, min_value&#x3D;None)</td></tr><tr><td><strong>DecimalField</strong></td><td>DecimalField(max_digits, decimal_places, coerce_to_string&#x3D;None, max_value&#x3D;None, min_value&#x3D;None) max_digits: 最多位数 decimal_palces: 小数点位置</td></tr><tr><td><strong>DateTimeField</strong></td><td>DateTimeField(format&#x3D;api_settings.DATETIME_FORMAT, input_formats&#x3D;None)</td></tr><tr><td><strong>DateField</strong></td><td>DateField(format&#x3D;api_settings.DATE_FORMAT, input_formats&#x3D;None)</td></tr><tr><td><strong>TimeField</strong></td><td>TimeField(format&#x3D;api_settings.TIME_FORMAT, input_formats&#x3D;None)</td></tr><tr><td><strong>DurationField</strong></td><td>DurationField()</td></tr><tr><td><strong>ChoiceField</strong></td><td>ChoiceField(choices) choices与Django的用法相同</td></tr><tr><td><strong>MultipleChoiceField</strong></td><td>MultipleChoiceField(choices)</td></tr><tr><td><strong>FileField</strong></td><td>FileField(max_length&#x3D;None, allow_empty_file&#x3D;False, use_url&#x3D;UPLOADED_FILES_USE_URL)</td></tr><tr><td><strong>ImageField</strong></td><td>ImageField(max_length&#x3D;None, allow_empty_file&#x3D;False, use_url&#x3D;UPLOADED_FILES_USE_URL)</td></tr><tr><td><strong>ListField</strong></td><td>ListField(child&#x3D;, min_length&#x3D;None, max_length&#x3D;None)</td></tr><tr><td><strong>DictField</strong></td><td>DictField(child&#x3D;)</td></tr></tbody></table><h2 id="ModelSerializer"><a href="#ModelSerializer" class="headerlink" title="ModelSerializer"></a>ModelSerializer</h2><h3 id="ModelSerializer-1"><a href="#ModelSerializer-1" class="headerlink" title="ModelSerializer"></a>ModelSerializer</h3><h4 id="ModelSerializer特点"><a href="#ModelSerializer特点" class="headerlink" title="ModelSerializer特点"></a>ModelSerializer特点</h4><ul><li>ModelSerializer是Serializer类的子类</li><li>相对于Serializer，增加了以下功能：<ul><li>基于模型类字段自动生成序列化器类的字段</li><li>包含默认的create()和update()方法的实现</li></ul></li></ul><h4 id="定义ModelSerializer语法"><a href="#定义ModelSerializer语法" class="headerlink" title="定义ModelSerializer语法"></a>定义ModelSerializer语法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookInfoSerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;图书序列化器类&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = BookInfo</span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span></span><br><span class="line">        <span class="comment"># exclude = (&#x27;is_delete&#x27;,)</span></span><br><span class="line">        extra_kwargs = &#123;</span><br><span class="line">            <span class="string">&#x27;bread&#x27;</span>: &#123;<span class="string">&#x27;min_value&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;required&#x27;</span>: <span class="literal">True</span>&#125;,</span><br><span class="line">            <span class="string">&#x27;bcomment&#x27;</span>: &#123;<span class="string">&#x27;min_value&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;required&#x27;</span>: <span class="literal">True</span>&#125;,</span><br><span class="line">            <span class="string">&#x27;btitle&#x27;</span>: &#123;<span class="string">&#x27;min_length&#x27;</span>: <span class="number">3</span>&#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h4 id="查看自动生成字段"><a href="#查看自动生成字段" class="headerlink" title="查看自动生成字段"></a>查看自动生成字段</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(django2<span class="number">.2</span>) C:\tmp\drf_demo&gt;python manage.py shell -i ipython</span><br><span class="line">In [<span class="number">1</span>]: <span class="keyword">from</span> book.serializers <span class="keyword">import</span> BookInfoSerializer2</span><br><span class="line">In [<span class="number">2</span>]: book = BookInfoSerializer2()</span><br><span class="line">In [<span class="number">3</span>]: book</span><br><span class="line">BookInfoSerializer2():</span><br><span class="line">    <span class="built_in">id</span> = IntegerField(label=<span class="string">&#x27;ID&#x27;</span>, read_only=<span class="literal">True</span>)</span><br><span class="line">    heroinfo_set = HeroInfoSerializer(many=<span class="literal">True</span>):</span><br><span class="line">        <span class="built_in">id</span> = IntegerField(label=<span class="string">&#x27;ID&#x27;</span>, read_only=<span class="literal">True</span>)</span><br><span class="line">        hname = CharField(label=<span class="string">&#x27;名字&#x27;</span>, max_length=<span class="number">20</span>)</span><br><span class="line">        hgender = ChoiceField(choices=((<span class="number">0</span>, <span class="string">&#x27;男&#x27;</span>), (<span class="number">1</span>, <span class="string">&#x27;女&#x27;</span>)), label=<span class="string">&#x27;性别&#x27;</span>, required=<span class="literal">False</span>)</span><br><span class="line">        hcomment = CharField(label=<span class="string">&#x27;描述信息&#x27;</span>, max_length=<span class="number">200</span>, required=<span class="literal">False</span>)</span><br><span class="line">    btitle = CharField(label=<span class="string">&#x27;名称&#x27;</span>, max_length=<span class="number">20</span>)</span><br><span class="line">    bpub_date = DateField(label=<span class="string">&#x27;发布日期&#x27;</span>)</span><br><span class="line">    bread = IntegerField(label=<span class="string">&#x27;阅读量&#x27;</span>, required=<span class="literal">False</span>)</span><br><span class="line">    bcomment = IntegerField(label=<span class="string">&#x27;评论量&#x27;</span>, required=<span class="literal">False</span>)</span><br><span class="line">    is_delete = BooleanField(label=<span class="string">&#x27;逻辑删除&#x27;</span>, required=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><h3 id="ModelSerializer使用"><a href="#ModelSerializer使用" class="headerlink" title="ModelSerializer使用"></a>ModelSerializer使用</h3><h4 id="book-serializers-py-2"><a href="#book-serializers-py-2" class="headerlink" title="book&#x2F;serializers.py"></a>book&#x2F;serializers.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> book.models <span class="keyword">import</span> BookInfo,HeroInfo</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HeroInfoSerializer</span>(serializers.Serializer):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;英雄数据序列化器&quot;&quot;&quot;</span></span><br><span class="line">    GENDER_CHOICES = (</span><br><span class="line">        (<span class="number">0</span>, <span class="string">&#x27;男&#x27;</span>),</span><br><span class="line">        (<span class="number">1</span>, <span class="string">&#x27;女&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">id</span> = serializers.IntegerField(label=<span class="string">&#x27;ID&#x27;</span>, read_only=<span class="literal">True</span>)</span><br><span class="line">    hname = serializers.CharField(label=<span class="string">&#x27;名字&#x27;</span>, max_length=<span class="number">20</span>)</span><br><span class="line">    hgender = serializers.ChoiceField(label=<span class="string">&#x27;性别&#x27;</span>, choices=GENDER_CHOICES, required=<span class="literal">False</span>)</span><br><span class="line">    hcomment = serializers.CharField(label=<span class="string">&#x27;描述信息&#x27;</span>, max_length=<span class="number">200</span>, required=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = HeroInfo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookInfoSerializer2</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="comment"># 字段名名, 必须是模型可以 . 引用到的变量</span></span><br><span class="line">    <span class="comment"># BookInfo().   &quot;heroinfo_set&quot;  才能作为字段名,  如果是集合, 需要加many=True,</span></span><br><span class="line">    heroinfo_set = HeroInfoSerializer(many=<span class="literal">True</span>)   <span class="comment"># </span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;图书序列化器类&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = BookInfo</span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="查询结果-1"><a href="#查询结果-1" class="headerlink" title="查询结果"></a>查询结果</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;heroinfo_set&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;hname&quot;</span>: <span class="string">&quot;孙悟空&quot;</span>,</span><br><span class="line">                <span class="string">&quot;hgender&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;hcomment&quot;</span>: <span class="string">&quot;七十二变&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="string">&quot;hname&quot;</span>: <span class="string">&quot;猪八戒&quot;</span>,</span><br><span class="line">                <span class="string">&quot;hgender&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;hcomment&quot;</span>: <span class="string">&quot;天蓬元帅&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;btitle&quot;</span>: <span class="string">&quot;西游记&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bpub_date&quot;</span>: <span class="string">&quot;2020-08-11&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bread&quot;</span>: <span class="number">666</span>,</span><br><span class="line">        <span class="string">&quot;bcomment&quot;</span>: <span class="number">123</span>,</span><br><span class="line">        <span class="string">&quot;is_delete&quot;</span>: false</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&quot;heroinfo_set&quot;</span>: [],</span><br><span class="line">        <span class="string">&quot;btitle&quot;</span>: <span class="string">&quot;水浒传&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bpub_date&quot;</span>: <span class="string">&quot;2020-08-11&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bread&quot;</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="string">&quot;bcomment&quot;</span>: <span class="number">100</span>,</span><br><span class="line">        <span class="string">&quot;is_delete&quot;</span>: false</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="string">&quot;heroinfo_set&quot;</span>: [],</span><br><span class="line">        <span class="string">&quot;btitle&quot;</span>: <span class="string">&quot;红楼梦&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bpub_date&quot;</span>: <span class="string">&quot;2020-08-11&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bread&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;bcomment&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;is_delete&quot;</span>: false</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="string">&quot;heroinfo_set&quot;</span>: [],</span><br><span class="line">        <span class="string">&quot;btitle&quot;</span>: <span class="string">&quot;三国演义2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bpub_date&quot;</span>: <span class="string">&quot;2018-08-19&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bread&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;bcomment&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;is_delete&quot;</span>: false</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="多对多序列化"><a href="#多对多序列化" class="headerlink" title="多对多序列化"></a>多对多序列化</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> course.models <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CourseSerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Course</span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span>  <span class="comment"># 所有字段</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SectionsSerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Sections</span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChaptersSerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    sections = SectionsSerializer(many=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Chapters</span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CourseDeepSerializer</span>(<span class="title class_ inherited__">CourseSerializer</span>):</span><br><span class="line">    <span class="comment"># 字段名名, 必须是模型可以 . 引用到的变量</span></span><br><span class="line">    <span class="comment"># Course().   &quot;chapters&quot;  才能作为字段名,  如果是集合, 需要加many=True,</span></span><br><span class="line">    chapters = ChaptersSerializer(many=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h2 id="APIVIEW"><a href="#APIVIEW" class="headerlink" title="APIVIEW"></a>APIVIEW</h2><h3 id="DRF全局配置"><a href="#DRF全局配置" class="headerlink" title="DRF全局配置"></a>DRF全局配置</h3><h4 id="settings-py注册"><a href="#settings-py注册" class="headerlink" title="settings.py注册"></a>settings.py注册</h4><ul><li>注册</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;rest_framework&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django_filters&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="全局配置DRF"><a href="#全局配置DRF" class="headerlink" title="全局配置DRF"></a>全局配置DRF</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 过滤器</span></span><br><span class="line"><span class="comment"># 1,安装 django-filter</span></span><br><span class="line"><span class="comment"># 2,注册应用</span></span><br><span class="line"><span class="comment"># 3,配置settings, 在view里配置可过滤的字段</span></span><br><span class="line"><span class="comment"># 4,使用 查询字符串携带过滤信息</span></span><br><span class="line"></span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="comment"># 1.认证器（全局）：用户登录校验用户名密码或者token是否合法</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_AUTHENTICATION_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="comment"># &#x27;rest_framework_jwt.authentication.JSONWebTokenAuthentication&#x27;, # 在DRF中配置JWT认证</span></span><br><span class="line">        <span class="string">&#x27;rest_framework.authentication.SessionAuthentication&#x27;</span>,          <span class="comment"># 使用session时的认证器</span></span><br><span class="line">        <span class="string">&#x27;rest_framework.authentication.BasicAuthentication&#x27;</span>             <span class="comment"># 提交表单时的认证器</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">#2.权限配置（全局）： 顺序靠上的严格（根据不同的用户角色，可以操作不同的表）</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_PERMISSION_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="comment"># &#x27;rest_framework.permissions.IsAdminUser&#x27;,                # 管理员可以访问</span></span><br><span class="line">        <span class="comment"># &#x27;rest_framework.permissions.IsAuthenticated&#x27;,            # 认证用户可以访问</span></span><br><span class="line">        <span class="comment"># &#x27;rest_framework.permissions.IsAuthenticatedOrReadOnly&#x27;,  # 认证用户可以访问, 否则只能读取</span></span><br><span class="line">        <span class="comment"># &#x27;rest_framework.permissions.AllowAny&#x27;,                   # 所有用户都可以访问</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">#3.限流（防爬虫）</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;rest_framework.throttling.AnonRateThrottle&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;rest_framework.throttling.UserRateThrottle&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">#3.1限流策略</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;1000/hour&#x27;</span>,    <span class="comment"># 认证用户每小时100次</span></span><br><span class="line">        <span class="string">&#x27;anon&#x27;</span>: <span class="string">&#x27;300/day&#x27;</span>,       <span class="comment"># 未认证用户每天能访问3次</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;DEFAULT_CONTENT_NEGOTIATION_CLASS&#x27;</span>: <span class="string">&#x27;rest_framework.negotiation.DefaultContentNegotiation&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;DEFAULT_METADATA_CLASS&#x27;</span>: <span class="string">&#x27;rest_framework.metadata.SimpleMetadata&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;DEFAULT_VERSIONING_CLASS&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">#4.分页（全局）：全局分页器, 例如 省市区的数据自定义分页器, 不需要分页</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_PAGINATION_CLASS&#x27;</span>: <span class="string">&#x27;rest_framework.pagination.PageNumberPagination&#x27;</span>,</span><br><span class="line">    <span class="comment"># 每页返回数量</span></span><br><span class="line">    <span class="string">&#x27;PAGE_SIZE&#x27;</span>: <span class="number">10</span>,  <span class="comment"># 默认 None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#5.过滤器后端</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_FILTER_BACKENDS&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;django_filters.rest_framework.DjangoFilterBackend&#x27;</span>,</span><br><span class="line">        <span class="comment"># &#x27;django_filters.rest_framework.backends.DjangoFilterBackend&#x27;, 包路径有变化</span></span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="comment">#5.1过滤排序（全局）：Filtering 过滤排序</span></span><br><span class="line">    <span class="string">&#x27;SEARCH_PARAM&#x27;</span>: <span class="string">&#x27;search&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;ORDERING_PARAM&#x27;</span>: <span class="string">&#x27;ordering&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;NUM_PROXIES&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">#6.版本控制：Versioning  接口版本控制</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_VERSION&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">    <span class="string">&#x27;ALLOWED_VERSIONS&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">    <span class="string">&#x27;VERSION_PARAM&#x27;</span>: <span class="string">&#x27;version&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="APIView基本使用"><a href="#APIView基本使用" class="headerlink" title="APIView基本使用"></a>APIView基本使用</h3><h4 id="book-models-py-1"><a href="#book-models-py-1" class="headerlink" title="book&#x2F;models.py"></a>book&#x2F;models.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment">#定义图书模型类BookInfo</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookInfo</span>(models.Model):</span><br><span class="line">    btitle = models.CharField(max_length=<span class="number">20</span>, verbose_name=<span class="string">&#x27;名称&#x27;</span>)</span><br><span class="line">    bpub_date = models.DateField(verbose_name=<span class="string">&#x27;发布日期&#x27;</span>)</span><br><span class="line">    bread = models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">&#x27;阅读量&#x27;</span>)</span><br><span class="line">    bcomment = models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">&#x27;评论量&#x27;</span>)</span><br><span class="line">    is_delete = models.BooleanField(default=<span class="literal">False</span>, verbose_name=<span class="string">&#x27;逻辑删除&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        db_table = <span class="string">&#x27;tb_books&#x27;</span>  <span class="comment"># 指明数据库表名</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;图书&#x27;</span>  <span class="comment"># 在admin站点中显示的名称</span></span><br><span class="line">        verbose_name_plural = verbose_name  <span class="comment"># 显示的复数名称</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;定义每个数据对象的显示信息&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.btitle</span><br></pre></td></tr></table></figure><h4 id="book-serializers-py-3"><a href="#book-serializers-py-3" class="headerlink" title="book&#x2F;serializers.py"></a>book&#x2F;serializers.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> book.models <span class="keyword">import</span> BookInfo</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookInfoSerializer2</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;图书序列化器类&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = BookInfo</span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="book-views-py-1"><a href="#book-views-py-1" class="headerlink" title="book&#x2F;views.py"></a>book&#x2F;views.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> book <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> book.models <span class="keyword">import</span> BookInfo</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">APIViewBookInfoViewSet</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        obj = BookInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">        ser = serializers.BookInfoSerializer2(instance=obj, many=<span class="literal">True</span>)  <span class="comment"># 关联数据多条</span></span><br><span class="line">        <span class="keyword">return</span> Response(ser.data)</span><br></pre></td></tr></table></figure><h4 id="book-urls-py-1"><a href="#book-urls-py-1" class="headerlink" title="book&#x2F;urls.py"></a>book&#x2F;urls.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> re_path,path</span><br><span class="line"><span class="keyword">from</span> book <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;book1/&#x27;</span>, views.APIViewBookInfoViewSet.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="测试接口-1"><a href="#测试接口-1" class="headerlink" title="测试接口"></a>测试接口</h4><h5 id="get获取数据-1"><a href="#get获取数据-1" class="headerlink" title="get获取数据"></a>get获取数据</h5><blockquote><p><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/book/book1/">http://127.0.0.1:8000/book/book1/</a></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;btitle&quot;</span>: <span class="string">&quot;西游记&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bpub_date&quot;</span>: <span class="string">&quot;2020-08-11&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bread&quot;</span>: <span class="number">666</span>,</span><br><span class="line">        <span class="string">&quot;bcomment&quot;</span>: <span class="number">123</span>,</span><br><span class="line">        <span class="string">&quot;heroinfo_set&quot;</span>: [],</span><br><span class="line">        <span class="string">&quot;xxx&quot;</span>: <span class="string">&quot;西游记&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&quot;btitle&quot;</span>: <span class="string">&quot;水浒传&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bpub_date&quot;</span>: <span class="string">&quot;2020-08-11&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bread&quot;</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="string">&quot;bcomment&quot;</span>: <span class="number">100</span>,</span><br><span class="line">        <span class="string">&quot;heroinfo_set&quot;</span>: [],</span><br><span class="line">        <span class="string">&quot;xxx&quot;</span>: <span class="string">&quot;水浒传&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h5 id="post添加数据-1"><a href="#post添加数据-1" class="headerlink" title="post添加数据"></a>post添加数据</h5><blockquote><p><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/book/book1/">http://127.0.0.1:8000/book/book1/</a></p></blockquote><p><img src="/medias/loading.gif" data-original="https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20210217181023301.90459b60.png" alt="img"></p><h5 id="put修改数据-1"><a href="#put修改数据-1" class="headerlink" title="put修改数据"></a>put修改数据</h5><blockquote><p><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/book/book1/?pk=4">http://127.0.0.1:8000/book/book1/?pk=4</a></p></blockquote><p><img src="/medias/loading.gif" data-original="https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20210217181515171.f1ff07c7.png" alt="img"></p><h3 id="自定义分页"><a href="#自定义分页" class="headerlink" title="自定义分页"></a>自定义分页</h3><h4 id="自定义分页-1"><a href="#自定义分页-1" class="headerlink" title="自定义分页"></a>自定义分页</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework.pagination <span class="keyword">import</span> PageNumberPagination</span><br><span class="line"><span class="keyword">from</span> book <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> book.models <span class="keyword">import</span> BookInfo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分页（局部）：自定义分页器 局部</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PageNum</span>(<span class="title class_ inherited__">PageNumberPagination</span>):</span><br><span class="line">    <span class="comment"># 查询字符串中代表每页返回数据数量的参数名, 默认值: None</span></span><br><span class="line">    page_size_query_param = <span class="string">&#x27;page_size&#x27;</span></span><br><span class="line">    <span class="comment"># 查询字符串中代表页码的参数名, 有默认值: page</span></span><br><span class="line">    <span class="comment"># page_query_param = &#x27;page&#x27;</span></span><br><span class="line">    <span class="comment"># 一页中最多的结果条数</span></span><br><span class="line">    max_page_size = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">APIViewBookInfoViewSet</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        queryset = BookInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">        <span class="comment"># 分页</span></span><br><span class="line">        pg = PageNum()</span><br><span class="line">        page_objs = pg.paginate_queryset(queryset=queryset, request=request, view=<span class="variable language_">self</span>)</span><br><span class="line">        ser = serializers.BookInfoSerializer2(instance=page_objs, many=<span class="literal">True</span>)  <span class="comment"># 关联数据多条</span></span><br><span class="line">        <span class="keyword">return</span> Response(ser.data)</span><br></pre></td></tr></table></figure><h4 id="测试分页效果"><a href="#测试分页效果" class="headerlink" title="测试分页效果"></a>测试分页效果</h4><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查找第一页，每页显示两条数据</span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/book/book1/?page=1&page_size=2">http://127.0.0.1:8000/book/book1/?page=1&amp;page_size=2</a></p></blockquote><p><img src="/medias/loading.gif" data-original="https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20210217213123806.c06a63de.png" alt="img"></p><h3 id="认证权限"><a href="#认证权限" class="headerlink" title="认证权限"></a>认证权限</h3><h4 id="使用自带权限"><a href="#使用自带权限" class="headerlink" title="使用自带权限"></a>使用自带权限</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注：认证类都在 `rest_framework.authentication` 模块中</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.authentication <span class="keyword">import</span> SessionAuthentication</span><br><span class="line"><span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> IsAuthenticated, AllowAny</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">APIViewBookInfoViewSet</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line">    authentication_classes = (SessionAuthentication,)</span><br><span class="line">    <span class="comment"># permission_classes = [IsAuthenticated]   # 只有认证用户才能访问接口</span></span><br><span class="line">    permission_classes = [AllowAny]   <span class="comment"># 只有认证用户才能访问接口</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        queryset = BookInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">        <span class="comment"># 分页</span></span><br><span class="line">        pg = PageNum()</span><br><span class="line">        page_objs = pg.paginate_queryset(queryset=queryset, request=request, view=<span class="variable language_">self</span>)</span><br><span class="line">        ser = serializers.BookInfoSerializer2(instance=page_objs, many=<span class="literal">True</span>)  <span class="comment"># 关联数据多条</span></span><br><span class="line">        <span class="keyword">return</span> Response(ser.data)</span><br></pre></td></tr></table></figure><h4 id="自定义权限"><a href="#自定义权限" class="headerlink" title="自定义权限"></a>自定义权限</h4><h5 id="自定义权限-1"><a href="#自定义权限-1" class="headerlink" title="自定义权限"></a>自定义权限</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> BasePermission</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义权限（局部）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPermission</span>(<span class="title class_ inherited__">BasePermission</span>):</span><br><span class="line">    <span class="comment"># has_permission 是用户对这个视图有没有 GET POST PUT PATCH DELETE 权限的分别判断</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">has_permission</span>(<span class="params">self, request, view</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;has_perm&#x27;</span>)</span><br><span class="line">        <span class="comment"># print(view.kwargs.get(&quot;pk&quot;), request.user.id)</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;判断用户对模型有没有访问权&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 任何用户对使用此权限类的视图都有访问权限</span></span><br><span class="line">        <span class="keyword">if</span> request.user.is_superuser:</span><br><span class="line">            <span class="comment"># 管理员对用户模型有访问权</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">elif</span> view.kwargs.get(<span class="string">&#x27;pk&#x27;</span>) == <span class="built_in">str</span>(request.user.<span class="built_in">id</span>):</span><br><span class="line">            <span class="comment"># 携带的id和用户的id相同时有访问权</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># has_object_permission 是用户过了 has_permission 判断有权限以后，再判断这个用户有没有对一个具体的对象有没有操作权限</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">has_object_permission</span>(<span class="params">self, request, view, obj</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;has_object_perm&#x27;</span>)</span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取单个数据时,判断用户对某个数据对象是否有访问权限&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> request.user.<span class="built_in">id</span> == obj.<span class="built_in">id</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure><h5 id="使用自定义权限"><a href="#使用自定义权限" class="headerlink" title="使用自定义权限"></a>使用自定义权限</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注：认证类都在 `rest_framework.authentication` 模块中</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.authentication <span class="keyword">import</span> SessionAuthentication</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">APIViewBookInfoViewSet</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line">    authentication_classes = (SessionAuthentication,)</span><br><span class="line">    permission_classes = [MyPermission,]     <span class="comment"># 只有认证用户才能访问接口</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        queryset = BookInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">        <span class="comment"># 分页</span></span><br><span class="line">        pg = PageNum()</span><br><span class="line">        page_objs = pg.paginate_queryset(queryset=queryset, request=request, view=<span class="variable language_">self</span>)</span><br><span class="line">        ser = serializers.BookInfoSerializer2(instance=page_objs, many=<span class="literal">True</span>)  <span class="comment"># 关联数据多条</span></span><br><span class="line">        <span class="keyword">return</span> Response(ser.data)</span><br></pre></td></tr></table></figure><h3 id="限流"><a href="#限流" class="headerlink" title="限流"></a>限流</h3><h4 id="全局配置"><a href="#全局配置" class="headerlink" title="全局配置"></a>全局配置</h4><ul><li><code>DEFAULT_THROTTLE_RATES</code> 可以使用 <code>second</code>、<code>minute</code>、<code>hour</code> 或<code>day</code>来指明限流周期。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment"># 针对匿名用户和认证通过用户分别进行限流控制</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>: (</span><br><span class="line">        <span class="comment"># 针对未登录(匿名)用户的限流控制类</span></span><br><span class="line">        <span class="string">&#x27;rest_framework.throttling.AnonRateThrottle&#x27;</span>,</span><br><span class="line">        <span class="comment"># 针对登录(认证通过)用户的限流控制类</span></span><br><span class="line">        <span class="string">&#x27;rest_framework.throttling.UserRateThrottle&#x27;</span></span><br><span class="line">    ),</span><br><span class="line">    <span class="comment"># 指定限流频次</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span>: &#123;</span><br><span class="line">        <span class="comment"># 认证用户的限流频次</span></span><br><span class="line">        <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;5/minute&#x27;</span>,</span><br><span class="line">        <span class="comment"># 匿名用户的限流频次</span></span><br><span class="line">        <span class="string">&#x27;anon&#x27;</span>: <span class="string">&#x27;3/minute&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="指定视图配置"><a href="#指定视图配置" class="headerlink" title="指定视图配置"></a>指定视图配置</h4><ul><li>也可以某个视图中通过 <code>throttle_classes</code> 属性来指定某视图所使用的限流控制类</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.throttling <span class="keyword">import</span> AnonRateThrottle</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookInfoViewSet</span>(<span class="title class_ inherited__">ReadOnlyModelViewSet</span>):</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment"># 此时设置当前视图仅针对匿名用户进行限流控制</span></span><br><span class="line">    throttle_classes = [AnonRateThrottle]</span><br></pre></td></tr></table></figure><h3 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h3><h4 id="自定义过滤"><a href="#自定义过滤" class="headerlink" title="自定义过滤"></a>自定义过滤</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django_filters.rest_framework <span class="keyword">import</span> DjangoFilterBackend</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">APIViewBookInfoViewSet</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line">    filter_backends = (DjangoFilterBackend,)</span><br><span class="line">    <span class="comment"># 指定过滤字段, 不设置, 过滤功能不起效</span></span><br><span class="line">    filter_fields = (<span class="string">&#x27;btitle&#x27;</span>, )  <span class="comment"># ?username=tom&amp;phone=&amp;is_active=true</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">filter_queryset</span>(<span class="params">self, queryset</span>):</span><br><span class="line">        <span class="keyword">for</span> backend <span class="keyword">in</span> <span class="built_in">list</span>(<span class="variable language_">self</span>.filter_backends):</span><br><span class="line">            queryset = backend().filter_queryset(<span class="variable language_">self</span>.request, queryset, <span class="variable language_">self</span>)</span><br><span class="line">        <span class="keyword">return</span> queryset</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        queryset = BookInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">        <span class="comment"># 过滤</span></span><br><span class="line">        queryset = <span class="variable language_">self</span>.filter_queryset(queryset)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 分页</span></span><br><span class="line">        pg = PageNum()</span><br><span class="line">        page_objs = pg.paginate_queryset(queryset=queryset, request=request, view=<span class="variable language_">self</span>)</span><br><span class="line">        ser = serializers.BookInfoSerializer2(instance=page_objs, many=<span class="literal">True</span>)  <span class="comment"># 关联数据多条</span></span><br><span class="line">        <span class="keyword">return</span> Response(ser.data)</span><br></pre></td></tr></table></figure><h4 id="测试过滤功能"><a href="#测试过滤功能" class="headerlink" title="测试过滤功能"></a>测试过滤功能</h4><p><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/book/book1/?btitle=%E8%A5%BF%E6%B8%B8%E8%AE%B0">http://127.0.0.1:8000/book/book1/?btitle=西游记</a></p><p><img src="/medias/loading.gif" data-original="https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20210218085423621.7845ebf5.png" alt="img"></p><h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><h4 id="配置排序"><a href="#配置排序" class="headerlink" title="配置排序"></a>配置排序</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django_filters.rest_framework <span class="keyword">import</span> DjangoFilterBackend</span><br><span class="line"><span class="keyword">from</span> rest_framework.filters <span class="keyword">import</span> OrderingFilter</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">APIViewBookInfoViewSet</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line">    filter_backends = (DjangoFilterBackend,OrderingFilter)</span><br><span class="line">    <span class="comment"># 指定过滤字段, 不设置, 过滤功能不起效</span></span><br><span class="line">    filter_fields = (<span class="string">&#x27;btitle&#x27;</span>, )  <span class="comment"># ?username=tom&amp;phone=&amp;is_active=true</span></span><br><span class="line">    <span class="comment"># 5.1指定排序字段, 不设置, 排序功能不起效</span></span><br><span class="line">    ordering_fields = (<span class="string">&#x27;id&#x27;</span>,)    <span class="comment"># ?ordering=-id</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">filter_queryset</span>(<span class="params">self, queryset</span>):</span><br><span class="line">        <span class="keyword">for</span> backend <span class="keyword">in</span> <span class="built_in">list</span>(<span class="variable language_">self</span>.filter_backends):</span><br><span class="line">            queryset = backend().filter_queryset(<span class="variable language_">self</span>.request, queryset, <span class="variable language_">self</span>)</span><br><span class="line">        <span class="keyword">return</span> queryset</span><br></pre></td></tr></table></figure><h4 id="测试排序功能"><a href="#测试排序功能" class="headerlink" title="测试排序功能"></a>测试排序功能</h4><p><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/book/book1/?ordering=-id">http://127.0.0.1:8000/book/book1/?ordering=-id</a></p><p><img src="/medias/loading.gif" data-original="https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20210218091655102.4c00dd73.png" alt="img"></p><h2 id="初始化项目结构"><a href="#初始化项目结构" class="headerlink" title="初始化项目结构"></a>初始化项目结构</h2><h3 id="初始化项目结构-1"><a href="#初始化项目结构-1" class="headerlink" title="初始化项目结构"></a>初始化项目结构</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">└─shiyanlou_project          <span class="comment"># 项目根路径</span></span><br><span class="line">    │  .gitignore             <span class="comment"># 提交git仓库时，不提交的文件必须要在这里进行标注</span></span><br><span class="line">    │  README.en.md           <span class="comment"># 英文（项目介绍）</span></span><br><span class="line">    │  README.md              <span class="comment"># 中文项目简介</span></span><br><span class="line">    │  requirements.txt       <span class="comment"># django项目安装文件</span></span><br><span class="line">    │</span><br><span class="line">    ├─celery_task            <span class="comment"># 用来存放celery相关文件（以便分布式部署）</span></span><br><span class="line">    │      __init__.py</span><br><span class="line">    │</span><br><span class="line">    ├─db                     <span class="comment"># 数据库相关：1.数据库初始化sql脚本； 2.数据库维护脚本，清理，备份脚本</span></span><br><span class="line">    ├─scrips                 <span class="comment"># 脚本目录：1.定时任务脚本；2.页面静态化脚本；处理项目脚本</span></span><br><span class="line">    ├─logs                   <span class="comment"># 存放日志</span></span><br><span class="line">    ├─packages               <span class="comment"># 外部包，原始的，未配置的：1.七牛云sdk；2.阿里云短信；</span></span><br><span class="line">    └─uwsgi_conf             <span class="comment"># uwsgi配置，日志，pid</span></span><br><span class="line">    │</span><br><span class="line">    │</span><br><span class="line">    └─syl                    <span class="comment"># 真正的django项目（代码）django-admin startproject   项目名</span></span><br><span class="line">        │  apps （python包）                   <span class="comment"># Django各种app模块 </span></span><br><span class="line">        │  libs （python包）                   <span class="comment"># 七牛云sdk+配置（外部下载）</span></span><br><span class="line">        │  utils （python包）                  <span class="comment"># 小工具，常用函数(自己写的)</span></span><br><span class="line">        │  static                 </span><br><span class="line">        │  templates</span><br><span class="line">        │  syl（项目配置）</span><br><span class="line">        │  manager.py</span><br></pre></td></tr></table></figure><p><img src="/medias/loading.gif" data-original="https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20200925112025607.bc2897fc.png" alt="img"></p><h3 id="创建Django项目"><a href="#创建Django项目" class="headerlink" title="创建Django项目"></a>创建Django项目</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@dev:shiyanlou_project<span class="comment"># workon syl</span></span><br><span class="line">(syl) root@dev:shiyanlou_project<span class="comment"># cd /aaa/shiyanlou_project/</span></span><br><span class="line">(syl) root@dev:shiyanlou_project<span class="comment"># django-admin startproject syl</span></span><br><span class="line"><span class="comment"># 注：创建三个python包， apps、utils、libs</span></span><br></pre></td></tr></table></figure><ul><li><p>使用pycharm打开项目</p><ul><li><p>1.右击—-&gt;编辑配置—–&gt;</p><ul><li><pre><code class="text">   PYTHONUNBUFFERED               1 
   DJANGO_SETTINGS_MODULE         syl.settings
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">  - ![img](https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20201026153155814.5e3d43ff.png)</span><br><span class="line">    </span><br><span class="line">- 2.文件----&gt;设置-----&gt;</span><br><span class="line">  </span><br><span class="line">  - ![img](https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20201026153355278.2a5009a1.png)</span><br><span class="line">  </span><br><span class="line">- 3.文件----&gt;设置-----&gt;</span><br><span class="line">  </span><br><span class="line">  - ![img](https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20201026153527196.acc40888.png)</span><br><span class="line"></span><br><span class="line">### 创建user模型</span><br><span class="line"></span><br><span class="line">####  创建用户模型user</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">python ../manage.py startapp user  # 创建user模型</span><br></pre></td></tr></table></figure>
</code></pre></li></ul></li></ul></li></ul><p>1</p><h4 id="在setting-py中注册user模型（第一步）"><a href="#在setting-py中注册user模型（第一步）" class="headerlink" title="在setting.py中注册user模型（第一步）"></a>在setting.py中注册user模型（第一步）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;user.apps.UserConfig&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"><span class="comment"># 注：pycharm无法联想，需要把apps文件夹设置为源根</span></span><br></pre></td></tr></table></figure><ul><li>要想让pycharm识别要这样操作<ul><li><img src="/medias/loading.gif" data-original="https://zhangtq-blog.oss-cn-hangzhou.aliyuncs.com/content_picture/image-20201026185113022.9b1340d1.png" alt="img"></li></ul></li></ul><h4 id="syl-urls-py添加主路由（第二步）"><a href="#syl-urls-py添加主路由（第二步）" class="headerlink" title="syl&#x2F;urls.py添加主路由（第二步）"></a>syl&#x2F;urls.py添加主路由（第二步）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;user/&#x27;</span>, include(<span class="string">&#x27;user.urls&#x27;</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="syl-settings-py中添加apps路径"><a href="#syl-settings-py中添加apps路径" class="headerlink" title="syl&#x2F;settings.py中添加apps路径"></a>syl&#x2F;settings.py中添加apps路径</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 把apps目录插入，到系统包搜索路径第一个位置中</span></span><br><span class="line">sys.path.insert(<span class="number">0</span>,os.path.join(BASE_DIR,<span class="string">&#x27;apps&#x27;</span>))</span><br></pre></td></tr></table></figure><h4 id="创建-user-urls-py子路由文件（第三步）"><a href="#创建-user-urls-py子路由文件（第三步）" class="headerlink" title="创建 user&#x2F;urls.py子路由文件（第三步）"></a>创建 user&#x2F;urls.py子路由文件（第三步）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="重写Django默认认证用户模型"><a href="#重写Django默认认证用户模型" class="headerlink" title="重写Django默认认证用户模型"></a>重写Django默认认证用户模型</h3><h4 id="重写django-user表"><a href="#重写django-user表" class="headerlink" title="重写django user表"></a>重写django user表</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> AbstractUser</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">AbstractUser</span>):</span><br><span class="line">    phone = models.CharField(<span class="string">&#x27;手机号&#x27;</span>,max_length=<span class="number">20</span>)</span><br><span class="line">    img = models.ImageField(upload_to=<span class="string">&#x27;user&#x27;</span>,null=<span class="literal">True</span>)</span><br><span class="line">    nick_name = models.CharField(<span class="string">&#x27;昵称&#x27;</span>,max_length=<span class="number">20</span>)</span><br><span class="line">    address = models.CharField(<span class="string">&#x27;地址&#x27;</span>,max_length=<span class="number">255</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        db_table = <span class="string">&#x27;tb_user&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="syl-settings-py中注册"><a href="#syl-settings-py中注册" class="headerlink" title="syl&#x2F;settings.py中注册"></a>syl&#x2F;settings.py中注册</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注册自己的用户模型类: 应用名.模型名，指定我们重写的User表进行身份验证</span></span><br><span class="line">AUTH_USER_MODEL = <span class="string">&#x27;user.User&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="配置mysql"><a href="#配置mysql" class="headerlink" title="配置mysql"></a>配置mysql</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;1.创建mysql数据库&#x27;&#x27;&#x27;</span></span><br><span class="line">mysql&gt; create database syldatabase charset utf8;</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;2.在syl/settings.py中配置mysql&#x27;&#x27;&#x27;</span></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;syldatabase&#x27;</span>,              <span class="comment"># 指定数据库名称：syldatabase</span></span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>: <span class="string">&#x27;3306&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="生成表"><a href="#生成表" class="headerlink" title="生成表"></a>生成表</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure><h3 id="python中的三种路径"><a href="#python中的三种路径" class="headerlink" title="python中的三种路径"></a>python中的三种路径</h3><h4 id="操作系统绝对路径（第一种）"><a href="#操作系统绝对路径（第一种）" class="headerlink" title="操作系统绝对路径（第一种）"></a>操作系统绝对路径（第一种）</h4><ul><li>django 静态文件查找, 模板查找（第一种）</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 去配置好的 文件夹 中查找指定的文件</span></span><br><span class="line">BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line">STATIC_URL = <span class="string">&#x27;/static/&#x27;</span></span><br><span class="line"><span class="comment"># /teach/shiyanlou_project/syl/apps/user/   # linux</span></span><br><span class="line"><span class="comment"># E:\_000\XSX</span></span><br></pre></td></tr></table></figure><h4 id="django-导包路径（第二种）"><a href="#django-导包路径（第二种）" class="headerlink" title="django 导包路径（第二种）"></a>django 导包路径（第二种）</h4><ul><li>第一：<code>当期文件夹</code></li><li>第二：<code>sys.path</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">导包之前, 包的上级路径, 需要存在于 python system 的 path</span><br><span class="line">sys.path  这是一个列表</span><br><span class="line">```</span><br><span class="line">sys.path.insert(<span class="number">0</span>, os.path.join(BASE_DIR, <span class="string">&#x27;apps&#x27;</span>))</span><br><span class="line">```</span><br><span class="line"><span class="keyword">from</span> xxx <span class="keyword">import</span> yyy  才能成功</span><br></pre></td></tr></table></figure><h4 id="django模型引用（第三种）"><a href="#django模型引用（第三种）" class="headerlink" title="django模型引用（第三种）"></a>django模型引用（第三种）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">想使用 一个 models.py 文件中的模型</span><br><span class="line">apps名称.model模型名</span><br><span class="line"><span class="string">&#x27;users.User&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="ModelViewSet"><a href="#ModelViewSet" class="headerlink" title="ModelViewSet"></a>ModelViewSet</h2><h3 id="DRF初始化"><a href="#DRF初始化" class="headerlink" title="DRF初始化"></a>DRF初始化</h3><ul><li>1.DRF框架的8个核心功能</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>认证（用户登录校验用户名密码或者token是否合法）</span><br><span class="line"><span class="number">2.</span>权限（根据不同的用户角色，可以操作不同的表）</span><br><span class="line"><span class="number">3.</span>限流（限制接口访问速度）</span><br><span class="line"><span class="number">4.</span>序列化（返回json）</span><br><span class="line"><span class="number">5.</span>分页</span><br><span class="line"><span class="number">6.</span>版本（接口版本号，用 v1/v2/v3）</span><br><span class="line">	<span class="comment"># api.example.com/v1/login     # 只有用户名密码登录</span></span><br><span class="line">	<span class="comment"># api.example.com/v2/login     # 手机号，微信 登录</span></span><br><span class="line"><span class="number">7.</span>过滤（username=zhangsan）</span><br><span class="line"><span class="number">8.</span>排序（ordering=-<span class="built_in">id</span>）</span><br></pre></td></tr></table></figure><ul><li><code>2.相关包</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;1.序列化相关&#x27;&#x27;&#x27;</span></span><br><span class="line">serializer</span><br><span class="line">ModelSerializer</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;2.DRF视图函数继承&#x27;&#x27;&#x27;</span></span><br><span class="line">APIView</span><br><span class="line">ModelViewSet</span><br></pre></td></tr></table></figure><h4 id="安装DRF"><a href="#安装DRF" class="headerlink" title="安装DRF"></a>安装DRF</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install djangorestframework==<span class="number">3.11</span><span class="number">.0</span>        <span class="comment"># 安装djangorestframework</span></span><br><span class="line">pip install django-<span class="built_in">filter</span>==<span class="number">2.3</span><span class="number">.0</span>             <span class="comment"># 安装过滤器</span></span><br></pre></td></tr></table></figure><h4 id="在syl-settings-py中注册"><a href="#在syl-settings-py中注册" class="headerlink" title="在syl&#x2F;settings.py中注册"></a>在syl&#x2F;settings.py中注册</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;django_filters&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;rest_framework&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="syl-settings-py配置DRF"><a href="#syl-settings-py配置DRF" class="headerlink" title="syl&#x2F;settings.py配置DRF"></a>syl&#x2F;settings.py配置DRF</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 过滤器</span></span><br><span class="line"><span class="comment"># 1,安装 django-filter</span></span><br><span class="line"><span class="comment"># 2,注册应用</span></span><br><span class="line"><span class="comment"># 3,配置settings, 在view里配置可过滤的字段</span></span><br><span class="line"><span class="comment"># 4,使用 查询字符串携带过滤信息</span></span><br><span class="line"></span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="comment"># 文档报错： AttributeError: ‘AutoSchema’ object has no attribute ‘get_link’</span></span><br><span class="line">    <span class="comment"># 用下面的设置可以解决</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_SCHEMA_CLASS&#x27;</span>: <span class="string">&#x27;rest_framework.schemas.AutoSchema&#x27;</span>,</span><br><span class="line">    <span class="comment"># 默认设置是:</span></span><br><span class="line">    <span class="comment"># &#x27;DEFAULT_SCHEMA_CLASS&#x27;: &#x27;rest_framework.schemas.openapi.AutoSchema&#x27;,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 异常处理器</span></span><br><span class="line">    <span class="comment"># &#x27;EXCEPTION_HANDLER&#x27;: &#x27;user.utils.exception_handler&#x27;,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Base API policies</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_RENDERER_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;rest_framework.renderers.JSONRenderer&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;rest_framework.renderers.BrowsableAPIRenderer&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&#x27;DEFAULT_PARSER_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;rest_framework.parsers.JSONParser&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;rest_framework.parsers.FormParser&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;rest_framework.parsers.MultiPartParser&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment"># 1.认证器（全局）：用户登录校验用户名密码或者token是否合法</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_AUTHENTICATION_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="comment"># &#x27;rest_framework_jwt.authentication.JSONWebTokenAuthentication&#x27;,    # 在DRF中配置JWT认证</span></span><br><span class="line">        <span class="comment"># &#x27;rest_framework.authentication.SessionAuthentication&#x27;,  # 使用session时的认证器</span></span><br><span class="line">        <span class="comment"># &#x27;rest_framework.authentication.BasicAuthentication&#x27;     # 提交表单时的认证器</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">#2.权限配置（全局）： 顺序靠上的严格（根据不同的用户角色，可以操作不同的表）</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_PERMISSION_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="comment"># &#x27;rest_framework.permissions.IsAdminUser&#x27;,                # 管理员可以访问</span></span><br><span class="line">        <span class="comment"># &#x27;rest_framework.permissions.IsAuthenticated&#x27;,            # 认证用户可以访问</span></span><br><span class="line">        <span class="comment"># &#x27;rest_framework.permissions.IsAuthenticatedOrReadOnly&#x27;,  # 认证用户可以访问, 否则只能读取</span></span><br><span class="line">        <span class="comment"># &#x27;rest_framework.permissions.AllowAny&#x27;,                   # 所有用户都可以访问</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">#3.限流（防爬虫）</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;rest_framework.throttling.AnonRateThrottle&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;rest_framework.throttling.UserRateThrottle&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">#3.1限流策略</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;100/hour&#x27;</span>,    <span class="comment"># 认证用户每小时100次</span></span><br><span class="line">        <span class="string">&#x27;anon&#x27;</span>: <span class="string">&#x27;3/day&#x27;</span>,       <span class="comment"># 未认证用户每天能访问3次</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;DEFAULT_CONTENT_NEGOTIATION_CLASS&#x27;</span>: <span class="string">&#x27;rest_framework.negotiation.DefaultContentNegotiation&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;DEFAULT_METADATA_CLASS&#x27;</span>: <span class="string">&#x27;rest_framework.metadata.SimpleMetadata&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;DEFAULT_VERSIONING_CLASS&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">#4.分页（全局）：全局分页器, 例如 省市区的数据自定义分页器, 不需要分页</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_PAGINATION_CLASS&#x27;</span>: <span class="string">&#x27;rest_framework.pagination.PageNumberPagination&#x27;</span>,</span><br><span class="line">    <span class="comment"># 每页返回数量</span></span><br><span class="line">    <span class="string">&#x27;PAGE_SIZE&#x27;</span>: <span class="number">10</span>,  <span class="comment"># 默认 None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#5.过滤器后端</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_FILTER_BACKENDS&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;django_filters.rest_framework.DjangoFilterBackend&#x27;</span>,</span><br><span class="line">        <span class="comment"># &#x27;django_filters.rest_framework.backends.DjangoFilterBackend&#x27;, 包路径有变化</span></span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="comment">#5.1过滤排序（全局）：Filtering 过滤排序</span></span><br><span class="line">    <span class="string">&#x27;SEARCH_PARAM&#x27;</span>: <span class="string">&#x27;search&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;ORDERING_PARAM&#x27;</span>: <span class="string">&#x27;ordering&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;NUM_PROXIES&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">#6.版本控制：Versioning  接口版本控制</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_VERSION&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">    <span class="string">&#x27;ALLOWED_VERSIONS&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">    <span class="string">&#x27;VERSION_PARAM&#x27;</span>: <span class="string">&#x27;version&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Authentication  认证</span></span><br><span class="line">    <span class="comment"># 未认证用户使用的用户类型</span></span><br><span class="line">    <span class="string">&#x27;UNAUTHENTICATED_USER&#x27;</span>: <span class="string">&#x27;django.contrib.auth.models.AnonymousUser&#x27;</span>,</span><br><span class="line">    <span class="comment"># 未认证用户使用的Token值</span></span><br><span class="line">    <span class="string">&#x27;UNAUTHENTICATED_TOKEN&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># View configuration</span></span><br><span class="line">    <span class="string">&#x27;VIEW_NAME_FUNCTION&#x27;</span>: <span class="string">&#x27;rest_framework.views.get_view_name&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;VIEW_DESCRIPTION_FUNCTION&#x27;</span>: <span class="string">&#x27;rest_framework.views.get_view_description&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;NON_FIELD_ERRORS_KEY&#x27;</span>: <span class="string">&#x27;non_field_errors&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Testing</span></span><br><span class="line">    <span class="string">&#x27;TEST_REQUEST_RENDERER_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;rest_framework.renderers.MultiPartRenderer&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;rest_framework.renderers.JSONRenderer&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&#x27;TEST_REQUEST_DEFAULT_FORMAT&#x27;</span>: <span class="string">&#x27;multipart&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Hyperlink settings</span></span><br><span class="line">    <span class="string">&#x27;URL_FORMAT_OVERRIDE&#x27;</span>: <span class="string">&#x27;format&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;FORMAT_SUFFIX_KWARG&#x27;</span>: <span class="string">&#x27;format&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;URL_FIELD_NAME&#x27;</span>: <span class="string">&#x27;url&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Encoding</span></span><br><span class="line">    <span class="string">&#x27;UNICODE_JSON&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&#x27;COMPACT_JSON&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&#x27;STRICT_JSON&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&#x27;COERCE_DECIMAL_TO_STRING&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&#x27;UPLOADED_FILES_USE_URL&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Browseable API</span></span><br><span class="line">    <span class="string">&#x27;HTML_SELECT_CUTOFF&#x27;</span>: <span class="number">1000</span>,</span><br><span class="line">    <span class="string">&#x27;HTML_SELECT_CUTOFF_TEXT&#x27;</span>: <span class="string">&quot;More than &#123;count&#125; items...&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Schemas</span></span><br><span class="line">    <span class="string">&#x27;SCHEMA_COERCE_PATH_PK&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&#x27;SCHEMA_COERCE_METHOD_NAMES&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;retrieve&#x27;</span>: <span class="string">&#x27;read&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;destroy&#x27;</span>: <span class="string">&#x27;delete&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="DRF使用"><a href="#DRF使用" class="headerlink" title="DRF使用"></a>DRF使用</h3><ul><li>认证、权限、限流、分页、过滤、序列化</li></ul><h4 id="user-urls-py"><a href="#user-urls-py" class="headerlink" title="user&#x2F;urls.py"></a>user&#x2F;urls.py</h4><ul><li>ModelViewSet注册路由三部曲</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> include, path</span><br><span class="line"><span class="keyword">from</span> user <span class="keyword">import</span> views</span><br><span class="line"><span class="keyword">from</span> rest_framework.routers <span class="keyword">import</span> SimpleRouter, DefaultRouter</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动生成路由方法, 必须使用视图集</span></span><br><span class="line"><span class="comment"># router = SimpleRouter()  # 没有根路由  /user/ 无法识别</span></span><br><span class="line">router = DefaultRouter()                       <span class="comment"># 1.有根路由</span></span><br><span class="line">router.register(<span class="string">r&#x27;user&#x27;</span>, views.UserViewSet)    <span class="comment"># 2.配置路由</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;index/&#x27;</span>, views.index),</span><br><span class="line">    path(<span class="string">&#x27;api-auth/&#x27;</span>, include(<span class="string">&#x27;rest_framework.urls&#x27;</span>, namespace=<span class="string">&#x27;rest_framework&#x27;</span>))  <span class="comment"># 认证地址</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">urlpatterns += router.urls     <span class="comment"># 3.模块地址</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[&lt;URLPattern <span class="string">&#x27;^user/$&#x27;</span> [name=<span class="string">&#x27;user-list&#x27;</span>]&gt;, </span><br><span class="line"> &lt;URLPattern <span class="string">&#x27;^user\.(?P&lt;format&gt;[a-z0-9]+)/?$&#x27;</span> [name=<span class="string">&#x27;user-list&#x27;</span>]&gt;,</span><br><span class="line"> &lt;URLPattern <span class="string">&#x27;^user/actived/$&#x27;</span> [name=<span class="string">&#x27;user-actived&#x27;</span>]&gt;, </span><br><span class="line"> &lt;URLPattern <span class="string">&#x27;^user/actived\.(?P&lt;format&gt;[a-z0-9]+)/?$&#x27;</span> [name=<span class="string">&#x27;user-actived&#x27;</span>]&gt;, </span><br><span class="line"> &lt;URLPattern <span class="string">&#x27;^user/unactived/$&#x27;</span> [name=<span class="string">&#x27;user-unactived&#x27;</span>]&gt;, </span><br><span class="line"> &lt;URLPattern <span class="string">&#x27;^user/unactived\.(?P&lt;format&gt;[a-z0-9]+)/?$&#x27;</span> [name=<span class="string">&#x27;user-unactived&#x27;</span>]&gt;, &lt;URLPattern <span class="string">&#x27;^user/(?P&lt;pk&gt;[^/.]+)/$&#x27;</span> [name=<span class="string">&#x27;user-detail&#x27;</span>]&gt;, &lt;URLPattern <span class="string">&#x27;^user/(?P&lt;pk&gt;[^/.]+)\.(?P&lt;format&gt;[a-z0-9]+)/?$&#x27;</span> [name=<span class="string">&#x27;user-detail&#x27;</span>]&gt;, &lt;URLPattern <span class="string">&#x27;^$&#x27;</span> [name=<span class="string">&#x27;api-root&#x27;</span>]&gt;, &lt;URLPattern <span class="string">&#x27;^\.(?P&lt;format&gt;[a-z0-9]+)/?$&#x27;</span> [name=<span class="string">&#x27;api-root&#x27;</span>]&gt;] DRF</span><br></pre></td></tr></table></figure><h4 id="serializers-py"><a href="#serializers-py" class="headerlink" title="serializers.py"></a>serializers.py</h4><ul><li>创建<code>user/serializers.py</code>写序列化器</li><li>功能一：数据校验，<code>创建/修改数据</code><ul><li>在创建数据或者修改数据时校验用户提交的数据是否合法</li><li>用户名必须是8位以上，邮箱、手机号是合法的</li></ul></li><li>功能二：序列化<ul><li>把通过model查询的queryset对象转换成JSON格式</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> user.models <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">address_validate</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="comment"># data：是用户提交的地址这个字段的数据（河南省 郑州市）</span></span><br><span class="line">    <span class="comment"># 独立校验器</span></span><br><span class="line">    <span class="comment"># raise serializers.ValidationError(&#x27;请填写实际地址&#x27;)  # 有错就抛出异常</span></span><br><span class="line">    <span class="comment"># 没错就返回数据</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserSerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="comment"># 1.独立校验器：重新设定字段, 替换掉模型中的设定, 重新设定地址的长度为5</span></span><br><span class="line">    <span class="comment"># address_validate是自定义的数据校验函数</span></span><br><span class="line">    address = serializers.CharField(max_length=<span class="number">255</span>, min_length=<span class="number">5</span>, validators=[address_validate])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.单一字段验证（validate_字段名）, 验证地址</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_address</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">if</span> data == <span class="string">&#x27;测试&#x27;</span>:</span><br><span class="line">            <span class="keyword">raise</span> serializers.ValidationError(<span class="string">&#x27;请填写实际地址&#x27;</span>)  <span class="comment"># 有错就抛出异常</span></span><br><span class="line">        <span class="keyword">return</span> data  <span class="comment"># 没错就返回结果</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_phone</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="comment"># 不符合手机号格式</span></span><br><span class="line">        <span class="comment"># raise serializers.ValidationError(&#x27;手机号格式不正确&#x27;)</span></span><br><span class="line">        model = <span class="variable language_">self</span>.root.Meta.model</span><br><span class="line">        num = model.objects.<span class="built_in">filter</span>(phone=data).count()</span><br><span class="line">        <span class="keyword">if</span> num &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> serializers.ValidationError(<span class="string">&#x27;手机号已存在&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.所有属性验证器</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate</span>(<span class="params">self, attrs</span>):</span><br><span class="line">        <span class="comment"># attrs：&#123;&quot;username&quot;:&quot;zhangsan&quot;, &quot;phone&quot;:&quot;18538752511&quot;, ....&#125;</span></span><br><span class="line">        <span class="comment"># 所有属性验证器</span></span><br><span class="line">        <span class="comment"># self.context 中有request和view上下文</span></span><br><span class="line">        <span class="comment"># self.context[&#x27;view&#x27;].action 可以取到动作</span></span><br><span class="line">        <span class="comment"># attrs 是需要序列化的数据</span></span><br><span class="line">        <span class="comment"># raise serializers.ValidationError(&#x27;xxx错误&#x27;)  # 有问题报错</span></span><br><span class="line">        <span class="keyword">return</span> attrs  <span class="comment"># 没问题返回数据</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = User              <span class="comment"># 具体对哪个表进行序列化</span></span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span>  <span class="comment"># 所有字段</span></span><br><span class="line">        <span class="comment"># fields = (&#x27;id&#x27;, )       # 临时添加字段也需要写在这里</span></span><br><span class="line">        <span class="comment"># exclude = [&#x27;id&#x27;]  # 排除 id 字段</span></span><br><span class="line">        <span class="comment"># read_only_fields = (&#x27;&#x27;,)  # 指定字段为 read_only,</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserUnActiveSerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = User</span><br><span class="line">        fields = (<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;is_active&#x27;</span>)  <span class="comment"># 临时添加字段也需要写在这里</span></span><br><span class="line">        <span class="comment"># fields = &#x27;__all__&#x27;  # 所有字段</span></span><br></pre></td></tr></table></figure><h4 id="user-views-py"><a href="#user-views-py" class="headerlink" title="user&#x2F;views.py"></a>user&#x2F;views.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django_filters.rest_framework <span class="keyword">import</span> DjangoFilterBackend</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> viewsets</span><br><span class="line"><span class="keyword">from</span> rest_framework.authentication <span class="keyword">import</span> BasicAuthentication, SessionAuthentication</span><br><span class="line"><span class="keyword">from</span> rest_framework.decorators <span class="keyword">import</span> action</span><br><span class="line"><span class="keyword">from</span> rest_framework.filters <span class="keyword">import</span> OrderingFilter</span><br><span class="line"><span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> AllowAny, IsAdminUser, IsAuthenticated, IsAuthenticatedOrReadOnly</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework.throttling <span class="keyword">import</span> UserRateThrottle</span><br><span class="line"><span class="keyword">from</span> rest_framework.pagination <span class="keyword">import</span> PageNumberPagination</span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> BasePermission, SAFE_METHODS</span><br><span class="line"><span class="keyword">from</span> user.models <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> user.serializers <span class="keyword">import</span> UserSerializer, UserUnActiveSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 需要认证才能访问的视图</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分页（局部）：自定义分页器 局部</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PageNum</span>(<span class="title class_ inherited__">PageNumberPagination</span>):</span><br><span class="line">    <span class="comment"># 查询字符串中代表每页返回数据数量的参数名, 默认值: None</span></span><br><span class="line">    page_size_query_param = <span class="string">&#x27;page_size&#x27;</span></span><br><span class="line">    <span class="comment"># 查询字符串中代表页码的参数名, 有默认值: page</span></span><br><span class="line">    <span class="comment"># page_query_param = &#x27;page&#x27;</span></span><br><span class="line">    <span class="comment"># 一页中最多的结果条数</span></span><br><span class="line">    max_page_size = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义权限（局部）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPermission</span>(<span class="title class_ inherited__">BasePermission</span>):</span><br><span class="line">    <span class="comment"># has_permission 是用户对这个视图有没有 GET POST PUT PATCH DELETE 权限的分别判断</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">has_permission</span>(<span class="params">self, request, view</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;has_perm&#x27;</span>)</span><br><span class="line">        <span class="comment"># print(view.kwargs.get(&quot;pk&quot;), request.user.id)</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;判断用户对模型有没有访问权&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 任何用户对使用此权限类的视图都有访问权限</span></span><br><span class="line">        <span class="keyword">if</span> request.user.is_superuser:</span><br><span class="line">            <span class="comment"># 管理员对用户模型有访问权</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">elif</span> view.kwargs.get(<span class="string">&#x27;pk&#x27;</span>) == <span class="built_in">str</span>(request.user.<span class="built_in">id</span>):</span><br><span class="line">            <span class="comment"># 携带的id和用户的id相同时有访问权</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># has_object_permission 是用户过了 has_permission 判断有权限以后，再判断这个用户有没有对一个具体的对象有没有操作权限</span></span><br><span class="line">    <span class="comment"># 这样设置以后，即使是django admin管理员也只能查询自己user标的信息，不能查询其他用户的单条信息</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">has_object_permission</span>(<span class="params">self, request, view, obj</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;has_object_perm&#x27;</span>)</span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取单个数据时,判断用户对某个数据对象是否有访问权限&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> request.user.<span class="built_in">id</span> == obj.<span class="built_in">id</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserViewSet</span>(viewsets.ModelViewSet):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    完成产品的增删改查</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    queryset = User.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = UserSerializer  <span class="comment"># 优先使用 get_serializer_class 返回的序列化器</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># # 1.认证：自定义认证类, 自定义会覆盖全局配置</span></span><br><span class="line">    <span class="comment"># authentication_classes = (BasicAuthentication, SessionAuthentication)</span></span><br><span class="line">    <span class="comment"># # 2.权限：自定义权限类</span></span><br><span class="line">    <span class="comment"># permission_classes = (MyPermission,)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3.分页：自定义分页器 覆盖全局配置</span></span><br><span class="line">    pagination_class = PageNum</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4.限流：自定义限流类</span></span><br><span class="line">    throttle_classes = [UserRateThrottle]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5.过滤：指定过滤方法类, 排序方法类, 一个或多个</span></span><br><span class="line">    filter_backends = (DjangoFilterBackend, OrderingFilter)  <span class="comment"># 同时支持过滤和排序</span></span><br><span class="line">    <span class="comment"># 5.1指定排序字段, 不设置, 排序功能不起效</span></span><br><span class="line">    ordering_fields = (<span class="string">&#x27;date_joined&#x27;</span>, <span class="string">&#x27;id&#x27;</span>)              <span class="comment"># ?ordering=-id</span></span><br><span class="line">    <span class="comment"># 5.2指定过滤字段, 不设置, 过滤功能不起效</span></span><br><span class="line">    filter_fields = (<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;phone&#x27;</span>, <span class="string">&#x27;is_active&#x27;</span>)   <span class="comment"># ?username=tom&amp;phone=&amp;is_active=true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 根据不同的请求, 获得不同的序列化器</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_serializer_class</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.action == <span class="string">&#x27;unactived&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> UserUnActiveSerializer</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> UserSerializer</span><br><span class="line"></span><br><span class="line"><span class="meta">    @action(<span class="params">methods=[<span class="string">&#x27;get&#x27;</span>], detail=<span class="literal">False</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">unactived</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        <span class="comment"># 获取查询集, 过滤出未激活的用户</span></span><br><span class="line">        qs = <span class="variable language_">self</span>.queryset.<span class="built_in">filter</span>(is_active=<span class="literal">False</span>)</span><br><span class="line">        <span class="comment"># 使用序列化器, 序列化查询集, 并且是</span></span><br><span class="line">        ser = <span class="variable language_">self</span>.get_serializer(qs, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(ser.data)</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @action(<span class="params">methods=[<span class="string">&#x27;get&#x27;</span>], detail=<span class="literal">False</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">actived</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        <span class="comment"># 获取查询集, 过滤出未激活的用户</span></span><br><span class="line">        qs = <span class="variable language_">self</span>.queryset.<span class="built_in">filter</span>(is_active=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># 使用序列化器, 序列化查询集, 并且是</span></span><br><span class="line">        ser = <span class="variable language_">self</span>.get_serializer(qs, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(ser.data)</span><br></pre></td></tr></table></figure><h3 id="测试接口-2"><a href="#测试接口-2" class="headerlink" title="测试接口"></a>测试接口</h3><h4 id="查询-接口"><a href="#查询-接口" class="headerlink" title="查询 接口"></a>查询 接口</h4><ul><li>查询路由</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.查询所有用户</span></span><br><span class="line">http://<span class="number">192.168</span><span class="number">.56</span><span class="number">.100</span>:<span class="number">8888</span>/user/user/</span><br><span class="line"><span class="comment">#2.查询id=1的用户</span></span><br><span class="line">http://<span class="number">192.168</span><span class="number">.56</span><span class="number">.100</span>:<span class="number">8888</span>/user/user/<span class="number">1</span>/    <span class="comment">#3.查询 用户名（tom），激活的用户</span></span><br><span class="line">http://<span class="number">192.168</span><span class="number">.56</span><span class="number">.100</span>:<span class="number">8888</span>/user/user/?username=tom&amp;phone=&amp;is_active=true</span><br><span class="line"><span class="comment">#4.查询所有用户 用id 反向排序</span></span><br><span class="line">http://<span class="number">192.168</span><span class="number">.56</span><span class="number">.100</span>:<span class="number">8888</span>/user/user/?ordering=-<span class="built_in">id</span></span><br><span class="line"><span class="comment">#5.查询用户表中第一页，每页显示一条数据</span></span><br><span class="line">http://<span class="number">192.168</span><span class="number">.56</span><span class="number">.100</span>:<span class="number">8888</span>/user/user/?page=<span class="number">1</span>&amp;page_size=<span class="number">1</span></span><br></pre></td></tr></table></figure><ul><li>增加（POST）</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.增加用户</span></span><br><span class="line">http://<span class="number">192.168</span><span class="number">.56</span><span class="number">.100</span>:<span class="number">8888</span>/user/user/</span><br></pre></td></tr></table></figure><ul><li>修改（PUT）</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改用户信息</span></span><br><span class="line">http://<span class="number">192.168</span><span class="number">.56</span><span class="number">.100</span>:<span class="number">8888</span>/user/user/<span class="number">1</span>/</span><br></pre></td></tr></table></figure><ul><li>删除（DELETE）</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除用户</span></span><br><span class="line">http://<span class="number">192.168</span><span class="number">.56</span><span class="number">.100</span>:<span class="number">8888</span>/user/user/<span class="number">1</span>/</span><br></pre></td></tr></table></figure><h4 id="自定义认证权限"><a href="#自定义认证权限" class="headerlink" title="自定义认证权限"></a>自定义认证权限</h4><h5 id="测试全局权限功能"><a href="#测试全局权限功能" class="headerlink" title="测试全局权限功能"></a>测试<code>全局权限</code>功能</h5><ul><li>在浏览器中，打开任意接口，未登录用户只能发送get请求，只有登录用户才能发送post等请求</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://192.168.56.100:8888/user/user/</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;syl/settings.py中设置，只有认证用户可以访问, 否则只能读取</span></span><br><span class="line"><span class="string">REST_FRAMEWORK = &#123;</span></span><br><span class="line"><span class="string">    #2.权限配置（全局）： 顺序靠上的严格</span></span><br><span class="line"><span class="string">    &#x27;DEFAULT_PERMISSION_CLASSES&#x27;: [</span></span><br><span class="line"><span class="string">        &#x27;rest_framework.permissions.IsAuthenticatedOrReadOnly&#x27;,  # 认证用户可以访问, 否则只能读取</span></span><br><span class="line"><span class="string">    ],</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><h5 id="测试自定义权限功能"><a href="#测试自定义权限功能" class="headerlink" title="测试自定义权限功能"></a>测试<code>自定义权限</code>功能</h5><ul><li><code>注：自定义权限会覆盖settings.py中配置的全局权限</code></li><li>1.自定义权限（<code>其实应该写到一个单独的文件内进行公用，这里先写到这里进行测试</code>）</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自定义权限（局部）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPermission</span>(<span class="title class_ inherited__">BasePermission</span>):</span><br><span class="line">    <span class="comment"># has_permission 是用户对这个视图有没有 GET POST PUT PATCH DELETE 权限的分别判断</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">has_permission</span>(<span class="params">self, request, view</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;has_perm&#x27;</span>)</span><br><span class="line">        <span class="comment"># print(view.kwargs.get(&quot;pk&quot;), request.user.id)</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;判断用户对模型有没有访问权&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 任何用户对使用此权限类的视图都有访问权限</span></span><br><span class="line">        <span class="keyword">if</span> request.user.is_superuser:</span><br><span class="line">            <span class="comment"># 管理员对用户模型有访问权</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">elif</span> view.kwargs.get(<span class="string">&#x27;pk&#x27;</span>) == <span class="built_in">str</span>(request.user.<span class="built_in">id</span>):</span><br><span class="line">            <span class="comment"># 携带的id和用户的id相同时有访问权</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># has_object_permission 是用户过了 has_permission 判断有权限以后，再判断这个用户有没有对一个具体的对象有没有操作权限</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">has_object_permission</span>(<span class="params">self, request, view, obj</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;has_object_perm&#x27;</span>)</span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取单个数据时,判断用户对某个数据对象是否有访问权限&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> request.user.<span class="built_in">id</span> == obj.<span class="built_in">id</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure><ul><li>2.<code>user/viesws.py视图函数中指定当前视图要用的</code>权限类</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UserViewSet</span>(viewsets.ModelViewSet):</span><br><span class="line">    <span class="comment"># 2.权限：自定义权限类</span></span><br><span class="line">    permission_classes = (MyPermission,)</span><br></pre></td></tr></table></figure><h4 id="限流-1"><a href="#限流-1" class="headerlink" title="限流"></a>限流</h4><ul><li><code>syl/settings.py中配置限流</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">192.168</span><span class="number">.56</span><span class="number">.100</span>:<span class="number">8888</span>/user/apiview/</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;修改syl/settings.py配置限速设置&#x27;&#x27;&#x27;</span></span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="comment">#3.1 限流策略</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;3/hour&#x27;</span>,    <span class="comment"># 认证用户每小时10次</span></span><br><span class="line">        <span class="string">&#x27;anon&#x27;</span>: <span class="string">&#x27;3/day&#x27;</span>,     <span class="comment"># 未认证用户每天</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="序列化-1"><a href="#序列化-1" class="headerlink" title="序列化"></a>序列化</h4><ul><li><code>user/serialzers.py</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> user.models <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">address_validate</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="comment"># 独立校验器</span></span><br><span class="line">    <span class="comment"># raise serializers.ValidationError(&#x27;请填写实际地址&#x27;)  # 有错就抛出异常</span></span><br><span class="line">    <span class="comment"># 没错就返回数据</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserSerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="comment"># 1.独立校验器：重新设定字段, 替换掉模型中的设定, 重新设定地址的长度为5</span></span><br><span class="line">    address = serializers.CharField(max_length=<span class="number">255</span>, min_length=<span class="number">5</span>, validators=[address_validate])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.单一字段验证, 验证地址，validate_字段名</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_address</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">if</span> data == <span class="string">&#x27;测试&#x27;</span>:</span><br><span class="line">            <span class="keyword">raise</span> serializers.ValidationError(<span class="string">&#x27;请填写实际地址&#x27;</span>)  <span class="comment"># 有错就抛出异常</span></span><br><span class="line">        <span class="keyword">return</span> data  <span class="comment"># 没错就返回结果</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_phone</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="comment"># 不符合手机号格式</span></span><br><span class="line">        <span class="comment"># raise serializers.ValidationError(&#x27;手机号格式不正确&#x27;)</span></span><br><span class="line">        model = <span class="variable language_">self</span>.root.Meta.model</span><br><span class="line">        num = model.objects.<span class="built_in">filter</span>(phone=data).count()</span><br><span class="line">        <span class="keyword">if</span> num &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> serializers.ValidationError(<span class="string">&#x27;手机号已存在&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.所有属性验证器</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate</span>(<span class="params">self, attrs</span>):</span><br><span class="line">        <span class="comment"># attrs：&#123;&quot;username&quot;:&quot;zhangsan&quot;, &quot;phone&quot;:&quot;18538752511&quot;, ....&#125;</span></span><br><span class="line">        <span class="comment"># 所有属性验证器</span></span><br><span class="line">        <span class="comment"># self.context 中有request和view上下文</span></span><br><span class="line">        <span class="comment"># self.context[&#x27;view&#x27;].action 可以取到动作</span></span><br><span class="line">        <span class="comment"># attrs 是需要序列化的数据</span></span><br><span class="line">        <span class="comment"># raise serializers.ValidationError(&#x27;xxx错误&#x27;)  # 有问题报错</span></span><br><span class="line">        <span class="keyword">return</span> attrs  <span class="comment"># 没问题返回数据</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = User        <span class="comment"># 指定表</span></span><br><span class="line">        <span class="comment"># fields = (&#x27;id&#x27;, ) # 临时添加字段也需要写在这里</span></span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span>  <span class="comment"># 所有字段</span></span><br><span class="line">        <span class="comment"># exclude = [&#x27;id&#x27;]  # 排除 id 字段</span></span><br><span class="line">        read_only_fields = (<span class="string">&#x27;id&#x27;</span>,)  <span class="comment"># 指定字段为 read_only,</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 扩展address： extra_kwargs = &#123;&#125;  # 局部替换某些字段的设定, 或者新增设定</span></span><br><span class="line">        extra_kwargs = &#123;</span><br><span class="line">            <span class="string">&quot;address&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;min_length&quot;</span>: <span class="number">5</span>,  <span class="comment"># 给地址增加 最小长度限制</span></span><br><span class="line">                <span class="string">&quot;default&quot;</span>: <span class="string">&#x27;默认测试地址&#x27;</span>,  <span class="comment"># 增加默认值</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h4 id="自定义分页-2"><a href="#自定义分页-2" class="headerlink" title="自定义分页"></a>自定义分页</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http</span>:<span class="comment">//192.168.56.100:8888/user/user/?page=1&amp;page_size=1</span></span><br></pre></td></tr></table></figure><p>1</p><ul><li>1.<code>user/views.py</code>中定义自定义分页类</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 分页（局部）：自定义分页器 局部</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PageNum</span>(<span class="title class_ inherited__">PageNumberPagination</span>):</span><br><span class="line">    <span class="comment"># 查询字符串中代表每页返回数据数量的参数名, 默认值: None</span></span><br><span class="line">    page_size_query_param = <span class="string">&#x27;page_size&#x27;</span></span><br><span class="line">    <span class="comment"># 查询字符串中代表页码的参数名, 有默认值: page</span></span><br><span class="line">    <span class="comment"># page_query_param = &#x27;page&#x27;</span></span><br><span class="line">    <span class="comment"># 一页中最多的结果条数</span></span><br><span class="line">    max_page_size = <span class="number">2</span></span><br></pre></td></tr></table></figure><ul><li>2.<code>user/views.py</code>视图函数中使用</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UserViewSet</span>(viewsets.ModelViewSet):</span><br><span class="line">    <span class="comment"># 3.分页：自定义分页器 覆盖全局配置</span></span><br><span class="line">    pagination_class = PageNum</span><br></pre></td></tr></table></figure><h4 id="过滤和排序"><a href="#过滤和排序" class="headerlink" title="过滤和排序"></a>过滤和排序</h4><ul><li>测试url</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.过滤：查询 用户名（tom），激活的用户</span></span><br><span class="line">http://<span class="number">192.168</span><span class="number">.56</span><span class="number">.100</span>:<span class="number">8888</span>/user/user/?username=tom&amp;phone=&amp;is_active=true</span><br><span class="line"><span class="comment">#2.排序：查询所有用户 用id 反向排序</span></span><br><span class="line">http://<span class="number">192.168</span><span class="number">.56</span><span class="number">.100</span>:<span class="number">8888</span>/user/user/?ordering=-<span class="built_in">id</span></span><br></pre></td></tr></table></figure><ul><li><code>user/views.py</code>视图函数中配置过滤和排序字段</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UserViewSet</span>(viewsets.ModelViewSet):</span><br><span class="line">    <span class="comment"># 5.过滤：指定过滤方法类, 排序方法类, 一个或多个</span></span><br><span class="line">    filter_backends = (DjangoFilterBackend, OrderingFilter)  <span class="comment"># 同时支持过滤和排序</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 5.1指定排序字段, 不设置, 排序功能不起效</span></span><br><span class="line">    ordering_fields = (<span class="string">&#x27;date_joined&#x27;</span>, <span class="string">&#x27;id&#x27;</span>)  <span class="comment"># ?ordering=-id</span></span><br><span class="line">    <span class="comment"># 5.2指定过滤字段, 不设置, 过滤功能不起效</span></span><br><span class="line">    filter_fields = (<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;phone&#x27;</span>, <span class="string">&#x27;is_active&#x27;</span>)  <span class="comment"># ?username=tom&amp;phone=&amp;is_active=true</span></span><br></pre></td></tr></table></figure><h3 id="多对多序列化-1"><a href="#多对多序列化-1" class="headerlink" title="多对多序列化"></a>多对多序列化</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> course.models <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CourseSerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Course</span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span>  <span class="comment"># 所有字段</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SectionsSerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Sections</span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChaptersSerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    sections = SectionsSerializer(many=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Chapters</span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CourseDeepSerializer</span>(<span class="title class_ inherited__">CourseSerializer</span>):</span><br><span class="line">    <span class="comment"># 字段名名, 必须是模型可以 . 引用到的变量</span></span><br><span class="line">    <span class="comment"># Course().   &quot;chapters&quot;  才能作为字段名,  如果是集合, 需要加many=True,</span></span><br><span class="line">    chapters = ChaptersSerializer(many=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h3 id="其他用法"><a href="#其他用法" class="headerlink" title="其他用法"></a>其他用法</h3><h4 id="views-py-2"><a href="#views-py-2" class="headerlink" title="views.py"></a>views.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> viewsets, status</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DAppViewSet</span>(viewsets.ModelViewSet):</span><br><span class="line">    serializer_class = DAppSerializer</span><br><span class="line">    queryset = DApp.objects.<span class="built_in">all</span>()</span><br><span class="line">    filter_class = DAppFilter</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">list</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        orig_queryset = <span class="variable language_">self</span>.filter_queryset(<span class="variable language_">self</span>.get_queryset())</span><br><span class="line">        fav_qs = UserFavoriteProject.objects.<span class="built_in">filter</span>(user=<span class="variable language_">self</span>.request.user).values_list(<span class="string">&#x27;project__id&#x27;</span>, flat=<span class="literal">True</span>)</span><br><span class="line">        queryset = orig_queryset.exclude(pk__in=fav_qs)</span><br><span class="line">        pu_qs = ProjectGroupUser.objects.<span class="built_in">filter</span>(user=<span class="variable language_">self</span>.request.user).values_list(<span class="string">&#x27;project__id&#x27;</span>, flat=<span class="literal">True</span>)</span><br><span class="line">        qs = queryset.exclude(pk__in=pu_qs).values_list(<span class="string">&#x27;id&#x27;</span>, flat=<span class="literal">True</span>)</span><br><span class="line">        pk_lists = <span class="built_in">list</span>(fav_qs) + <span class="built_in">list</span>(pu_qs) + <span class="built_in">list</span>(qs)</span><br><span class="line"></span><br><span class="line">        ordering = <span class="string">&#x27;FIELD(`id`, %s)&#x27;</span> % <span class="string">&#x27;,&#x27;</span>.join(<span class="built_in">str</span>(p) <span class="keyword">for</span> p <span class="keyword">in</span> pk_lists)</span><br><span class="line">        queryset = orig_queryset.<span class="built_in">filter</span>(pk__in=<span class="built_in">list</span>(pk_lists)).extra(select=&#123;<span class="string">&#x27;ordering&#x27;</span>: ordering&#125;, order_by=(<span class="string">&#x27;ordering&#x27;</span>,))</span><br><span class="line"></span><br><span class="line">        page = <span class="variable language_">self</span>.paginate_queryset(queryset)</span><br><span class="line"></span><br><span class="line">        result_queryset = queryset</span><br><span class="line">        <span class="keyword">if</span> page <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            result_queryset = page</span><br><span class="line"></span><br><span class="line">        serializer = <span class="variable language_">self</span>.get_serializer(result_queryset, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">if</span> page <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            result = <span class="variable language_">self</span>.get_paginated_response(serializer.data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result = Response(serializer.data)</span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure><h4 id="serializers-py-1"><a href="#serializers-py-1" class="headerlink" title="serializers.py"></a>serializers.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DAppSerializer</span>(DynamicFieldsSerializerMixin, serializers.ModelSerializer):</span><br><span class="line">    name = serializers.CharField(required=<span class="literal">True</span>)</span><br><span class="line">    git_repo = serializers.CharField(required=<span class="literal">True</span>)</span><br><span class="line">    project = serializers.SlugRelatedField(slug_field=<span class="string">&#x27;name&#x27;</span>, required=<span class="literal">True</span>, allow_null=<span class="literal">True</span>, queryset=DProject.objects.<span class="built_in">all</span>())</span><br><span class="line">    level = serializers.CharField(required=<span class="literal">True</span>)</span><br><span class="line">    creator = serializers.SlugRelatedField(slug_field=<span class="string">&#x27;full_name&#x27;</span>, required=<span class="literal">False</span>, many=<span class="literal">False</span>, queryset=User.objects.<span class="built_in">all</span>())</span><br><span class="line">    create_time = serializers.DateTimeField(required=<span class="literal">False</span>, read_only=<span class="literal">True</span>)</span><br><span class="line">    update_time = serializers.DateTimeField(required=<span class="literal">False</span>, read_only=<span class="literal">True</span>)</span><br><span class="line">    is_archived = serializers.BooleanField(required=<span class="literal">False</span>)</span><br><span class="line">    is_deleted = serializers.BooleanField(required=<span class="literal">False</span>)</span><br><span class="line">    is_favorite = <span class="literal">False</span></span><br><span class="line">    channel_apps = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = DApp</span><br><span class="line">        fields = (<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;git_repo&#x27;</span>, <span class="string">&#x27;project&#x27;</span>, <span class="string">&#x27;creator&#x27;</span>, <span class="string">&#x27;create_time&#x27;</span>, <span class="string">&#x27;update_time&#x27;</span>, <span class="string">&#x27;is_archived&#x27;</span>, <span class="string">&#x27;is_deleted&#x27;</span>, <span class="string">&#x27;level&#x27;</span>)</span><br><span class="line">        validators = [</span><br><span class="line">            UniqueTogetherValidator(</span><br><span class="line">                queryset=DApp.objects.<span class="built_in">filter</span>(is_deleted=<span class="literal">False</span>),</span><br><span class="line">                fields=[<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;project&#x27;</span>],</span><br><span class="line">                message=<span class="string">&quot;该团队下已有同名应用!&quot;</span></span><br><span class="line">            )</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">self, validated_data</span>):</span><br><span class="line">        validated_data[<span class="string">&#x27;creator&#x27;</span>] = <span class="variable language_">self</span>.context[<span class="string">&#x27;request&#x27;</span>].user</span><br><span class="line">        instance = <span class="built_in">super</span>(DAppSerializer, <span class="variable language_">self</span>).create(validated_data)</span><br><span class="line">        <span class="keyword">for</span> channel_app <span class="keyword">in</span> <span class="variable language_">self</span>.channel_apps:</span><br><span class="line">            obj = ChannelApp.objects.create(**channel_app)</span><br><span class="line">            obj.done_app = instance</span><br><span class="line">            obj.save()</span><br><span class="line">        AppGroupUser.objects.create(user=<span class="variable language_">self</span>.context[<span class="string">&#x27;request&#x27;</span>].user,app=instance,role=<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> instance</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, instance, validated_data</span>):</span><br><span class="line">        user = <span class="variable language_">self</span>.context[<span class="string">&#x27;request&#x27;</span>].user</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.is_favorite <span class="keyword">is</span> <span class="literal">True</span>:</span><br><span class="line">            UserFavoriteApp.objects.get_or_create(user=user, app=instance)</span><br><span class="line">        <span class="keyword">elif</span> <span class="variable language_">self</span>.is_favorite <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">            favorite = UserFavoriteApp.objects.<span class="built_in">filter</span>(user=user, app=instance).last()</span><br><span class="line">            <span class="keyword">if</span> favorite:</span><br><span class="line">                favorite.delete()</span><br><span class="line">        <span class="keyword">for</span> channel_app <span class="keyword">in</span> <span class="variable language_">self</span>.channel_apps:</span><br><span class="line">            qs = ChannelApp.objects.<span class="built_in">filter</span>(**channel_app).<span class="built_in">filter</span>(done_app=instance)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> qs.exists():</span><br><span class="line">                obj = ChannelApp.objects.create(**channel_app)</span><br><span class="line">                obj.done_app = instance</span><br><span class="line">                obj.save()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>(DAppSerializer, <span class="variable language_">self</span>).update(instance, validated_data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">to_internal_value</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;is_favorite&#x27;</span> <span class="keyword">in</span> data:</span><br><span class="line">            <span class="variable language_">self</span>.is_favorite = data.pop(<span class="string">&#x27;is_favorite&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;channel_apps&#x27;</span> <span class="keyword">in</span> data:</span><br><span class="line">            <span class="variable language_">self</span>.channel_apps = data.pop(<span class="string">&#x27;channel_apps&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>(DAppSerializer, <span class="variable language_">self</span>).to_internal_value(data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">to_representation</span>(<span class="params">self, instance</span>):</span><br><span class="line">        result = <span class="built_in">super</span>(DAppSerializer, <span class="variable language_">self</span>).to_representation(instance)</span><br><span class="line">        project = instance.project</span><br><span class="line">        <span class="comment"># 1.找到所有&quot;团队管理员&quot;</span></span><br><span class="line">        items = ProjectGroupUser.objects.<span class="built_in">filter</span>(project=project, role=<span class="string">&#x27;1&#x27;</span>).values_list(<span class="string">&quot;user__full_name&quot;</span>, flat=<span class="literal">True</span>)</span><br><span class="line">        admins = &#123;item.strip() <span class="keyword">for</span> item <span class="keyword">in</span> items <span class="keyword">if</span> item.strip()&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 2.找到所有&quot;应用管理员&quot;</span></span><br><span class="line">        items = AppGroupUser.objects.<span class="built_in">filter</span>(app=instance, role=<span class="string">&#x27;1&#x27;</span>).values_list(<span class="string">&quot;user__full_name&quot;</span>, flat=<span class="literal">True</span>)</span><br><span class="line">        app_admins = &#123;item.strip() <span class="keyword">for</span> item <span class="keyword">in</span> items <span class="keyword">if</span> item.strip()&#125;</span><br><span class="line">        admins.update(app_admins)</span><br><span class="line">        result[<span class="string">&#x27;admins&#x27;</span>] = <span class="built_in">list</span>(admins)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 3.判断是否 &quot;is_favorite&quot;</span></span><br><span class="line">        user = <span class="variable language_">self</span>.context[<span class="string">&#x27;request&#x27;</span>].user</span><br><span class="line">        qs = UserFavoriteApp.objects.<span class="built_in">filter</span>(user=user, app=instance)</span><br><span class="line">        result[<span class="string">&#x27;is_favorite&#x27;</span>] = <span class="literal">True</span> <span class="keyword">if</span> qs.exists() <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 4.判断是否有&quot;编辑应用&quot;权限</span></span><br><span class="line">        pg = ProjectGroupUser.objects.<span class="built_in">filter</span>(project=project, user=user, role=<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">        ag = AppGroupUser.objects.<span class="built_in">filter</span>(app=instance, user=user, role=<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">        sys_admin = SysRole.objects.<span class="built_in">filter</span>(user=user,role=<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">        result[<span class="string">&#x27;can_be_updated&#x27;</span>] = <span class="built_in">any</span>([pg.exists(), ag.exists(), sys_admin.exists()])</span><br><span class="line"></span><br><span class="line">        values = ChannelApp.objects.<span class="built_in">filter</span>(done_app=instance).values(</span><br><span class="line">            <span class="string">&quot;channel&quot;</span>, <span class="string">&quot;channel_sys_name&quot;</span>, <span class="string">&quot;channel_app_domain&quot;</span>, <span class="string">&quot;channel_app_name&quot;</span>, <span class="string">&quot;channel_app_type&quot;</span>,</span><br><span class="line">            <span class="string">&quot;channel_app_language&quot;</span>)</span><br><span class="line">        result[<span class="string">&quot;channel_apps&quot;</span>] = <span class="built_in">list</span>(values)</span><br><span class="line">        result[<span class="string">&#x27;locked&#x27;</span>] = <span class="variable language_">self</span>.get_app_locked(instance)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_app_locked</span>(<span class="params">self, instance</span>):</span><br><span class="line">        <span class="keyword">if</span> DeltaInstance.objects.<span class="built_in">filter</span>(Q(app=instance) &amp; ~Q(status__config_name__in=[<span class="string">&#x27;success&#x27;</span>, <span class="string">&#x27;cancel&#x27;</span>])):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure><h4 id="filters-py"><a href="#filters-py" class="headerlink" title="filters.py"></a>filters.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DAppFilter</span>(<span class="title class_ inherited__">FilterSet</span>):</span><br><span class="line">    name = CharFilter(lookup_expr=<span class="string">&quot;icontains&quot;</span>)</span><br><span class="line">    is_archived = CaseInsensitiveBooleanFilter()</span><br><span class="line">    is_deleted = CaseInsensitiveBooleanFilter()</span><br><span class="line">    project = CharFilter(method=<span class="string">&quot;filter_project&quot;</span>)</span><br><span class="line">    exact_name = CharFilter(method=<span class="string">&quot;filter_exact_name&quot;</span>)</span><br><span class="line">    project_id = CharFilter(method=<span class="string">&quot;filter_project_id&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = DApp</span><br><span class="line">        fields = (<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;is_archived&#x27;</span>, <span class="string">&#x27;is_deleted&#x27;</span>, <span class="string">&#x27;project&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">filter_project</span>(<span class="params">self, qs, name, value</span>):</span><br><span class="line">        <span class="keyword">return</span> qs.<span class="built_in">filter</span>(project__name=value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">filter_exact_name</span>(<span class="params">self, qs, name, value</span>):</span><br><span class="line">        <span class="keyword">return</span> qs.<span class="built_in">filter</span>(name=value, is_deleted=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">filter_project_id</span>(<span class="params">self, qs, name, value</span>):</span><br><span class="line">        user = <span class="variable language_">self</span>.request.user</span><br><span class="line">        project_id = value</span><br><span class="line">        <span class="comment"># 如果是&quot;系统管理员&quot;,和团队管理员可以看见所有</span></span><br><span class="line">        <span class="keyword">if</span> CurrentUserRoles.is_sys_admin(user) <span class="keyword">or</span> CurrentUserRoles.is_project_admin(user, project_id):</span><br><span class="line">            <span class="keyword">return</span> qs.<span class="built_in">all</span>()</span><br><span class="line">        <span class="comment"># 查询当前用户，在project_id这个团队下，角色为应用管理员的所有 应用角色</span></span><br><span class="line">        project_apps = AppGroupUser.objects.<span class="built_in">filter</span>(app__project_id=project_id, user=user, role=<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">        app_ids = [appuser.app.<span class="built_in">id</span> <span class="keyword">for</span> appuser <span class="keyword">in</span> project_apps]</span><br><span class="line">        <span class="keyword">if</span> project_apps:</span><br><span class="line">            <span class="keyword">return</span> qs.<span class="built_in">filter</span>(id__in=app_ids)</span><br><span class="line">        <span class="keyword">return</span> qs.none()</span><br></pre></td></tr></table></figure></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者: </i></span><span class="reprint-info"><a href="/about" rel="external nofollow noreferrer">张大哥</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接: </i></span><span class="reprint-info"><a href="https://blog.zhangtq.com/posts/28675.html">https://blog.zhangtq.com/posts/28675.html</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明: </i></span><span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> 许可协议。转载请注明来源 <a href="/about" target="_blank">张大哥</a> !</span></div></div><script async defer>function navToReprintStatement(){$("html, body").animate({scrollTop:$("#reprint-statement").offset().top-80},800)}document.addEventListener("copy",function(t){M.toast({html:'<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>'})})</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/tags/%E4%BD%A0%E7%9A%84%E6%A0%87%E7%AD%BE/"><span class="chip bg-color">你的标签</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="/libs/share/js/social-share.min.js"></script></div></div></div><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的赏识是我前进的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="/medias/loading.gif" data-original="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="/medias/loading.gif" data-original="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i>&nbsp;上一篇</div><div class="card"><a href="/posts/63146.html"><div class="card-image"><img src="/medias/loading.gif" data-original="/medias/featureimages/6.jpg" class="responsive-img" alt="Celery"> <span class="card-title">Celery</span></div></a><div class="card-content article-content"><div class="summary block-with-text">celery组件与原理celery原理与组件celery应用举例 Celery 是一个 基于python开发的分布式异步消息任务队列，通过它</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2023-06-25 </span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/python/" class="post-category">python</a></span></div></div><div class="card-action article-tags"><a href="/tags/celery/"><span class="chip bg-color">celery</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/posts/58477.html"><div class="card-image"><img src="/medias/loading.gif" data-original="/medias/featureimages/16.jpg" class="responsive-img" alt="Python模块"> <span class="card-title">Python模块</span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2023-06-24 </span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/python/" class="post-category">python</a></span></div></div><div class="card-action article-tags"><a href="/tags/python/"><span class="chip bg-color">python</span></a></div></div></div></div></article></div><script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script><script type="text/javascript" src="/libs/prism/prism.min.js"></script><script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script><script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script><script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget card" style="background-color:#fff"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="/libs/tocbot/tocbot.min.js"></script><script>$(function(){tocbot.init({tocSelector:"#toc-content",contentSelector:"#articleContent",headingsOffset:-(.4*$(window).height()-45),collapseDepth:Number("3"),headingSelector:"h1, h2, h3, h4"});let t=parseInt(.4*$(window).height()-64),e=$(".toc-widget"),n=($(window).scroll(function(){$(window).scrollTop()>t?e.addClass("toc-fixed"):e.removeClass("toc-fixed")}),"expanded"),i=$("#toc-aside"),l=$("#main-content");$("#floating-toc-btn .btn-floating").click(function(){i.hasClass(n)?(i.removeClass(n).hide(),l.removeClass("l9")):(i.addClass(n).show(),l.addClass("l9"));var e="artDetail",o="prenext-posts";if(0!==(e=$("#"+e)).length){let t=e.width();450<=t?t+=21:350<=t&&t<450?t+=18:300<=t&&t<350?t+=16:t+=14,$("#"+o).width(t)}})})</script></main><footer class="page-footer bg-color"><link rel="stylesheet" href="/libs/aplayer/APlayer.min.css"><style>.aplayer .aplayer-lrc p{display:none;font-size:12px;font-weight:700;line-height:16px!important}.aplayer .aplayer-lrc p.aplayer-lrc-current{display:none;font-size:15px;color:#42b983}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body{left:-66px!important}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover{left:0!important}</style><div><div class="row"><meting-js class="col l8 offset-l2 m10 offset-m1 s12" server="netease" type="playlist" id="7548962547" fixed="true" autoplay theme="#42b983" loop order="random" preload="auto" volume="0.7" list-folded="true"></meting-js></div></div><script src="/libs/aplayer/APlayer.min.js"></script><script src="/libs/aplayer/Meting.min.js"></script><div class="container row center-align" style="margin-bottom:15px!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2019-2024</span> <a href="/about" target="_blank">张大哥</a> |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a> |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a><br><span id="sitetime">Loading ...</span> <span class="my-face">ღゝ◡╹)ノ♡</span><script language="javascript">function siteTime() { 
                        window.setTimeout("siteTime()", 1000); 
                        var seconds = 1000; var minutes = seconds * 60; 
                        var hours = minutes * 60; 
                        var days = hours * 24; 
                        var years = days * 365; 
                        var today = new Date(); 
                        var todayYear = today.getFullYear(); 
                        var todayMonth = today.getMonth() + 1; 
                        var todayDate = today.getDate(); 
                        var todayHour = today.getHours(); 
                        var todayMinute = today.getMinutes(); 
                        var todaySecond = today.getSeconds(); 
                        /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳) year - 作为date对象的年份，为4位年份值 month - 0-11之间的整数，做为date对象的月份 day - 1-31之间的整数，做为date对象的天数 hours - 0(午夜24点)-23之间的整数，做为date对象的小时数 minutes - 0-59之间的整数，做为date对象的分钟数 seconds - 0-59之间的整数，做为date对象的秒数 microseconds - 0-999之间的整数，做为date对象的毫秒数 */ 
                        var t1 = Date.UTC(2017, 09, 11, 00, 00, 00); //北京时间2018-2-13 00:00:00 
                        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond); var diff = t2 - t1; 
                        var diffYears = Math.floor(diff / years); 
                        var diffDays = Math.floor((diff / days) - diffYears * 365); 
                        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes); 
                        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days -diffHours * hours - diffMinutes * minutes) / seconds);
                        document.getElementById("sitetime").innerHTML = "本站已运行 " +diffYears+" 年 "+diffDays + " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } /*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/ 
                    siteTime();</script><br>&nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span class="white-color">226.2k</span> <span id="busuanzi_container_site_pv">&nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp; <span id="busuanzi_value_site_pv" class="white-color"></span> </span><span id="busuanzi_container_site_pv" style="display:none"><i class="fa fa-heart-o"></i> 本站总访问量 <span id="busuanzi_value_site_pv" class="white-color"></span> </span><span id="busuanzi_container_site_uv" style="display:none">人次,&nbsp;访客数 <span id="busuanzi_value_site_uv" class="white-color"></span> 人.</span><br></div><div class="col s12 m4 l4 social-link social-statis"><a href="https://gitee.com/zhangtqup/" class="tooltipped" target="_blank" data-tooltip="访问我的Git" data-position="top" data-delay="50"><i class="fa-brands fa-gitlab"></i> </a><a href="mailto:15652533044@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fas fa-envelope-open"></i> </a><a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1028354023" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1028354023" data-position="top" data-delay="50"><i class="fab fa-qq"></i> </a><a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50"><i class="fas fa-rss"></i></a></div></div></footer><div class="progress-bar"></div><script>$(document).ready(function(){var e=setInterval(function(){"none"!=document.getElementById("busuanzi_container_site_pv").style.display&&($("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html())+n),clearInterval(e));"none"!=$("#busuanzi_container_site_pv").css("display")&&($("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html())+t),clearInterval(e))},50),n=8e4,t=2e4})</script><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script type="text/javascript">$(function(){var e,r,s;e="/search.xml",r="searchInput",s="searchResult",$.ajax({url:e,dataType:"xml",success:function(e){var t=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),e=document.getElementById(r),n=document.getElementById(s);e.addEventListener("input",function(){var o='<ul class="search-result-list">',h=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length<=0||(t.forEach(function(e){var n,t,r,s=!0,a=e.title.trim().toLowerCase(),l=e.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),i=0===(i=e.url).indexOf("/")?e.url:"/"+i,c=-1,u=-1;""!==a&&""!==l&&h.forEach(function(e,t){n=a.indexOf(e),c=l.indexOf(e),n<0&&c<0?s=!1:(c<0&&(c=0),0===t&&(u=c))}),s&&(o+="<li><a href='"+i+"' class='search-result-title'>"+a+"</a>",i=e.content.trim().replace(/<[^>]+>/g,""),0<=u&&(e=u+80,(e=0===(t=(t=u-20)<0?0:t)?100:e)>i.length&&(e=i.length),r=i.substr(t,e),h.forEach(function(e){var t=new RegExp(e,"gi");r=r.replace(t,'<em class="search-keyword">'+e+"</em>")}),o+='<p class="search-result">'+r+"...</p>"),o+="</li>")}),o+="</ul>",n.innerHTML=o)})}})})</script><div class="stars-con"><div id="stars"></div><div id="stars2"></div><div id="stars3"></div></div><script>function switchNightMode(){$('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($("body")),setTimeout(function(){$("body").hasClass("DarkMode")?($("body").removeClass("DarkMode"),localStorage.setItem("isDark","0"),$("#sum-moon-icon").removeClass("fa-sun").addClass("fa-moon")):($("body").addClass("DarkMode"),localStorage.setItem("isDark","1"),$("#sum-moon-icon").addClass("fa-sun").removeClass("fa-moon")),setTimeout(function(){$(".Cuteen_DarkSky").fadeOut(1e3,function(){$(this).remove()})},2e3)})}</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="/libs/materialize/materialize.min.js"></script><script src="/libs/masonry/masonry.pkgd.min.js"></script><script src="/libs/aos/aos.js"></script><script src="/libs/scrollprogress/scrollProgress.min.js"></script><script src="/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="/js/matery.js"></script><script type="text/javascript">var windowWidth=$(window).width();768<windowWidth&&document.write('<script type="text/javascript" src="/libs/others/snow.js"><\/script>')</script><script src="https://ssl.captcha.qq.com/TCaptcha.js"></script><script src="/libs/others/TencentCaptcha.js"></script><button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button><script>(()=>{var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",(e=document.getElementsByTagName("script")[0]).parentNode.insertBefore(t,e)})()</script><script src="/libs/others/clicklove.js" async></script><script async src="/libs/others/busuanzi.pure.mini.js"></script><script type="text/javascript" color="0,0,255" pointcolor="0,0,255" opacity="0.7" zindex="-1" count="99" src="/libs/background/canvas-nest.js"></script><script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async></script><script src="/libs/instantpage/instantpage.js" type="module"></script>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 4,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z\d\-\.\+]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(t.test(e.href)||r.test(e.href))&&(e.href=a.dataset.original)})});</script><script>(r=>{r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,o=r.imageLazyLoadSetting.preloadRatio||1,d=i();function i(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(t){(a||t)&&(d=i());for(var e,n=0;n<d.length;n++)0<=(e=(e=d[n]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*o||document.documentElement.clientHeight*o)&&(()=>{var t,e,a,o,i=d[n];e=function(){d=d.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(a=new Image,o=t.getAttribute("data-original"),a.onload=function(){t.src=o,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),e&&e()},a.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=o},t.src!==o&&(a.src=o)))})()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)})(this);</script></body></html>